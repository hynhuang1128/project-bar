<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>技术文档17-2-24.md</title><link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css'><style type='text/css'>html, body {overflow-x: initial !important;}.CodeMirror { height: auto; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; }
.CodeMirror-lines { padding: 4px 0px; }
.CodeMirror pre { }
.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { background-color: white; }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background-color: rgb(247, 247, 247); white-space: nowrap; }
.CodeMirror-linenumbers { }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.CodeMirror div.CodeMirror-cursor { border-left: 1px solid black; z-index: 3; }
.CodeMirror div.CodeMirror-secondarycursor { border-left: 1px solid silver; }
.CodeMirror.cm-keymap-fat-cursor div.CodeMirror-cursor { width: auto; border: 0px; background: rgb(119, 238, 119); z-index: 1; }
.CodeMirror div.CodeMirror-cursor.CodeMirror-overwrite { }
.cm-tab { display: inline-block; }
.cm-s-typora-default .cm-header, .cm-s-typora-default .cm-property { color: rgb(217, 79, 138); }
.cm-s-typora-default pre.cm-header1:not(.cm-atom) :not(.cm-overlay) { font-size: 2rem; line-height: 2rem; }
.cm-s-typora-default pre.cm-header2:not(.cm-atom) :not(.cm-overlay) { font-size: 1.4rem; line-height: 1.4rem; }
.cm-s-typora-default .cm-atom, .cm-s-typora-default .cm-number { color: rgb(149, 132, 134); }
.cm-s-typora-default .cm-table-row, .cm-s-typora-default .cm-block-start { font-family: monospace; }
.cm-s-typora-default .cm-comment, .cm-s-typora-default .cm-code { color: rgb(74, 90, 159); font-family: monospace; }
.cm-s-typora-default .cm-tag { color: rgb(169, 68, 66); }
.cm-s-typora-default .cm-string { color: rgb(126, 134, 169); }
.cm-s-typora-default .cm-link { color: rgb(196, 122, 15); text-decoration: underline; }
.cm-s-typora-default .cm-variable-2, .cm-s-typora-default .cm-variable-1 { color: inherit; }
.cm-s-typora-default .cm-overlay { font-size: 1rem; font-family: monospace; }
.CodeMirror.cm-s-typora-default div.CodeMirror-cursor { border-left: 3px solid rgb(228, 98, 154); }
.cm-s-typora-default .CodeMirror-activeline-background { left: -60px; right: -30px; background: rgba(204, 204, 204, 0.2); }
.cm-s-typora-default .CodeMirror-gutters { border-right: none; background-color: inherit; }
.cm-s-typora-default .cm-trailing-space-new-line::after, .cm-startspace::after, .cm-starttab .cm-tab::after { content: "•"; position: absolute; left: 0px; opacity: 0; font-family: LetterGothicStd, monospace; }
.os-windows .cm-startspace::after, .os-windows .cm-starttab .cm-tab::after { left: -0.1em; }
.cm-starttab .cm-tab::after { content: " "; }
.cm-startspace, .cm-tab, .cm-starttab, .cm-trailing-space-a, .cm-trailing-space-b, .cm-trailing-space-new-line { font-family: monospace; position: relative; }
.cm-s-typora-default .cm-trailing-space-new-line::after { content: "↓"; opacity: 0.3; }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: black; }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-property { color: black; }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: blue; }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: bold; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: rgb(255, 0, 0); }
.cm-invalidchar { color: rgb(255, 0, 0); }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { margin-bottom: -30px; margin-right: -30px; padding-bottom: 30px; padding-right: 30px; height: 100%; outline: none; position: relative; box-sizing: content-box; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow-x: hidden; overflow-y: scroll; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow-y: hidden; overflow-x: scroll; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-widget { }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.CodeMirror-selected { background: rgb(217, 217, 217); }
.CodeMirror-focused .CodeMirror-selected { background: rgb(215, 212, 240); }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
.CodeMirror span { }
@media print { 
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}
.CodeMirror-lint-markers { width: 16px; }
.CodeMirror-lint-tooltip { background-color: infobackground; border: 1px solid black; border-radius: 4px; color: infotext; font-family: monospace; overflow: hidden; padding: 2px 5px; position: fixed; white-space: pre-wrap; z-index: 10000; max-width: 600px; opacity: 0; transition: opacity 0.4s; font-size: 0.8em; }
.CodeMirror-lint-mark-error, .CodeMirror-lint-mark-warning { background-position: left bottom; background-repeat: repeat-x; }
.CodeMirror-lint-mark-error { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAADCAYAAAC09K7GAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sJDw4cOCW1/KIAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAHElEQVQI12NggIL/DAz/GdA5/xkY/qPKMDAwAADLZwf5rvm+LQAAAABJRU5ErkJggg=="); }
.CodeMirror-lint-marker-error, .CodeMirror-lint-marker-warning { background-position: center center; background-repeat: no-repeat; cursor: pointer; display: inline-block; height: 16px; width: 16px; vertical-align: middle; position: relative; }
.CodeMirror-lint-message-error, .CodeMirror-lint-message-warning { padding-left: 18px; background-position: left top; background-repeat: no-repeat; }
.CodeMirror-lint-marker-error, .CodeMirror-lint-message-error { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAHlBMVEW7AAC7AACxAAC7AAC7AAAAAAC4AAC5AAD///+7AAAUdclpAAAABnRSTlMXnORSiwCK0ZKSAAAATUlEQVR42mWPOQ7AQAgDuQLx/z8csYRmPRIFIwRGnosRrpamvkKi0FTIiMASR3hhKW+hAN6/tIWhu9PDWiTGNEkTtIOucA5Oyr9ckPgAWm0GPBog6v4AAAAASUVORK5CYII="); }
.CodeMirror-lint-marker-warning, .CodeMirror-lint-message-warning { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAANlBMVEX/uwDvrwD/uwD/uwD/uwD/uwD/uwD/uwD/uwD6twD/uwAAAADurwD2tQD7uAD+ugAAAAD/uwDhmeTRAAAADHRSTlMJ8mN1EYcbmiixgACm7WbuAAAAVklEQVR42n3PUQqAIBBFUU1LLc3u/jdbOJoW1P08DA9Gba8+YWJ6gNJoNYIBzAA2chBth5kLmG9YUoG0NHAUwFXwO9LuBQL1giCQb8gC9Oro2vp5rncCIY8L8uEx5ZkAAAAASUVORK5CYII="); }
.CodeMirror-lint-marker-multiple { background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAMAAADzjKfhAAAACVBMVEUAAAAAAAC/v7914kyHAAAAAXRSTlMAQObYZgAAACNJREFUeNo1ioEJAAAIwmz/H90iFFSGJgFMe3gaLZ0od+9/AQZ0ADosbYraAAAAAElFTkSuQmCC"); background-repeat: no-repeat; background-position: right bottom; width: 100%; height: 100%; }


html { font-size: 14px; background-color: rgb(255, 255, 255); color: rgb(51, 51, 51); }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { background: rgb(181, 214, 252); text-shadow: none; }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; padding-bottom: 70px; white-space: pre-wrap; overflow-x: auto; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
@media screen and (max-width: 500px) { 
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
.typora-export #write { margin: 0px auto; }
#write > p:first-child, #write > ul:first-child, #write > ol:first-child, #write > pre:first-child, #write > blockquote:first-child, #write > div:first-child, #write > table:first-child { margin-top: 30px; }
#write li > table:first-child { margin-top: -20px; }
img { max-width: 100%; vertical-align: middle; }
input, button, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
::before, ::after, * { box-sizing: border-box; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write div, #write pre { width: inherit; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6 { position: relative; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
p { -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; }
.mathjax-block { margin-top: 0px; margin-bottom: 0px; -webkit-margin-before: 0rem; -webkit-margin-after: 0rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: bold; font-style: italic; }
a { cursor: pointer; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; margin: 4px 0px 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 80px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
pre { white-space: pre-wrap; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
.md-fences .CodeMirror.CodeMirror-wrap { top: -1.6em; margin-bottom: -1.6em; }
.md-fences.mock-cm { white-space: pre-wrap; }
.show-fences-line-number .md-fences { padding-left: 0px; }
.show-fences-line-number .md-fences.mock-cm { padding-left: 40px; }
.footnotes { opacity: 0.8; font-size: 0.9rem; padding-top: 1em; padding-bottom: 1em; }
.footnotes + .footnotes { margin-top: -1em; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: transparent; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: normal; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li p, li .mathjax-block { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; }
@media print { 
  html, body { height: 100%; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  h1, h2, h3, h4, h5, h6 { break-after: avoid-page; orphans: 2; }
  p { orphans: 4; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 1cm; padding-right: 1cm; }
  .typora-export #write::after { height: 0px; }
  @page { margin: 20mm 0mm; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 2.86rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p .md-image:only-child { display: inline-block; width: 100%; text-align: center; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.mathjax-block { white-space: pre; overflow: hidden; width: 100%; }
p + .mathjax-block { margin-top: -1.143rem; }
.mathjax-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: none; box-shadow: none; }
.task-list { list-style-type: none; }
.task-list-item { position: relative; padding-left: 1em; }
.task-list-item input { position: absolute; top: 0px; left: 0px; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc::after, .md-toc-content::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); text-decoration: none; }
.md-toc-inner:hover { }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: bold; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
.md-tag { opacity: 0.5; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: monospace; }
code { text-align: left; }
h1 .md-tag, h2 .md-tag, h3 .md-tag, h4 .md-tag, h5 .md-tag, h6 .md-tag { font-weight: initial; opacity: 0.35; }
a.md-print-anchor { border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: none !important; background: transparent !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.mathjax-block .MathJax_SVG_Display { text-align: center; margin: 1em 0em; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: monospace; }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: normal; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }


@font-face { font-family: "Open Sans"; font-style: normal; font-weight: normal; src: local("Open Sans Regular"), url("./github/400.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: italic; font-weight: normal; src: local("Open Sans Italic"), url("./github/400i.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: normal; font-weight: bold; src: local("Open Sans Bold"), url("./github/700.woff") format("woff"); }
@font-face { font-family: "Open Sans"; font-style: italic; font-weight: bold; src: local("Open Sans Bold Italic"), url("./github/700i.woff") format("woff"); }
html { font-size: 16px; }
body { font-family: "Open Sans", "Clear Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; }
#write { max-width: 860px; margin: 0px auto; padding: 20px 30px 100px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
body > :first-child { margin-top: 0px !important; }
body > :last-child { margin-bottom: 0px !important; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 4px; padding: 0px; margin: 16px 0px; background-color: rgb(231, 231, 231); border-width: 0px 0px 1px; border-style: none none solid; border-top-color: initial; border-right-color: initial; border-left-color: initial; border-image: initial; overflow: hidden; box-sizing: content-box; border-bottom-color: rgb(221, 221, 221); }
body > h2:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child + h2 { margin-top: 0px; padding-top: 0px; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child { margin-top: 0px; padding-top: 0px; }
a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 { margin-top: 0px; padding-top: 0px; }
h1 p, h2 p, h3 p, h4 p, h5 p, h6 p { margin-top: 0px; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left: 4px solid rgb(221, 221, 221); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; word-break: initial; }
#write { overflow-x: auto; }
table tr { border-top: 1px solid rgb(204, 204, 204); background-color: white; margin: 0px; padding: 0px; }
table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); }
.md-fences, code, tt { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); border-radius: 3px; font-family: Consolas, "Liberation Mono", Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; }
.md-fences { margin-bottom: 15px; margin-top: 15px; padding: 8px 1em 6px; }
.task-list { padding-left: 0px; }
.task-list-item { padding-left: 32px; }
.task-list-item input { top: 3px; left: 8px; }
@media screen and (min-width: 914px) { 
}
@media print { 
  html { font-size: 13px; }
  table, pre { break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; background-color: rgb(247, 247, 247); border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, "Liberation Mono", Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; color: inherit; }
.md-tag { color: inherit; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { background-color: rgb(250, 250, 250); border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; }
#md-notification::before { top: 10px; }
.on-focus-mode blockquote { border-left-color: rgba(85, 85, 85, 0.117647); }
header, .context-menu, .megamenu-content, footer { font-family: "Segoe UI", Arial, sans-serif; }






</style>
</head>
<body class='typora-export' >
<div  id='write'  class = 'is-node'><p></p><h1><a name='header-c6422' class='md-header-anchor '></a>目录</h1><div class='md-toc' mdtype='toc'><p class="md-toc-content"><span class="md-toc-item md-toc-h1" data-ref="c6422"><a class="md-toc-inner" href="#header-c6422">目录</a></span><span class="md-toc-item md-toc-h1" data-ref="c6424"><a class="md-toc-inner" href="#header-c6424">产品版本说明</a></span><span class="md-toc-item md-toc-h1" data-ref="c6434"><a class="md-toc-inner" href="#header-c6434">参考资料</a></span><span class="md-toc-item md-toc-h1" data-ref="c6447"><a class="md-toc-inner" href="#header-c6447">文档目的</a></span><span class="md-toc-item md-toc-h1" data-ref="c6450"><a class="md-toc-inner" href="#header-c6450">声明</a></span><span class="md-toc-item md-toc-h1" data-ref="c6453"><a class="md-toc-inner" href="#header-c6453">正文</a></span><span class="md-toc-item md-toc-h2" data-ref="c6454"><a class="md-toc-inner" href="#header-c6454">一、软件需求</a></span><span class="md-toc-item md-toc-h3" data-ref="c6455"><a class="md-toc-inner" href="#header-c6455">1.功能需求</a></span><span class="md-toc-item md-toc-h3" data-ref="c6460"><a class="md-toc-inner" href="#header-c6460">2.具体功能</a></span><span class="md-toc-item md-toc-h4" data-ref="c6461"><a class="md-toc-inner" href="#header-c6461">2.1 芯片与捷昌控制盒</a></span><span class="md-toc-item md-toc-h4" data-ref="c6470"><a class="md-toc-inner" href="#header-c6470">2.2 芯片与手机</a></span><span class="md-toc-item md-toc-h2" data-ref="c6489"><a class="md-toc-inner" href="#header-c6489">二、需求实现</a></span><span class="md-toc-item md-toc-h3" data-ref="c6490"><a class="md-toc-inner" href="#header-c6490">1.实现逻辑</a></span><span class="md-toc-item md-toc-h4" data-ref="c6491"><a class="md-toc-inner" href="#header-c6491">1.1 蓝牙收发实现逻辑</a></span><span class="md-toc-item md-toc-h5" data-ref="c6492"><a class="md-toc-inner" href="#header-c6492">1.1.1 从手机端获取数据逻辑</a></span><span class="md-toc-item md-toc-h6" data-ref="c6493"><a class="md-toc-inner" href="#header-c6493">原理</a></span><span class="md-toc-item md-toc-h6" data-ref="c6498"><a class="md-toc-inner" href="#header-c6498">需要从手机端获取的数据</a></span><span class="md-toc-item md-toc-h5" data-ref="c6552"><a class="md-toc-inner" href="#header-c6552">1.1.2 芯片端发送数据逻辑</a></span><span class="md-toc-item md-toc-h6" data-ref="c6553"><a class="md-toc-inner" href="#header-c6553">原理</a></span><span class="md-toc-item md-toc-h6" data-ref="c6558"><a class="md-toc-inner" href="#header-c6558">需要发送到手机端的数据</a></span><span class="md-toc-item md-toc-h4" data-ref="c6609"><a class="md-toc-inner" href="#header-c6609">1.2 手控板获取按键信息逻辑</a></span><span class="md-toc-item md-toc-h6" data-ref="c6610"><a class="md-toc-inner" href="#header-c6610">原理</a></span><span class="md-toc-item md-toc-h6" data-ref="c6613"><a class="md-toc-inner" href="#header-c6613">相关按键信息</a></span><span class="md-toc-item md-toc-h6" data-ref="c6652"><a class="md-toc-inner" href="#header-c6652">信息获取逻辑</a></span><span class="md-toc-item md-toc-h4" data-ref="c6661"><a class="md-toc-inner" href="#header-c6661">1.3 芯片控制桌腿逻辑</a></span><span class="md-toc-item md-toc-h6" data-ref="c6662"><a class="md-toc-inner" href="#header-c6662">原理</a></span><span class="md-toc-item md-toc-h6" data-ref="c6681"><a class="md-toc-inner" href="#header-c6681">控制状态</a></span><span class="md-toc-item md-toc-h6" data-ref="c6695"><a class="md-toc-inner" href="#header-c6695">控制模式</a></span><span class="md-toc-item md-toc-h4" data-ref="c6772"><a class="md-toc-inner" href="#header-c6772">1.4 看门狗逻辑</a></span><span class="md-toc-item md-toc-h3" data-ref="c6784"><a class="md-toc-inner" href="#header-c6784">2.通讯协议</a></span><span class="md-toc-item md-toc-h4" data-ref="c6785"><a class="md-toc-inner" href="#header-c6785">2.1 蓝牙收/发通信协议</a></span><span class="md-toc-item md-toc-h4" data-ref="c6889"><a class="md-toc-inner" href="#header-c6889">2.2 捷昌控制盒数据协议</a></span><span class="md-toc-item md-toc-h2" data-ref="c6928"><a class="md-toc-inner" href="#header-c6928">三、具体代码讲解</a></span><span class="md-toc-item md-toc-h3" data-ref="c6929"><a class="md-toc-inner" href="#header-c6929">1.协议栈修改</a></span><span class="md-toc-item md-toc-h4" data-ref="c6932"><a class="md-toc-inner" href="#header-c6932">1.1 GATT层修改</a></span><span class="md-toc-item md-toc-h4" data-ref="c7183"><a class="md-toc-inner" href="#header-c7183">1.2 HAL层修改</a></span><span class="md-toc-item md-toc-h4" data-ref="c7222"><a class="md-toc-inner" href="#header-c7222">1.3 NPI函数的添改</a></span><span class="md-toc-item md-toc-h3" data-ref="c7290"><a class="md-toc-inner" href="#header-c7290">2.应用层逻辑实现</a></span><span class="md-toc-item md-toc-h4" data-ref="c7291"><a class="md-toc-inner" href="#header-c7291">前言</a></span><span class="md-toc-item md-toc-h5" data-ref="c7292"><a class="md-toc-inner" href="#header-c7292">应用层逻辑说明</a></span><span class="md-toc-item md-toc-h5" data-ref="c7312"><a class="md-toc-inner" href="#header-c7312">程序内部公共变量有效性验证</a></span><span class="md-toc-item md-toc-h4" data-ref="c8312"><a class="md-toc-inner" href="#header-c8312">2.1 周期性事件</a></span><span class="md-toc-item md-toc-h6" data-ref="c8315"><a class="md-toc-inner" href="#header-c8315">原理</a></span><span class="md-toc-item md-toc-h6" data-ref="c8347"><a class="md-toc-inner" href="#header-c8347">事件添加与实现</a></span><span class="md-toc-item md-toc-h5" data-ref="c8428"><a class="md-toc-inner" href="#header-c8428">2.1.1 桌腿控制</a></span><span class="md-toc-item md-toc-h5" data-ref="c8501"><a class="md-toc-inner" href="#header-c8501">2.1.2 手控板信息获取</a></span><span class="md-toc-item md-toc-h5" data-ref="c8557"><a class="md-toc-inner" href="#header-c8557">2.1.3 控制信号校准</a></span><span class="md-toc-item md-toc-h5" data-ref="c8583"><a class="md-toc-inner" href="#header-c8583">2.1.4 速度测算，用户姿态获得及高度信息发送</a></span><span class="md-toc-item md-toc-h5" data-ref="c8596"><a class="md-toc-inner" href="#header-c8596">2.1.5 喂狗</a></span><span class="md-toc-item md-toc-h5" data-ref="c9630"><a class="md-toc-inner" href="#header-c9630">2.1.6 发送当前时间戳及更新锁定状态</a></span><span class="md-toc-item md-toc-h4" data-ref="c9772"><a class="md-toc-inner" href="#header-c9772">2.2 非周期性事件</a></span><span class="md-toc-item md-toc-h5" data-ref="c8599"><a class="md-toc-inner" href="#header-c8599">2.2.1 一次性事件</a></span><span class="md-toc-item md-toc-h6" data-ref="c8600"><a class="md-toc-inner" href="#header-c8600">初始化事件</a></span><span class="md-toc-item md-toc-h6" data-ref="c10100"><a class="md-toc-inner" href="#header-c10100">超时停止事件</a></span><span class="md-toc-item md-toc-h5" data-ref="c8603"><a class="md-toc-inner" href="#header-c8603">2.2.2 蓝牙数据接收回调</a></span><span class="md-toc-item md-toc-h6" data-ref="c8604"><a class="md-toc-inner" href="#header-c8604">更改硬件信息回调</a></span><span class="md-toc-item md-toc-h6" data-ref="c10531"><a class="md-toc-inner" href="#header-c10531">更改记忆位置回调</a></span><span class="md-toc-item md-toc-h6" data-ref="c8606"><a class="md-toc-inner" href="#header-c8606">更改站坐阈值回调</a></span><span class="md-toc-item md-toc-h6" data-ref="c8607"><a class="md-toc-inner" href="#header-c8607">更改上下限回调</a></span><span class="md-toc-item md-toc-h6" data-ref="c8608"><a class="md-toc-inner" href="#header-c8608">控制指令接收回调</a></span><span class="md-toc-item md-toc-h6" data-ref="c10881"><a class="md-toc-inner" href="#header-c10881">更改锁定信息回调</a></span><span class="md-toc-item md-toc-h6" data-ref="c10447"><a class="md-toc-inner" href="#header-c10447">健康数据发送</a></span><span class="md-toc-item md-toc-h4" data-ref="c11043"><a class="md-toc-inner" href="#header-c11043">2.3 捷昌控制盒数据接收处理</a></span><span class="md-toc-item md-toc-h2" data-ref="c11451"><a class="md-toc-inner" href="#header-c11451">四、总结</a></span><span class="md-toc-item md-toc-h2" data-ref="c11481"><a class="md-toc-inner" href="#header-c11481">五、附录</a></span><span class="md-toc-item md-toc-h3" data-ref="c11484"><a class="md-toc-inner" href="#header-c11484">集成开发环境</a></span><span class="md-toc-item md-toc-h4" data-ref="c11506"><a class="md-toc-inner" href="#header-c11506">集成开发软件</a></span><span class="md-toc-item md-toc-h4" data-ref="c11505"><a class="md-toc-inner" href="#header-c11505">相关编译宏定义</a></span></p></div><h1><a name='header-c6424' class='md-header-anchor '></a>产品版本说明</h1><table><thead><tr><th><strong>产品版本</strong></th><th><strong>发布时间</strong></th><th><strong>产品说明</strong></th></tr></thead><tbody><tr><td>OW-02</td><td>2017-03-04</td><td>实现蓝牙数据传输功能以及对外设的控制</td></tr></tbody></table><h1><a name='header-c6434' class='md-header-anchor '></a>参考资料</h1><table><thead><tr><th style='text-align:left;' ><strong>资料名称</strong></th><th><strong>作者</strong></th></tr></thead><tbody><tr><td style='text-align:left;' >TI cc2540 协议栈</td><td>Texas Instrument</td></tr><tr><td style='text-align:left;' >JCB35N升降桌控制器 SCI通讯协议手控器部分</td><td>捷昌</td></tr></tbody></table><p> </p><h1><a name='header-c6447' class='md-header-anchor '></a>文档目的</h1><p>记录产品开发过程，总结产品开发经验，归档方便以后查阅。</p><h1><a name='header-c6450' class='md-header-anchor '></a>声明</h1><p>此文档仅用作内部交流用，不可外传。</p><h1><a name='header-c6453' class='md-header-anchor '></a>正文</h1><h2><a name='header-c6454' class='md-header-anchor '></a>一、软件需求</h2><h3><a name='header-c6455' class='md-header-anchor '></a>1.功能需求</h3><p>​	1.1 手控板通过智能模块连接到控制盒后可以正常地实现升降、动作到记忆位置、设置记忆位置等功能。</p><p>​	1.2 手机通过蓝牙连接到智能模块后可以正常地实现桌腿的升降、动作到记忆位置、设置记忆位置、锁定手控板等与桌腿相关的指令。手机通过蓝牙可以获得芯片记录的站坐姿态数据、上电时间戳、硬件信息、以及当前高度信息/错误提示信息。</p><h3><a name='header-c6460' class='md-header-anchor '></a>2.具体功能</h3><h4><a name='header-c6461' class='md-header-anchor '></a>2.1 芯片与捷昌控制盒</h4><p>​	2.1.1 在桌腿正常状态下，芯片从控制盒得到桌腿当前的高度信息，并且根据高度信息判断用户当前的使用姿态。</p><p>​	2.1.2 在桌腿非正常状态下，芯片从控制盒得到桌腿当前的错误信息。</p><p>​	2.1.3 芯片从手控板获得当前按下的按键信息，并根据按下的按键实现相应功能（上升、下降、停止等等……）。</p><p>​	2.1.4 芯片可以阻断手控板的按键信息传到控制盒（用于实现锁定手控板）。</p><h4><a name='header-c6470' class='md-header-anchor '></a>2.2 芯片与手机</h4><p>​	2.2.1 在桌腿正常状态下，芯片将得到的桌腿高度信息与通过计算获得的用户当前姿态以一定的格式一并发送到手机端。手机端也可以直接从芯片端读取桌腿的高度信息。</p><p>​	2.1.2 在桌腿非正常状态下，芯片将桌腿具体的错误提示信息经过处理后以一定的格式发送到手机端。手机端也可以直接从芯片端读取桌腿的错误提示信息。</p><p>​	2.1.3 手机可以以一定的格式发送控制指令到芯片端，使得芯片端在接收到指令后可以控制桌腿的上升、下降、停止动作等等……</p><p>​	2.1.4 手机可以以一定的格式发送控制指令到芯片端，使得芯片端可以发送用户的站坐信息数据到手机端。</p><p>​	2.1.5 手机可以以一定的格式发送数据到芯片端，使得芯片端可以更改桌腿动作的预设高度。手机端也可以直接从芯片端读取桌腿动作的预设高度。</p><p>​	2.1.6 手机可以以一定的格式发送数据到芯片端，使得芯片端可以更改判断用户站坐姿态的阈值。手机端也可以直接从芯片端读取判断用户站坐姿态的阈值。</p><p>	2.1.7 手机可以以一定的格式发送数据到芯片端，使得芯片端可以更改桌腿动作的上下限。手机端也可以直接从芯片端读取桌腿的动作的上下限。</p><p>​	2.1.8 手机可以以一定的格式发送数据到芯片端，使得芯片端可以更改手控板的锁定状态（可以延时锁定也可以立即锁定）。手机端也可以直接从芯片端读取手控板当前的锁定状态（解锁、锁定、延时锁定）。</p><p>	2.1.9 手机可以以一定的格式发送数据到芯片端，使得芯片端可以更改芯片内部存储的设备信息。手机端也可以直接从芯片端读取芯片内部存储的设备信息。</p><h2><a name='header-c6489' class='md-header-anchor '></a>二、需求实现</h2><h3><a name='header-c6490' class='md-header-anchor '></a>1.实现逻辑</h3><h4><a name='header-c6491' class='md-header-anchor '></a>1.1 蓝牙收发实现逻辑</h4><h5><a name='header-c6492' class='md-header-anchor '></a>1.1.1 从手机端获取数据逻辑</h5><h6><a name='header-c6493' class='md-header-anchor '></a>原理</h6><p>​	芯片端应用层从GATT层获取数据并进入数据接收的回调函数。</p><p>​	在GATT层即可分析出手机端发送的数据是通过哪一个特征值传入的，芯片端应用层即可根据特定的特征值进入特定的回调函数，并且将收到的数据通过GATT层的函数放入到已定义的相应大小的内存中。</p><h6><a name='header-c6498' class='md-header-anchor '></a>需要从手机端获取的数据</h6><ul><li><p>硬件信息：</p><p>​	包括桌腿类型、硬件设备类型以及版本号。这些数据可以帮助判断桌腿和控制盒的类型，方便针对不同的桌腿和控制盒类型来套用不同的桌腿控制算法。</p><p>​	这些数据应该写入到芯片端的非已逝性存储器中，如果中途断电，这些数据也不应丢失，这样的好处是对于同一个用户，如果断电再上电时没有APP连接，芯片可以直接调取上次所存储的桌腿及控制盒相关的信息以防由于硬件存储信息与真实设备不同时所造成的意外情况；这样做的缺陷是，如果用户换了不同类型的桌腿和控制盒，但使用的是同一个智能模块，这时就会出现硬件存储信息与真实设备不同的情况，此时，可以通过手机端设置来进行校准。</p><p>​	如果从未设置过这些信息，芯片端应存有默认的数值。</p></li><li><p>预设高度：</p><p>​	包含4个预设的高度数据，这个预设高度要与捷昌手控板上的预设高度存储值相对应。手机端可以任意修改其中的某一个或几个预设高度数据，如果手机端所设置的预设高度超过了设备所可以动作的上/下限，那么芯片端应自动将超过限制的预设值设置为设备所可以动作的上/下限。</p><p>​	这4个预设高度应存储在芯片端的非已逝性存储器当中，这样做的目的是，使得用户所设置的预设高度不会因为桌子断电而丢失。</p><p>​	如果从未设置过这些信息，芯片端应存有默认的数值。</p></li><li><p>站坐姿态判断阈值：</p><p>​	包括一个用于判断用户是站姿还是坐姿的高度阈值，因为判断一个用户是站还是坐需要根据用户的具体情况来定，所以需要手机端可以实时修改这个阈值。</p><p>​	这个高度值应存储在芯片端的非已逝性存储器当中，以防用户的高度判断阈值因为桌子断电而丢失。</p><p>​	如果从未设置过这些信息，芯片端应存有默认的数值。</p></li><li><p>桌子动作上下限</p><p>​	包括桌子动作的上限以及桌子动作的下限，这个数值可以限制手控板以及手机对桌腿的控制。使桌腿的动作范围控制在保证用户的正常使用的状态下。</p><p>​	这个高度值应存储在芯片端的非已逝性存储器当中，以防用户所设置过的上下限高度数值因为桌子断电而丢失。</p><p>​	如果从未设置过这些信息，芯片端应存有默认的数值。</p></li><li><p>控制指令：</p><p>​	包含一个控制指令，该指令可以让芯片控制桌腿上升、下降、停止、动作到预设高度（4个）以及让芯片发送用户的站坐统计数据。</p><p>​	当收到该指令时，判断如果指令不为“停止”，则开启一个500ms的定时器，在500ms之内如果再次收到该指令则重新计时500ms，否则定时器超时后直接将桌腿当前动作强行停止。</p></li><li><p>锁定状态及延时锁定时间：</p><p>​	包含一个锁定状态和需要延时锁定的时间数据，当手机端所发送的设定数据状态为非锁定状态时，无论延时锁定时间为多少，芯片端全部忽略并且设置芯片端为非解锁状态。当手机端所发送的设定数据状态为锁定状态且延时锁定时间为0时，芯片端立刻设置为锁定状态，无论是手控板还是手机端都无法再对桌腿进行控制。当手机端所发送的设定数据状态为锁定状态且延时锁时间不为0时，芯片端对延时时间进行倒计时，当时间未到0时，芯片端状态为解锁状态，而当时间倒计时到0时，芯片状态即设置为锁定状态。</p><p>​	桌子的锁定状态值应当存储在非易逝存储器当中，以防当用户断电后，桌子的锁定状态丢失。而无论什么情况下，如果桌子不处于永久性非解锁状态，断电重新上电后，都应该处于锁定状态，需要由手机端重新解锁。</p><p>​	如果从未设置过这些信息，芯片端应存有默认的数值。</p></li></ul><h5><a name='header-c6552' class='md-header-anchor '></a>1.1.2 芯片端发送数据逻辑</h5><h6><a name='header-c6553' class='md-header-anchor '></a>原理</h6><p>​	芯片应用层将所需要发送的数据和所需要的特征值通过GATT层发送出去。</p><p>​	GATT层可以根据提供的特征值参数调用相应的GATT参数设置函数，并且可以将所需要发送的数据作为参数传入到该设置函数中，这样即可将数据发送到手机端。</p><h6><a name='header-c6558' class='md-header-anchor '></a>需要发送到手机端的数据</h6><ul><li><p>硬件信息：</p><p>​	包括桌腿类型、硬件设备类型以及版本号。这些数据可以帮助判断桌腿和控制盒的类型，方便针对不同的桌腿和控制盒类型来套用不同的桌腿控制算法。</p><p>​	在硬件信息被修改及初始化时都应该将数据发送到手机端。</p></li><li><p>预设高度：</p><p>​	包含4个预设的高度数据，这个预设高度要与捷昌手控板上的预设高度存储值相对应。手机端可以任意修改其中的某一个或几个预设高度数据，如果手机端所设置的预设高度超过了设备所可以动作的上/下限，那么芯片端应自动将超过限制的预设值设置为设备所可以动作的上/下限。</p><p>​	在预设高度被修改及初始化时都应该将数据发送到手机端。</p></li><li><p>站坐姿判断阈值：</p><p>​	包括一个用于判断用户是站姿还是坐姿的高度阈值，因为判断一个用户是站还是坐需要根据用户的具体情况来定，所以需要手机端可以实时修改这个阈值。</p><p>​	在站坐姿判断阈值被修改及初始化时都应该将数据发送到手机端。</p></li><li><p>桌子动作上下限</p><p>​	包括桌子动作的上限以及桌子动作的下限，这个数值可以限制手控板以及手机对桌腿的控制。使桌腿的动作范围控制在保证用户的正常使用的状态下。	</p><p>​	在桌子动作上下限被修改及初始化时都应该将数据发送到APP端。</p></li><li><p>高度及状态：</p><p>​	包含桌子的状态（正常、错误、记忆位置），用户的站/坐姿态，高度信息、错误信息以及存储信息。</p><p>​	这个数据应在信息改变时及初始化时发送给手机端，且在连续变化时最小发送间隔为500ms。</p></li><li><p>锁定状态及延时锁时间：</p><p>​	包含一个锁定状态和需要延时锁定的时间数据。</p><p>​	这个数据应该在初始化、锁定状态改变以及每倒计时数据发生变化时发送到手机端。</p></li><li><p>开机时间戳：</p><p>​	包含一个从上电开始到运行状态的时间数据。</p><p>​	这个数据应该在每一次时间数据发生变化时发送到手机端。</p></li></ul><h4><a name='header-c6609' class='md-header-anchor '></a>1.2 手控板获取按键信息逻辑</h4><h6><a name='header-c6610' class='md-header-anchor '></a>原理</h6><p>​	捷昌的手控板在按键每一次变化的时候都会发出不同的电平信号，这些电平信号代表不同的信息。</p><h6><a name='header-c6613' class='md-header-anchor '></a>相关按键信息</h6><ul><li><p>按下上升按键：</p><p>​	立即使桌腿上升，松开时立刻停止桌腿动作。</p></li><li><p>按下下降按键：</p><p>​	立即使桌腿下降，松开时立刻停止桌腿动作。</p></li><li><p>按下S-1按键：</p><p>​	立即使桌腿动作到记忆位置1位置，松开时不会停止桌腿动作，直到桌腿动作到指定位置后或者在动作过程中按下其它按键才会停止动作。</p></li><li><p>按下S-2按键：</p><p>​	立即使桌腿动作到记忆位置2位置，松开时不会停止桌腿动作，直到桌腿动作到指定位置后或者在动作过程中按下其它按键才会停止动作。</p></li><li><p>按下S-3按键：</p><p>​	立即使桌腿动作到记忆位置3位置，松开时不会停止桌腿动作，直到桌腿动作到指定位置后或者在动作过程中按下其它按键才会停止动作。</p></li></ul><ul><li><p>按下S-4按键：</p><p>​	立即使桌腿动作到记忆位置4位置，松开时不会停止桌腿动作，直到桌腿动作到指定位置后或者在动作过程中按下其它按键才会停止动作。</p></li><li><p>按下S-按键：</p><p>​	立即在显示屏上显示S-，代表当前进入了设置状态，并保持6秒，在6秒之中如果按下S-1到S-4四个按键中任意一个按键都会显示S-“x”并且将当前的高度存入相应的记忆位置。如果在显示屏显示S-的6秒之内按下上升或者下降即会打断当前的设置状态。</p></li></ul><h6><a name='header-c6652' class='md-header-anchor '></a>信息获取逻辑</h6><p>​	芯片端获取按键信息的方法是轮询，每隔50ms检测一次手控板当前的按键信号，并根据得到的信号执行相应动作。</p><p> 	<strong>图2-1 单次轮询按键信息处理流程图：</strong><img src='handset%20logic.png' alt='handset logic' /></p><p>​	该逻辑流程每50ms执行一次，直到程序周期结束。</p><p>​	<strong>（*注：在轮询逻辑中所改变的状态也会在其他逻辑状态下使用，桌子当前动作状态、桌子之前动作状态、高度目标、桌子停止计数等）</strong></p><h4><a name='header-c6661' class='md-header-anchor '></a>1.3 芯片控制桌腿逻辑</h4><h6><a name='header-c6662' class='md-header-anchor '></a>原理</h6><ul><li><p>控制原理</p><p>​	芯片端的输出端口模拟捷昌的手控板电平信号给桌腿控制盒发送指令以达到控制桌腿的目的。</p></li><li><p>上下限实现原理</p><p>​	在接收到上升/下降指令后，立刻计算当前高度到高度最大值/最小值的差值，然后根据差值计算连续动作的持续时间，一旦超过计算的时间则立即停止动作，且无法继续朝限值方向操作。</p><p>​	重新接收到指令后，即重新计算停止时间。</p></li><li><p>动作到指定高度实现原理</p><p>​	在接收到动作到指定高度指令后，立刻将指定高度与高度最大值/最小值进行比较，如果超限的话，则将高度最大值/最小值设置为当前的指定高度，然后根据当前高度与指定高度的差值计算出连续动作的持续时间，一旦超过计算的时间则立即停止动作，且无法继续朝限值方向操作；而如果没有超限，则计算当前高度到指定高度的差值，根据差值计算出连续动作的持续时间，一旦超过计算时间则立即停止动作。</p></li></ul><h6><a name='header-c6681' class='md-header-anchor '></a>控制状态</h6><ul><li>上升</li><li>下降</li><li>动作到指定位置</li><li>停止</li></ul><h6><a name='header-c6695' class='md-header-anchor '></a>控制模式</h6><ul><li><p>控制模式说明</p><p>​控制桌腿动作可以通过两种通道，其一为手控板、其二为手机端的控制指令。无论是第一种还是第二种通道，当收到让桌腿的动作指令后，都改变芯片端的一个状态基，而在芯片控制的过程中，周期性地检测这个状态基的具体状态。当状态基的状态发生改变时，根据具体情况向控制盒发送控制指令。在执行控制时只有一个通道能够有效，两个通道的优先级相同，当一个通道被占用控制控制盒时，另一个通道在大多数情况无法打断当前通道的指令；除非当前通道的指令为动作到指定位置，在此情况下，任何通道的任何指令都可以打断当前的指令。</p><p>在状态基发生改变时，可以根据状态基状态得到控制状态，根据不同的控制状态设定一个预先停止桌子动作的函数，以便实现动作上下限以及动作到指定高度的功能。</p></li><li><p>不同通道的控制方式示意图</p><p><strong>图2-2 不同通道控制方式图 </strong></p></li></ul><p><img src='control%20command.png' alt='control command' /></p><ul><li><p>在控制桌腿升降时，由于控制盒以及桌腿的类型不同，所以对于每一种类型的设备都需要准备一套控制升降的算法。</p></li><li><p>现有的控制盒类型：</p><ul><li>英制双节腿</li><li>公制双节腿</li><li>英制三节腿</li><li>公制三节腿</li></ul></li><li><p>针对不同控制盒，计算桌腿应当动作的持续时间(多次实验计算结果)：</p><p><span class="MathJax_Preview"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="110.701ex" height="9.231ex" viewBox="0 -806.1 47662.7 3974.5" role="img" focusable="false" style="vertical-align: -7.359ex;"><defs><path stroke-width="1" id="E7-MJMATHI-56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path><path stroke-width="1" id="E7-MJMATHI-70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path><path stroke-width="1" id="E7-MJMATHI-65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path><path stroke-width="1" id="E7-MJMATHI-73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path><path stroke-width="1" id="E7-MJMATHI-6B" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path><path stroke-width="1" id="E7-MJMATHI-54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path><path stroke-width="1" id="E7-MJMATHI-6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path><path stroke-width="1" id="E7-MJMATHI-61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path stroke-width="1" id="E7-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path stroke-width="1" id="E7-MJMATHI-63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path><path stroke-width="1" id="E7-MJMATHI-69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E7-MJMATHI-62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path><path stroke-width="1" id="E7-MJMATHI-72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E7-MJMATHI-6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path><path stroke-width="1" id="E7-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E7-MJMATHI-48" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 219 683Q260 681 355 681Q389 681 418 681T463 682T483 682Q499 682 499 672Q499 670 497 658Q492 641 487 638H485Q483 638 480 638T473 638T464 637T455 637Q416 636 405 634T387 623Q384 619 355 500Q348 474 340 442T328 395L324 380Q324 378 469 378H614L615 381Q615 384 646 504Q674 619 674 627T617 637Q594 637 587 639T580 648Q580 650 582 660Q586 677 588 679T604 682Q609 682 646 681T740 680Q802 680 835 681T871 682Q888 682 888 672Q888 645 876 638H874Q872 638 869 638T862 638T853 637T844 637Q805 636 794 634T776 623Q773 618 704 340T634 58Q634 51 638 51Q646 48 692 46H723Q729 38 729 37T726 19Q722 6 716 0H701Q664 2 567 2Q533 2 504 2T458 2T437 1Q420 1 420 10Q420 15 423 24Q428 43 433 45Q437 46 448 46H454Q481 46 514 49Q520 50 522 50T528 55T534 64T540 82T547 110T558 153Q565 181 569 198Q602 330 602 331T457 332H312L279 197Q245 63 245 58Q245 51 253 49T303 46H334Q340 38 340 37T337 19Q333 6 327 0H312Q275 2 178 2Q144 2 115 2T69 2T48 1Q31 1 31 10Q31 12 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path><path stroke-width="1" id="E7-MJMATHI-6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E7-MJMATHI-78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path stroke-width="1" id="E7-MJMATHI-64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path><path stroke-width="1" id="E7-MJMATHI-66" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path><path stroke-width="1" id="E7-MJMATHI-75" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">注</text><g transform="translate(803,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">：</text></g><g transform="translate(1606,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-56" x="0" y="0"></use><g transform="translate(583,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-65" x="503" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-73" x="970" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-6B" x="1439" y="0"></use></g></g><g transform="translate(3676,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(4480,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">桌</text></g><g transform="translate(5283,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(6086,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">当</text></g><g transform="translate(6890,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">前</text></g><g transform="translate(7693,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">动</text></g><g transform="translate(8497,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">作</text></g><g transform="translate(9300,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">速</text></g><g transform="translate(10103,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">度</text></g><g transform="translate(10907,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(11710,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-54" x="0" y="0"></use><g transform="translate(584,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-6C" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-61" x="298" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-73" x="828" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-74" x="1297" y="0"></use></g></g><g transform="translate(13568,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(14371,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">控</text></g><g transform="translate(15174,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">制</text></g><g transform="translate(15978,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">动</text></g><g transform="translate(16781,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">作</text></g><g transform="translate(17584,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">的</text></g><g transform="translate(18388,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">持</text></g><g transform="translate(19191,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">续</text></g><g transform="translate(19994,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">时</text></g><g transform="translate(20798,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">间</text></g><g transform="translate(21601,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(22405,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-54" x="0" y="0"></use><g transform="translate(584,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-61" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-6C" x="963" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-69" x="1261" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-62" x="1607" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-72" x="2036" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-61" x="2488" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-74" x="3017" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-69" x="3379" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-6F" x="3724" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-6E" x="4210" y="0"></use></g></g><g transform="translate(26491,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(27294,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">校</text></g><g transform="translate(28097,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">准</text></g><g transform="translate(28901,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">后</text></g><g transform="translate(29704,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">控</text></g><g transform="translate(30507,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">制</text></g><g transform="translate(31311,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">动</text></g><g transform="translate(32114,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">作</text></g><g transform="translate(32917,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">的</text></g><g transform="translate(33721,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">持</text></g><g transform="translate(34524,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">续</text></g><g transform="translate(35328,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">时</text></g><g transform="translate(36131,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">间</text></g><g transform="translate(36934,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(37738,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-61" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-78" x="1408" y="0"></use></g></g><g transform="translate(40070,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(40873,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">桌</text></g><g transform="translate(41676,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">子</text></g><g transform="translate(42480,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">最</text></g><g transform="translate(43283,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">高</text></g><g transform="translate(44086,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">高</text></g><g transform="translate(44890,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">度</text></g><g transform="translate(45693,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(0,-1445)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-65" x="3658" y="0"></use></g><g transform="translate(3847,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(4651,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">目</text></g><g transform="translate(5454,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">的</text></g><g transform="translate(6258,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">高</text></g><g transform="translate(7061,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">度</text></g><g transform="translate(7864,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(8668,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-6C" x="2900" y="0"></use></g></g><g transform="translate(11861,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(12665,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">临</text></g><g transform="translate(13468,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">界</text></g><g transform="translate(14271,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">值</text></g><g transform="translate(15075,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">范</text></g><g transform="translate(15878,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">围</text></g><g transform="translate(16681,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(17485,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-69" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-6E" x="1224" y="0"></use></g></g><g transform="translate(19706,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(20510,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">桌</text></g><g transform="translate(21313,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">子</text></g><g transform="translate(22116,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">最</text></g><g transform="translate(22920,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">低</text></g><g transform="translate(23723,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">高</text></g><g transform="translate(24526,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">度</text></g><g transform="translate(25330,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(26133,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-155)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-69" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-66" x="869" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-66" x="1419" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-65" x="1970" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-72" x="2436" y="0"></use></g></g><g transform="translate(29107,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(29910,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">桌</text></g><g transform="translate(30714,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">子</text></g><g transform="translate(31517,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">当</text></g><g transform="translate(32320,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">前</text></g><g transform="translate(33124,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">高</text></g><g transform="translate(33927,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">度</text></g><g transform="translate(34730,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">到</text></g><g transform="translate(35534,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">目</text></g><g transform="translate(36337,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">标</text></g><g transform="translate(37140,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">高</text></g><g transform="translate(37944,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">度</text></g><g transform="translate(38747,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">的</text></g><g transform="translate(39551,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">差</text></g><g transform="translate(40354,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">值</text></g><g transform="translate(41157,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">，</text></g><g transform="translate(41961,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-75" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-72" x="1006" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-72" x="1457" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-65" x="1909" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-6E" x="2375" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E7-MJMATHI-74" x="2976" y="0"></use></g></g><g transform="translate(45252,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(46055,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">桌</text></g><g transform="translate(46859,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">子</text></g></g><g transform="translate(0,-2901)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">当</text><g transform="translate(803,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">前</text></g><g transform="translate(1606,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">高</text></g><g transform="translate(2410,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">度</text></g><g transform="translate(3213,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">。</text></g></g></g></svg></span><script type="math/tex" id="MathJax-Element-7">注：V_{pesk} 为桌腿当前动作速度 ，T_{last}为控制动作的持续时间，T_{calibration}为校准后控制动作的持续时间，H_{max}为桌子最高高度，\\H_{destinate}为目的高度，H_{critical}为临界值范围，H_{min}为桌子最低高度，H_{differ}为桌子当前高度到目标高度的差值，H_{current}为桌子\\当前高度。</script></p><div contenteditable="false" class="mathjax-block md-end-block" id="mathjax-c6735" cid="c6735" mdtype="math_block"><span class="MathJax_Preview"></span><span class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-21-Frame" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="66.527ex" height="19.854ex" viewBox="0 -4525.3 28643.6 8548.1" role="img" focusable="false" style="vertical-align: -9.343ex;"><defs><path stroke-width="1" id="E21-MJMAIN-5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path><path stroke-width="1" id="E21-MJMATHI-41" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path><path stroke-width="1" id="E21-MJMATHI-72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E21-MJMATHI-67" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path><path stroke-width="1" id="E21-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path stroke-width="1" id="E21-MJMAIN-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path stroke-width="1" id="E21-MJMAIN-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path stroke-width="1" id="E21-MJMAIN-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path stroke-width="1" id="E21-MJMAIN-5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path><path stroke-width="1" id="E21-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path stroke-width="1" id="E21-MJMAIN-7B" d="M434 -231Q434 -244 428 -250H410Q281 -250 230 -184Q225 -177 222 -172T217 -161T213 -148T211 -133T210 -111T209 -84T209 -47T209 0Q209 21 209 53Q208 142 204 153Q203 154 203 155Q189 191 153 211T82 231Q71 231 68 234T65 250T68 266T82 269Q116 269 152 289T203 345Q208 356 208 377T209 529V579Q209 634 215 656T244 698Q270 724 324 740Q361 748 377 749Q379 749 390 749T408 750H428Q434 744 434 732Q434 719 431 716Q429 713 415 713Q362 710 332 689T296 647Q291 634 291 499V417Q291 370 288 353T271 314Q240 271 184 255L170 250L184 245Q202 239 220 230T262 196T290 137Q291 131 291 1Q291 -134 296 -147Q306 -174 339 -192T415 -213Q429 -213 431 -216Q434 -219 434 -231Z"></path><path stroke-width="1" id="E21-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path stroke-width="1" id="E21-MJMAIN-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path stroke-width="1" id="E21-MJMAIN-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path stroke-width="1" id="E21-MJMAIN-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path><path stroke-width="1" id="E21-MJMAIN-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path stroke-width="1" id="E21-MJSZ4-23A7" d="M712 899L718 893V876V865Q718 854 704 846Q627 793 577 710T510 525Q510 524 509 521Q505 493 504 349Q504 345 504 334Q504 277 504 240Q504 -2 503 -4Q502 -8 494 -9T444 -10Q392 -10 390 -9Q387 -8 386 -5Q384 5 384 230Q384 262 384 312T383 382Q383 481 392 535T434 656Q510 806 664 892L677 899H712Z"></path><path stroke-width="1" id="E21-MJSZ4-23A9" d="M718 -893L712 -899H677L666 -893Q542 -825 468 -714T385 -476Q384 -466 384 -282Q384 3 385 5L389 9Q392 10 444 10Q486 10 494 9T503 4Q504 2 504 -239V-310V-366Q504 -470 508 -513T530 -609Q546 -657 569 -698T617 -767T661 -812T699 -843T717 -856T718 -876V-893Z"></path><path stroke-width="1" id="E21-MJSZ4-23A8" d="M389 1159Q391 1160 455 1160Q496 1160 498 1159Q501 1158 502 1155Q504 1145 504 924Q504 691 503 682Q494 549 425 439T243 259L229 250L243 241Q349 175 421 66T503 -182Q504 -191 504 -424Q504 -600 504 -629T499 -659H498Q496 -660 444 -660T390 -659Q387 -658 386 -655Q384 -645 384 -425V-282Q384 -176 377 -116T342 10Q325 54 301 92T255 155T214 196T183 222T171 232Q170 233 170 250T171 268Q171 269 191 284T240 331T300 407T354 524T383 679Q384 691 384 925Q384 1152 385 1155L389 1159Z"></path><path stroke-width="1" id="E21-MJSZ4-23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-5B" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMATHI-41" x="278" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMATHI-72" x="1029" y="0"></use><g transform="translate(1480,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-31" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-2C" x="2411" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMATHI-41" x="2857" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMATHI-72" x="3607" y="0"></use><g transform="translate(4059,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-32" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-2C" x="4990" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMATHI-41" x="5435" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMATHI-72" x="6186" y="0"></use><g transform="translate(6637,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-33" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-5D" x="7569" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-3D" x="8125" y="0"></use><g transform="translate(9181,0)"><g transform="translate(0,4452)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJSZ4-23A7" x="0" y="-900"></use><g transform="translate(0,-3256.2795031055903) scale(1,7.701863354037267)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJSZ4-23AA"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJSZ4-23A8" x="0" y="-4452"></use><g transform="translate(0,-7458.27950310559) scale(1,7.701863354037267)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJSZ4-23AA"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJSZ4-23A9" x="0" y="-7504"></use></g><g transform="translate(1056,0)"><g transform="translate(-15,0)"><g transform="translate(0,3652)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-5B" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-32" x="278" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-2C" x="779" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-32" x="1224" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-2C" x="1724" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-2212" x="2169" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-36" x="2948" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-5D" x="3448" y="0"></use></g><g transform="translate(0,1201)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-5B" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-32" x="278" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-2C" x="779" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-32" x="1224" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-2C" x="1724" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-33" x="2169" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-5D" x="2670" y="0"></use></g><g transform="translate(0,-1250)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-5B" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-32" x="278" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-2C" x="779" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-2212" x="1224" y="0"></use><g transform="translate(2002,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-33"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-30" x="500" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-2C" x="3003" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-37" x="3448" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-5D" x="3949" y="0"></use></g><g transform="translate(0,-3701)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-5B" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-32" x="278" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-2C" x="779" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-2212" x="1224" y="0"></use><g transform="translate(2002,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-32"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-35" x="500" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-2C" x="3003" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-2212" x="3448" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-37" x="4227" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E21-MJMAIN-5D" x="4727" y="0"></use></g></g><g transform="translate(6991,0)"><g transform="translate(0,3652)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">如</text><g transform="translate(803,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">果</text></g><g transform="translate(1606,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">桌</text></g><g transform="translate(2410,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(3213,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(4016,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">双</text></g><g transform="translate(4820,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">节</text></g><g transform="translate(5623,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(6426,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">且</text></g><g transform="translate(7230,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">动</text></g><g transform="translate(8033,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">作</text></g><g transform="translate(8836,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(9640,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">上</text></g><g transform="translate(10443,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">升</text></g></g><g transform="translate(0,1201)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">如</text><g transform="translate(803,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">果</text></g><g transform="translate(1606,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">桌</text></g><g transform="translate(2410,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(3213,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(4016,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">双</text></g><g transform="translate(4820,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">节</text></g><g transform="translate(5623,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(6426,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">且</text></g><g transform="translate(7230,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">动</text></g><g transform="translate(8033,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">作</text></g><g transform="translate(8836,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(9640,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">下</text></g><g transform="translate(10443,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">降</text></g></g><g transform="translate(0,-1250)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">如</text><g transform="translate(803,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">果</text></g><g transform="translate(1606,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">桌</text></g><g transform="translate(2410,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(3213,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(4016,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">三</text></g><g transform="translate(4820,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">节</text></g><g transform="translate(5623,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(6426,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">且</text></g><g transform="translate(7230,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">动</text></g><g transform="translate(8033,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">作</text></g><g transform="translate(8836,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(9640,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">上</text></g><g transform="translate(10443,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">升</text></g></g><g transform="translate(0,-3701)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">如</text><g transform="translate(803,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">果</text></g><g transform="translate(1606,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">桌</text></g><g transform="translate(2410,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(3213,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(4016,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">三</text></g><g transform="translate(4820,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">节</text></g><g transform="translate(5623,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(6426,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">且</text></g><g transform="translate(7230,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">动</text></g><g transform="translate(8033,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">作</text></g><g transform="translate(8836,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(9640,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">下</text></g><g transform="translate(10443,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">降</text></g></g></g></g></g></g></svg></span></span><script type="math/tex; mode=display" id="MathJax-Element-21">
[Arg_1, Arg_2, Arg_3]=
\begin{cases}
    [2,2,-6] &&\mbox{如果桌腿为双节腿且动作为上升}\\
   \\ [2,2,3] &&\mbox{如果桌腿为双节腿且动作为下降}\\
   \\ [2,-30,7] &&\mbox{如果桌腿为三节腿且动作为上升}\\
   \\ [2,-25,-7] &&\mbox{如果桌腿为三节腿且动作为下降}\\
   \end{cases}
</script></div><p>​										<strong>公式2-1</strong></p><p>​</p><div contenteditable="false" class="mathjax-block md-end-block" id="mathjax-c6740" cid="c6740" mdtype="math_block"><span class="MathJax_Preview"></span><span class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-22-Frame" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="46.243ex" height="14.251ex" viewBox="0 -3319.1 19910.3 6135.6" role="img" focusable="false" style="vertical-align: -6.542ex;"><defs><path stroke-width="1" id="E22-MJMATHI-41" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path><path stroke-width="1" id="E22-MJMATHI-72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E22-MJMATHI-67" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path><path stroke-width="1" id="E22-MJMAIN-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path stroke-width="1" id="E22-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path stroke-width="1" id="E22-MJMAIN-7B" d="M434 -231Q434 -244 428 -250H410Q281 -250 230 -184Q225 -177 222 -172T217 -161T213 -148T211 -133T210 -111T209 -84T209 -47T209 0Q209 21 209 53Q208 142 204 153Q203 154 203 155Q189 191 153 211T82 231Q71 231 68 234T65 250T68 266T82 269Q116 269 152 289T203 345Q208 356 208 377T209 529V579Q209 634 215 656T244 698Q270 724 324 740Q361 748 377 749Q379 749 390 749T408 750H428Q434 744 434 732Q434 719 431 716Q429 713 415 713Q362 710 332 689T296 647Q291 634 291 499V417Q291 370 288 353T271 314Q240 271 184 255L170 250L184 245Q202 239 220 230T262 196T290 137Q291 131 291 1Q291 -134 296 -147Q306 -174 339 -192T415 -213Q429 -213 431 -216Q434 -219 434 -231Z"></path><path stroke-width="1" id="E22-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path stroke-width="1" id="E22-MJMATHI-48" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 219 683Q260 681 355 681Q389 681 418 681T463 682T483 682Q499 682 499 672Q499 670 497 658Q492 641 487 638H485Q483 638 480 638T473 638T464 637T455 637Q416 636 405 634T387 623Q384 619 355 500Q348 474 340 442T328 395L324 380Q324 378 469 378H614L615 381Q615 384 646 504Q674 619 674 627T617 637Q594 637 587 639T580 648Q580 650 582 660Q586 677 588 679T604 682Q609 682 646 681T740 680Q802 680 835 681T871 682Q888 682 888 672Q888 645 876 638H874Q872 638 869 638T862 638T853 637T844 637Q805 636 794 634T776 623Q773 618 704 340T634 58Q634 51 638 51Q646 48 692 46H723Q729 38 729 37T726 19Q722 6 716 0H701Q664 2 567 2Q533 2 504 2T458 2T437 1Q420 1 420 10Q420 15 423 24Q428 43 433 45Q437 46 448 46H454Q481 46 514 49Q520 50 522 50T528 55T534 64T540 82T547 110T558 153Q565 181 569 198Q602 330 602 331T457 332H312L279 197Q245 63 245 58Q245 51 253 49T303 46H334Q340 38 340 37T337 19Q333 6 327 0H312Q275 2 178 2Q144 2 115 2T69 2T48 1Q31 1 31 10Q31 12 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path><path stroke-width="1" id="E22-MJMATHI-64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path><path stroke-width="1" id="E22-MJMATHI-65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path><path stroke-width="1" id="E22-MJMATHI-73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path><path stroke-width="1" id="E22-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path stroke-width="1" id="E22-MJMATHI-69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E22-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E22-MJMATHI-61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path stroke-width="1" id="E22-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path stroke-width="1" id="E22-MJMATHI-6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E22-MJMAIN-2265" d="M83 616Q83 624 89 630T99 636Q107 636 253 568T543 431T687 361Q694 356 694 346T687 331Q685 329 395 192L107 56H101Q83 58 83 76Q83 77 83 79Q82 86 98 95Q117 105 248 167Q326 204 378 228L626 346L360 472Q291 505 200 548Q112 589 98 597T83 616ZM84 -118Q84 -108 99 -98H678Q694 -104 694 -118Q694 -130 679 -138H98Q84 -131 84 -118Z"></path><path stroke-width="1" id="E22-MJMATHI-63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path><path stroke-width="1" id="E22-MJMATHI-6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path><path stroke-width="1" id="E22-MJMATHI-78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path stroke-width="1" id="E22-MJMAIN-2264" d="M674 636Q682 636 688 630T694 615T687 601Q686 600 417 472L151 346L399 228Q687 92 691 87Q694 81 694 76Q694 58 676 56H670L382 192Q92 329 90 331Q83 336 83 348Q84 359 96 365Q104 369 382 500T665 634Q669 636 674 636ZM84 -118Q84 -108 99 -98H678Q694 -104 694 -118Q694 -130 679 -138H98Q84 -131 84 -118Z"></path><path stroke-width="1" id="E22-MJMAIN-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path stroke-width="1" id="E22-MJMAIN-3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path><path stroke-width="1" id="E22-MJMAIN-3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path><path stroke-width="1" id="E22-MJSZ4-23A7" d="M712 899L718 893V876V865Q718 854 704 846Q627 793 577 710T510 525Q510 524 509 521Q505 493 504 349Q504 345 504 334Q504 277 504 240Q504 -2 503 -4Q502 -8 494 -9T444 -10Q392 -10 390 -9Q387 -8 386 -5Q384 5 384 230Q384 262 384 312T383 382Q383 481 392 535T434 656Q510 806 664 892L677 899H712Z"></path><path stroke-width="1" id="E22-MJSZ4-23A9" d="M718 -893L712 -899H677L666 -893Q542 -825 468 -714T385 -476Q384 -466 384 -282Q384 3 385 5L389 9Q392 10 444 10Q486 10 494 9T503 4Q504 2 504 -239V-310V-366Q504 -470 508 -513T530 -609Q546 -657 569 -698T617 -767T661 -812T699 -843T717 -856T718 -876V-893Z"></path><path stroke-width="1" id="E22-MJSZ4-23A8" d="M389 1159Q391 1160 455 1160Q496 1160 498 1159Q501 1158 502 1155Q504 1145 504 924Q504 691 503 682Q494 549 425 439T243 259L229 250L243 241Q349 175 421 66T503 -182Q504 -191 504 -424Q504 -600 504 -629T499 -659H498Q496 -660 444 -660T390 -659Q387 -658 386 -655Q384 -645 384 -425V-282Q384 -176 377 -116T342 10Q325 54 301 92T255 155T214 196T183 222T171 232Q170 233 170 250T171 268Q171 269 191 284T240 331T300 407T354 524T383 679Q384 691 384 925Q384 1152 385 1155L389 1159Z"></path><path stroke-width="1" id="E22-MJSZ4-23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-41" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-72" x="750" y="0"></use><g transform="translate(1202,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMAIN-34" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMAIN-3D" x="2411" y="0"></use><g transform="translate(3467,0)"><g transform="translate(0,3232)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJSZ4-23A7" x="0" y="-900"></use><g transform="translate(0,-2078.5677770429365) scale(1,3.9150089293985104)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJSZ4-23AA"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJSZ4-23A8" x="0" y="-3233"></use><g transform="translate(0,-5061.200652309257) scale(1,3.9150089293985104)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJSZ4-23AA"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJSZ4-23A9" x="0" y="-5066"></use></g><g transform="translate(1056,0)"><g transform="translate(-15,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMAIN-31" x="0" y="2432"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMAIN-30" x="0" y="-1250"></use></g><g transform="translate(2485,0)"><g transform="translate(0,2432)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-65" x="3658" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMAIN-2212" x="4070" y="0"></use><g transform="translate(5070,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-69" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-6E" x="1224" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMAIN-2265" x="7570" y="0"></use><g transform="translate(8626,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-6C" x="2900" y="0"></use></g></g><g transform="translate(0,-1316)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">或</text><g transform="translate(803,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-61" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-78" x="1408" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMAIN-2212" x="3357" y="0"></use><g transform="translate(4358,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-65" x="3658" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMAIN-2264" x="8483" y="0"></use><g transform="translate(9540,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-6C" x="2900" y="0"></use></g></g></g></g><g transform="translate(0,-1250)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-65" x="3658" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMAIN-2212" x="4070" y="0"></use><g transform="translate(5070,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-69" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-6E" x="1224" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMAIN-3C" x="7570" y="0"></use><g transform="translate(8626,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-6C" x="2900" y="0"></use></g></g><g transform="translate(0,-1316)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">或</text><g transform="translate(803,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-61" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-78" x="1408" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMAIN-2212" x="3357" y="0"></use><g transform="translate(4358,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-65" x="3658" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMAIN-3E" x="8483" y="0"></use><g transform="translate(9540,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E22-MJMATHI-6C" x="2900" y="0"></use></g></g></g></g></g></g></g></g></svg></span></span><script type="math/tex; mode=display" id="MathJax-Element-22">
Arg_4=
 \begin{cases}
    1 &&\mbox{$H_{destinate}-H_{min}\geq H_{critical}\\或H_{max}-H_{destinate}\leq H_{critical}$}\\
   \\0 &&\mbox{$H_{destinate}-H_{min}<H_{critical}\\或H_{max}-H_{destinate}>H_{critical}$}
   \end{cases}
</script></div><div contenteditable="false" class="mathjax-block md-end-block" id="mathjax-c6742" cid="c6742" mdtype="math_block"><span class="MathJax_Preview"></span><span class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-23-Frame" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="46.243ex" height="14.251ex" viewBox="0 -3319.1 19910.3 6135.6" role="img" focusable="false" style="vertical-align: -6.542ex;"><defs><path stroke-width="1" id="E23-MJMATHI-41" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path><path stroke-width="1" id="E23-MJMATHI-72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E23-MJMATHI-67" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path><path stroke-width="1" id="E23-MJMAIN-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path stroke-width="1" id="E23-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path stroke-width="1" id="E23-MJMAIN-7B" d="M434 -231Q434 -244 428 -250H410Q281 -250 230 -184Q225 -177 222 -172T217 -161T213 -148T211 -133T210 -111T209 -84T209 -47T209 0Q209 21 209 53Q208 142 204 153Q203 154 203 155Q189 191 153 211T82 231Q71 231 68 234T65 250T68 266T82 269Q116 269 152 289T203 345Q208 356 208 377T209 529V579Q209 634 215 656T244 698Q270 724 324 740Q361 748 377 749Q379 749 390 749T408 750H428Q434 744 434 732Q434 719 431 716Q429 713 415 713Q362 710 332 689T296 647Q291 634 291 499V417Q291 370 288 353T271 314Q240 271 184 255L170 250L184 245Q202 239 220 230T262 196T290 137Q291 131 291 1Q291 -134 296 -147Q306 -174 339 -192T415 -213Q429 -213 431 -216Q434 -219 434 -231Z"></path><path stroke-width="1" id="E23-MJMAIN-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path stroke-width="1" id="E23-MJMATHI-48" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 219 683Q260 681 355 681Q389 681 418 681T463 682T483 682Q499 682 499 672Q499 670 497 658Q492 641 487 638H485Q483 638 480 638T473 638T464 637T455 637Q416 636 405 634T387 623Q384 619 355 500Q348 474 340 442T328 395L324 380Q324 378 469 378H614L615 381Q615 384 646 504Q674 619 674 627T617 637Q594 637 587 639T580 648Q580 650 582 660Q586 677 588 679T604 682Q609 682 646 681T740 680Q802 680 835 681T871 682Q888 682 888 672Q888 645 876 638H874Q872 638 869 638T862 638T853 637T844 637Q805 636 794 634T776 623Q773 618 704 340T634 58Q634 51 638 51Q646 48 692 46H723Q729 38 729 37T726 19Q722 6 716 0H701Q664 2 567 2Q533 2 504 2T458 2T437 1Q420 1 420 10Q420 15 423 24Q428 43 433 45Q437 46 448 46H454Q481 46 514 49Q520 50 522 50T528 55T534 64T540 82T547 110T558 153Q565 181 569 198Q602 330 602 331T457 332H312L279 197Q245 63 245 58Q245 51 253 49T303 46H334Q340 38 340 37T337 19Q333 6 327 0H312Q275 2 178 2Q144 2 115 2T69 2T48 1Q31 1 31 10Q31 12 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path><path stroke-width="1" id="E23-MJMATHI-64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path><path stroke-width="1" id="E23-MJMATHI-65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path><path stroke-width="1" id="E23-MJMATHI-73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path><path stroke-width="1" id="E23-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path stroke-width="1" id="E23-MJMATHI-69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E23-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E23-MJMATHI-61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path stroke-width="1" id="E23-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path stroke-width="1" id="E23-MJMATHI-6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E23-MJMAIN-2265" d="M83 616Q83 624 89 630T99 636Q107 636 253 568T543 431T687 361Q694 356 694 346T687 331Q685 329 395 192L107 56H101Q83 58 83 76Q83 77 83 79Q82 86 98 95Q117 105 248 167Q326 204 378 228L626 346L360 472Q291 505 200 548Q112 589 98 597T83 616ZM84 -118Q84 -108 99 -98H678Q694 -104 694 -118Q694 -130 679 -138H98Q84 -131 84 -118Z"></path><path stroke-width="1" id="E23-MJMATHI-63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path><path stroke-width="1" id="E23-MJMATHI-6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path><path stroke-width="1" id="E23-MJMATHI-78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path stroke-width="1" id="E23-MJMAIN-2264" d="M674 636Q682 636 688 630T694 615T687 601Q686 600 417 472L151 346L399 228Q687 92 691 87Q694 81 694 76Q694 58 676 56H670L382 192Q92 329 90 331Q83 336 83 348Q84 359 96 365Q104 369 382 500T665 634Q669 636 674 636ZM84 -118Q84 -108 99 -98H678Q694 -104 694 -118Q694 -130 679 -138H98Q84 -131 84 -118Z"></path><path stroke-width="1" id="E23-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path stroke-width="1" id="E23-MJMAIN-3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path><path stroke-width="1" id="E23-MJMAIN-3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path><path stroke-width="1" id="E23-MJSZ4-23A7" d="M712 899L718 893V876V865Q718 854 704 846Q627 793 577 710T510 525Q510 524 509 521Q505 493 504 349Q504 345 504 334Q504 277 504 240Q504 -2 503 -4Q502 -8 494 -9T444 -10Q392 -10 390 -9Q387 -8 386 -5Q384 5 384 230Q384 262 384 312T383 382Q383 481 392 535T434 656Q510 806 664 892L677 899H712Z"></path><path stroke-width="1" id="E23-MJSZ4-23A9" d="M718 -893L712 -899H677L666 -893Q542 -825 468 -714T385 -476Q384 -466 384 -282Q384 3 385 5L389 9Q392 10 444 10Q486 10 494 9T503 4Q504 2 504 -239V-310V-366Q504 -470 508 -513T530 -609Q546 -657 569 -698T617 -767T661 -812T699 -843T717 -856T718 -876V-893Z"></path><path stroke-width="1" id="E23-MJSZ4-23A8" d="M389 1159Q391 1160 455 1160Q496 1160 498 1159Q501 1158 502 1155Q504 1145 504 924Q504 691 503 682Q494 549 425 439T243 259L229 250L243 241Q349 175 421 66T503 -182Q504 -191 504 -424Q504 -600 504 -629T499 -659H498Q496 -660 444 -660T390 -659Q387 -658 386 -655Q384 -645 384 -425V-282Q384 -176 377 -116T342 10Q325 54 301 92T255 155T214 196T183 222T171 232Q170 233 170 250T171 268Q171 269 191 284T240 331T300 407T354 524T383 679Q384 691 384 925Q384 1152 385 1155L389 1159Z"></path><path stroke-width="1" id="E23-MJSZ4-23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-41" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-72" x="750" y="0"></use><g transform="translate(1202,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMAIN-35" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMAIN-3D" x="2411" y="0"></use><g transform="translate(3467,0)"><g transform="translate(0,3232)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJSZ4-23A7" x="0" y="-900"></use><g transform="translate(0,-2078.5677770429365) scale(1,3.9150089293985104)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJSZ4-23AA"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJSZ4-23A8" x="0" y="-3233"></use><g transform="translate(0,-5061.200652309257) scale(1,3.9150089293985104)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJSZ4-23AA"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJSZ4-23A9" x="0" y="-5066"></use></g><g transform="translate(1056,0)"><g transform="translate(-15,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMAIN-30" x="0" y="2432"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMAIN-31" x="0" y="-1250"></use></g><g transform="translate(2485,0)"><g transform="translate(0,2432)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-65" x="3658" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMAIN-2212" x="4070" y="0"></use><g transform="translate(5070,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-69" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-6E" x="1224" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMAIN-2265" x="7570" y="0"></use><g transform="translate(8626,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-6C" x="2900" y="0"></use></g></g><g transform="translate(0,-1316)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">或</text><g transform="translate(803,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-61" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-78" x="1408" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMAIN-2212" x="3357" y="0"></use><g transform="translate(4358,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-65" x="3658" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMAIN-2264" x="8483" y="0"></use><g transform="translate(9540,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-6C" x="2900" y="0"></use></g></g></g></g><g transform="translate(0,-1250)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-65" x="3658" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMAIN-2212" x="4070" y="0"></use><g transform="translate(5070,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-69" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-6E" x="1224" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMAIN-3C" x="7570" y="0"></use><g transform="translate(8626,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-6C" x="2900" y="0"></use></g></g><g transform="translate(0,-1316)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">或</text><g transform="translate(803,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-61" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-78" x="1408" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMAIN-2212" x="3357" y="0"></use><g transform="translate(4358,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-65" x="3658" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMAIN-3E" x="8483" y="0"></use><g transform="translate(9540,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E23-MJMATHI-6C" x="2900" y="0"></use></g></g></g></g></g></g></g></g></svg></span></span><script type="math/tex; mode=display" id="MathJax-Element-23">
Arg_5=
 \begin{cases}
    0 &&\mbox{$H_{destinate}-H_{min}\geq H_{critical}\\或H_{max}-H_{destinate}\leq H_{critical}$}\\
   \\1 &&\mbox{$H_{destinate}-H_{min}<H_{critical}\\或H_{max}-H_{destinate}>H_{critical}$}
   \end{cases}
</script></div><p>​										<strong>公式2-2</strong></p><p>​</p><div contenteditable="false" class="mathjax-block md-end-block" id="mathjax-c6746" cid="c6746" mdtype="math_block"><span class="MathJax_Preview"></span><span class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-24-Frame" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="98.094ex" height="29.426ex" viewBox="0 -6586 42234.9 12669.3" role="img" focusable="false" style="vertical-align: -14.129ex;"><defs><path stroke-width="1" id="E24-MJMATHI-54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path><path stroke-width="1" id="E24-MJMATHI-6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path><path stroke-width="1" id="E24-MJMATHI-61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path stroke-width="1" id="E24-MJMATHI-73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path><path stroke-width="1" id="E24-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path stroke-width="1" id="E24-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path stroke-width="1" id="E24-MJMAIN-7B" d="M434 -231Q434 -244 428 -250H410Q281 -250 230 -184Q225 -177 222 -172T217 -161T213 -148T211 -133T210 -111T209 -84T209 -47T209 0Q209 21 209 53Q208 142 204 153Q203 154 203 155Q189 191 153 211T82 231Q71 231 68 234T65 250T68 266T82 269Q116 269 152 289T203 345Q208 356 208 377T209 529V579Q209 634 215 656T244 698Q270 724 324 740Q361 748 377 749Q379 749 390 749T408 750H428Q434 744 434 732Q434 719 431 716Q429 713 415 713Q362 710 332 689T296 647Q291 634 291 499V417Q291 370 288 353T271 314Q240 271 184 255L170 250L184 245Q202 239 220 230T262 196T290 137Q291 131 291 1Q291 -134 296 -147Q306 -174 339 -192T415 -213Q429 -213 431 -216Q434 -219 434 -231Z"></path><path stroke-width="1" id="E24-MJMATHI-48" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 219 683Q260 681 355 681Q389 681 418 681T463 682T483 682Q499 682 499 672Q499 670 497 658Q492 641 487 638H485Q483 638 480 638T473 638T464 637T455 637Q416 636 405 634T387 623Q384 619 355 500Q348 474 340 442T328 395L324 380Q324 378 469 378H614L615 381Q615 384 646 504Q674 619 674 627T617 637Q594 637 587 639T580 648Q580 650 582 660Q586 677 588 679T604 682Q609 682 646 681T740 680Q802 680 835 681T871 682Q888 682 888 672Q888 645 876 638H874Q872 638 869 638T862 638T853 637T844 637Q805 636 794 634T776 623Q773 618 704 340T634 58Q634 51 638 51Q646 48 692 46H723Q729 38 729 37T726 19Q722 6 716 0H701Q664 2 567 2Q533 2 504 2T458 2T437 1Q420 1 420 10Q420 15 423 24Q428 43 433 45Q437 46 448 46H454Q481 46 514 49Q520 50 522 50T528 55T534 64T540 82T547 110T558 153Q565 181 569 198Q602 330 602 331T457 332H312L279 197Q245 63 245 58Q245 51 253 49T303 46H334Q340 38 340 37T337 19Q333 6 327 0H312Q275 2 178 2Q144 2 115 2T69 2T48 1Q31 1 31 10Q31 12 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path><path stroke-width="1" id="E24-MJMATHI-64" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path><path stroke-width="1" id="E24-MJMATHI-69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E24-MJMATHI-66" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path><path stroke-width="1" id="E24-MJMATHI-65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path><path stroke-width="1" id="E24-MJMATHI-72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E24-MJMAIN-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path><path stroke-width="1" id="E24-MJMATHI-41" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path><path stroke-width="1" id="E24-MJMATHI-67" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path><path stroke-width="1" id="E24-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path stroke-width="1" id="E24-MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path stroke-width="1" id="E24-MJMAIN-F7" d="M318 466Q318 500 339 518T386 537Q418 537 438 517T458 466Q458 438 440 417T388 396Q355 396 337 417T318 466ZM56 237T56 250T70 270H706Q721 262 721 250T706 230H70Q56 237 56 250ZM318 34Q318 68 339 86T386 105Q418 105 438 85T458 34Q458 6 440 -15T388 -36Q355 -36 337 -15T318 34Z"></path><path stroke-width="1" id="E24-MJMAIN-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path stroke-width="1" id="E24-MJMAIN-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path stroke-width="1" id="E24-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E24-MJMAIN-2264" d="M674 636Q682 636 688 630T694 615T687 601Q686 600 417 472L151 346L399 228Q687 92 691 87Q694 81 694 76Q694 58 676 56H670L382 192Q92 329 90 331Q83 336 83 348Q84 359 96 365Q104 369 382 500T665 634Q669 636 674 636ZM84 -118Q84 -108 99 -98H678Q694 -104 694 -118Q694 -130 679 -138H98Q84 -131 84 -118Z"></path><path stroke-width="1" id="E24-MJMATHI-6D" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E24-MJMATHI-78" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path><path stroke-width="1" id="E24-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path stroke-width="1" id="E24-MJMATHI-63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path><path stroke-width="1" id="E24-MJMAIN-2265" d="M83 616Q83 624 89 630T99 636Q107 636 253 568T543 431T687 361Q694 356 694 346T687 331Q685 329 395 192L107 56H101Q83 58 83 76Q83 77 83 79Q82 86 98 95Q117 105 248 167Q326 204 378 228L626 346L360 472Q291 505 200 548Q112 589 98 597T83 616ZM84 -118Q84 -108 99 -98H678Q694 -104 694 -118Q694 -130 679 -138H98Q84 -131 84 -118Z"></path><path stroke-width="1" id="E24-MJMAIN-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path stroke-width="1" id="E24-MJMAIN-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path stroke-width="1" id="E24-MJMAIN-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path stroke-width="1" id="E24-MJMAIN-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path stroke-width="1" id="E24-MJMAIN-3E" d="M84 520Q84 528 88 533T96 539L99 540Q106 540 253 471T544 334L687 265Q694 260 694 250T687 235Q685 233 395 96L107 -40H101Q83 -38 83 -20Q83 -19 83 -17Q82 -10 98 -1Q117 9 248 71Q326 108 378 132L626 250L378 368Q90 504 86 509Q84 513 84 520Z"></path><path stroke-width="1" id="E24-MJMAIN-3C" d="M694 -11T694 -19T688 -33T678 -40Q671 -40 524 29T234 166L90 235Q83 240 83 250Q83 261 91 266Q664 540 678 540Q681 540 687 534T694 519T687 505Q686 504 417 376L151 250L417 124Q686 -4 687 -5Q694 -11 694 -19Z"></path><path stroke-width="1" id="E24-MJSZ4-23A7" d="M712 899L718 893V876V865Q718 854 704 846Q627 793 577 710T510 525Q510 524 509 521Q505 493 504 349Q504 345 504 334Q504 277 504 240Q504 -2 503 -4Q502 -8 494 -9T444 -10Q392 -10 390 -9Q387 -8 386 -5Q384 5 384 230Q384 262 384 312T383 382Q383 481 392 535T434 656Q510 806 664 892L677 899H712Z"></path><path stroke-width="1" id="E24-MJSZ4-23A9" d="M718 -893L712 -899H677L666 -893Q542 -825 468 -714T385 -476Q384 -466 384 -282Q384 3 385 5L389 9Q392 10 444 10Q486 10 494 9T503 4Q504 2 504 -239V-310V-366Q504 -470 508 -513T530 -609Q546 -657 569 -698T617 -767T661 -812T699 -843T717 -856T718 -876V-893Z"></path><path stroke-width="1" id="E24-MJSZ4-23A8" d="M389 1159Q391 1160 455 1160Q496 1160 498 1159Q501 1158 502 1155Q504 1145 504 924Q504 691 503 682Q494 549 425 439T243 259L229 250L243 241Q349 175 421 66T503 -182Q504 -191 504 -424Q504 -600 504 -629T499 -659H498Q496 -660 444 -660T390 -659Q387 -658 386 -655Q384 -645 384 -425V-282Q384 -176 377 -116T342 10Q325 54 301 92T255 155T214 196T183 222T171 232Q170 233 170 250T171 268Q171 269 191 284T240 331T300 407T354 524T383 679Q384 691 384 925Q384 1152 385 1155L389 1159Z"></path><path stroke-width="1" id="E24-MJSZ4-23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-54" x="0" y="0"></use><g transform="translate(584,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6C" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="298" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-73" x="828" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1297" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-3D" x="2135" y="0"></use><g transform="translate(3191,0)"><g transform="translate(0,6492)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJSZ4-23A7" x="0" y="-900"></use><g transform="translate(0,-5227.19949747957) scale(1,14.039226679998617)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJSZ4-23AA"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJSZ4-23A8" x="0" y="-6493"></use><g transform="translate(0,-11469.830488439125) scale(1,14.039226679998617)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJSZ4-23AA"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJSZ4-23A9" x="0" y="-11586"></use></g><g transform="translate(1056,0)"><g transform="translate(-15,0)"><g transform="translate(0,5692)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-155)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="869" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="1419" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="1970" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="2436" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-D7" x="3195" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-41" x="4196" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="4947" y="0"></use><g transform="translate(5398,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-31" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2B" x="6552" y="0"></use><g transform="translate(7552,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-155)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="869" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="1419" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="1970" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="2436" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-F7" x="10748" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-41" x="11749" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="12499" y="0"></use><g transform="translate(12951,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-32" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2B" x="14105" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-41" x="15105" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="15856" y="0"></use><g transform="translate(16307,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-33" x="675" y="-213"></use></g></g><g transform="translate(0,2009)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-28" x="0" y="0"></use><g transform="translate(389,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-155)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="869" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="1419" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="1970" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="2436" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-D7" x="3585" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-41" x="4586" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="5336" y="0"></use><g transform="translate(5788,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-31" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2B" x="6941" y="0"></use><g transform="translate(7942,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-155)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="869" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="1419" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="1970" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="2436" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-F7" x="11138" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-41" x="12138" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="12889" y="0"></use><g transform="translate(13340,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-32" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2B" x="14494" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-41" x="15495" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="16245" y="0"></use><g transform="translate(16697,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-33" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-29" x="17628" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-D7" x="18240" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-41" x="19241" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="19991" y="0"></use><g transform="translate(20443,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-34" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2B" x="21374" y="0"></use></g><g transform="translate(0,709)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-28" x="0" y="0"></use><g transform="translate(389,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-155)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="869" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="1419" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="1970" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="2436" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2212" x="3585" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-28" x="4586" y="0"></use><g transform="translate(4975,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="3658" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2212" x="9045" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-28" x="10046" y="0"></use><g transform="translate(10435,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-78" x="1408" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2212" x="12990" y="0"></use><g transform="translate(13990,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6C" x="2900" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-29" x="17184" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-29" x="17573" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-29" x="17963" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-D7" x="18575" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-41" x="19575" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="20326" y="0"></use><g transform="translate(20777,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-35" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-D7" x="21931" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-33" x="22932" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2B" x="23432" y="0"></use></g><g transform="translate(0,-591)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-28" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-28" x="389" y="0"></use><g transform="translate(779,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="3658" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2212" x="4849" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-28" x="5849" y="0"></use><g transform="translate(6239,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-78" x="1408" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2212" x="8793" y="0"></use><g transform="translate(9794,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6C" x="2900" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-29" x="12987" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-29" x="13377" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2212" x="13989" y="0"></use><g transform="translate(14989,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-155)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="869" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="1419" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="1970" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="2436" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-29" x="17963" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-D7" x="18575" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-41" x="19575" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="20326" y="0"></use><g transform="translate(20777,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-34" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-D7" x="21931" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-33" x="22932" y="0"></use></g><g transform="translate(0,-3092)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-28" x="0" y="0"></use><g transform="translate(389,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-155)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="869" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="1419" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="1970" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="2436" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-D7" x="3585" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-41" x="4586" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="5336" y="0"></use><g transform="translate(5788,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-31" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2B" x="6941" y="0"></use><g transform="translate(7942,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-155)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="869" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="1419" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="1970" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="2436" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-F7" x="11138" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-41" x="12138" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="12889" y="0"></use><g transform="translate(13340,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-32" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2B" x="14494" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-41" x="15495" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="16245" y="0"></use><g transform="translate(16697,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-33" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-29" x="17628" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-D7" x="18240" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-41" x="19241" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="19991" y="0"></use><g transform="translate(20443,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-34" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2B" x="21374" y="0"></use></g><g transform="translate(0,-4392)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-28" x="0" y="0"></use><g transform="translate(389,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-155)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="869" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="1419" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="1970" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="2436" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2212" x="3585" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-28" x="4586" y="0"></use><g transform="translate(4975,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="3658" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2212" x="9045" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-28" x="10046" y="0"></use><g transform="translate(10435,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6E" x="1224" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2B" x="12879" y="0"></use><g transform="translate(13880,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6C" x="2900" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-29" x="17074" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-29" x="17463" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-29" x="17853" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-D7" x="18464" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-41" x="19465" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="20216" y="0"></use><g transform="translate(20667,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-35" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-D7" x="21821" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-33" x="22821" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2B" x="23322" y="0"></use></g><g transform="translate(0,-5693)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-28" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-28" x="389" y="0"></use><g transform="translate(779,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="3658" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2212" x="4849" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-28" x="5849" y="0"></use><g transform="translate(6239,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6E" x="1224" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2B" x="8683" y="0"></use><g transform="translate(9683,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6C" x="2900" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-29" x="12877" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-29" x="13267" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2212" x="13878" y="0"></use><g transform="translate(14879,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-155)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="869" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-66" x="1419" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="1970" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="2436" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-29" x="17853" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-D7" x="18464" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-41" x="19465" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="20216" y="0"></use><g transform="translate(20667,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-34" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-D7" x="21821" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-33" x="22821" y="0"></use></g></g><g transform="translate(25196,0)"><g transform="translate(0,5692)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="3658" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2264" x="4125" y="0"></use><g transform="translate(5182,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-78" x="1408" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2212" x="7736" y="0"></use><g transform="translate(8736,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6C" x="2900" y="0"></use></g></g><g transform="translate(0,-1316)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">或</text><g transform="translate(803,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="3658" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2265" x="4929" y="0"></use><g transform="translate(5985,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6E" x="1224" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2B" x="8429" y="0"></use><g transform="translate(9429,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6C" x="2900" y="0"></use></g></g></g></g><g transform="translate(0,-591)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="3658" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-3E" x="4125" y="0"></use><g transform="translate(5182,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-78" x="1408" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2212" x="7736" y="0"></use><g transform="translate(8736,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6C" x="2900" y="0"></use></g></g></g><g transform="translate(0,-5693)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="523" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-73" x="990" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="1821" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6E" x="2166" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="2767" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="3296" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-65" x="3658" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-3C" x="4125" y="0"></use><g transform="translate(5182,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="878" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6E" x="1224" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMAIN-2B" x="7625" y="0"></use><g transform="translate(8626,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-48" x="0" y="0"></use><g transform="translate(831,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-72" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="885" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-74" x="1230" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-69" x="1591" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-63" x="1937" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-61" x="2371" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E24-MJMATHI-6C" x="2900" y="0"></use></g></g></g></g></g></g></g></svg></span></span><script type="math/tex; mode=display" id="MathJax-Element-24">
T_{last}=
 \begin{cases}
    H_{differ} \times Arg_1 + H_{differ} \div Arg_2 + Arg_3 &\mbox{$H_{destinate}\leq H_{max}-H_{critical}\\或H_{destinate}\geq H_{min}+H_{critical}$}\\
   \\(H_{differ} \times Arg_1 + H_{differ} \div Arg_2+Arg_3)\times Arg_4+\\(H_{differ}-(H_{destinate}-(H_{max}-H_{critical})))\times Arg_5\times 3 +\\((H_{destinate}-(H_{max}-H_{critical}))-H_{differ})\times Arg_4\times 3 &\mbox{$H_{destinate}>H_{max}-H_{critical}$}\\
   \\(H_{differ} \times Arg_1 + H_{differ} \div Arg_2+Arg_3)\times Arg_4+\\(H_{differ}-(H_{destinate}-(H_{min}+H_{critical})))\times Arg_5\times 3+\\((H_{destinate}-(H_{min}+H_{critical}))-H_{differ})\times Arg_4\times 3 &\mbox{$H_{destinate}<H_{min}+H_{critical}$}
   \end{cases}
</script></div><p>​										<strong>公式2-3</strong></p><p>​</p><p>​	为了保证动作过程的准确性，还需要每200ms进行动作持续时间的校准，在校准过程中，因为桌腿不为静止状态，所以还需要加入速度参量才可以准确计算校准过后的动作持续时间。</p><p>​	所以有：</p><div contenteditable="false" class="mathjax-block md-end-block" id="mathjax-c6755" cid="c6755" mdtype="math_block"><span class="MathJax_Preview"></span><span class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-25-Frame" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="54.726ex" height="19.854ex" viewBox="0 -4525.3 23562.4 8548.1" role="img" focusable="false" style="vertical-align: -9.343ex;"><defs><path stroke-width="1" id="E25-MJMAIN-5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path><path stroke-width="1" id="E25-MJMATHI-41" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path><path stroke-width="1" id="E25-MJMATHI-72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E25-MJMATHI-67" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path><path stroke-width="1" id="E25-MJMAIN-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path stroke-width="1" id="E25-MJMAIN-2C" d="M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"></path><path stroke-width="1" id="E25-MJMAIN-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path><path stroke-width="1" id="E25-MJMAIN-5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path><path stroke-width="1" id="E25-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path stroke-width="1" id="E25-MJMAIN-7B" d="M434 -231Q434 -244 428 -250H410Q281 -250 230 -184Q225 -177 222 -172T217 -161T213 -148T211 -133T210 -111T209 -84T209 -47T209 0Q209 21 209 53Q208 142 204 153Q203 154 203 155Q189 191 153 211T82 231Q71 231 68 234T65 250T68 266T82 269Q116 269 152 289T203 345Q208 356 208 377T209 529V579Q209 634 215 656T244 698Q270 724 324 740Q361 748 377 749Q379 749 390 749T408 750H428Q434 744 434 732Q434 719 431 716Q429 713 415 713Q362 710 332 689T296 647Q291 634 291 499V417Q291 370 288 353T271 314Q240 271 184 255L170 250L184 245Q202 239 220 230T262 196T290 137Q291 131 291 1Q291 -134 296 -147Q306 -174 339 -192T415 -213Q429 -213 431 -216Q434 -219 434 -231Z"></path><path stroke-width="1" id="E25-MJMAIN-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path stroke-width="1" id="E25-MJMAIN-39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path><path stroke-width="1" id="E25-MJMAIN-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path stroke-width="1" id="E25-MJMAIN-30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path><path stroke-width="1" id="E25-MJMAIN-35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path><path stroke-width="1" id="E25-MJMAIN-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path stroke-width="1" id="E25-MJSZ4-23A7" d="M712 899L718 893V876V865Q718 854 704 846Q627 793 577 710T510 525Q510 524 509 521Q505 493 504 349Q504 345 504 334Q504 277 504 240Q504 -2 503 -4Q502 -8 494 -9T444 -10Q392 -10 390 -9Q387 -8 386 -5Q384 5 384 230Q384 262 384 312T383 382Q383 481 392 535T434 656Q510 806 664 892L677 899H712Z"></path><path stroke-width="1" id="E25-MJSZ4-23A9" d="M718 -893L712 -899H677L666 -893Q542 -825 468 -714T385 -476Q384 -466 384 -282Q384 3 385 5L389 9Q392 10 444 10Q486 10 494 9T503 4Q504 2 504 -239V-310V-366Q504 -470 508 -513T530 -609Q546 -657 569 -698T617 -767T661 -812T699 -843T717 -856T718 -876V-893Z"></path><path stroke-width="1" id="E25-MJSZ4-23A8" d="M389 1159Q391 1160 455 1160Q496 1160 498 1159Q501 1158 502 1155Q504 1145 504 924Q504 691 503 682Q494 549 425 439T243 259L229 250L243 241Q349 175 421 66T503 -182Q504 -191 504 -424Q504 -600 504 -629T499 -659H498Q496 -660 444 -660T390 -659Q387 -658 386 -655Q384 -645 384 -425V-282Q384 -176 377 -116T342 10Q325 54 301 92T255 155T214 196T183 222T171 232Q170 233 170 250T171 268Q171 269 191 284T240 331T300 407T354 524T383 679Q384 691 384 925Q384 1152 385 1155L389 1159Z"></path><path stroke-width="1" id="E25-MJSZ4-23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-5B" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMATHI-41" x="278" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMATHI-72" x="1029" y="0"></use><g transform="translate(1480,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-36" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-2C" x="2411" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMATHI-41" x="2857" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMATHI-72" x="3607" y="0"></use><g transform="translate(4059,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-37" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-5D" x="4990" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-3D" x="5546" y="0"></use><g transform="translate(6603,0)"><g transform="translate(0,4452)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJSZ4-23A7" x="0" y="-900"></use><g transform="translate(0,-3256.2795031055903) scale(1,7.701863354037267)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJSZ4-23AA"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJSZ4-23A8" x="0" y="-4452"></use><g transform="translate(0,-7458.27950310559) scale(1,7.701863354037267)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJSZ4-23AA"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJSZ4-23A9" x="0" y="-7504"></use></g><g transform="translate(1056,0)"><g transform="translate(-15,0)"><g transform="translate(0,3652)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-5B" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-33" x="278" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-2C" x="779" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-39" x="1224" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-5D" x="1724" y="0"></use></g><g transform="translate(0,1201)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-5B" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-33" x="278" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-2C" x="779" y="0"></use><g transform="translate(1224,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-31"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-30" x="500" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-5D" x="2225" y="0"></use></g><g transform="translate(0,-1250)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-5B" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-35" x="278" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-2C" x="779" y="0"></use><g transform="translate(1224,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-31"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-33" x="500" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-5D" x="2225" y="0"></use></g><g transform="translate(0,-3701)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-5B" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-35" x="278" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-2C" x="779" y="0"></use><g transform="translate(1224,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-31"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-34" x="500" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E25-MJMAIN-5D" x="2225" y="0"></use></g></g><g transform="translate(4488,0)"><g transform="translate(0,3652)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">如</text><g transform="translate(803,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">果</text></g><g transform="translate(1606,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">桌</text></g><g transform="translate(2410,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(3213,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(4016,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">双</text></g><g transform="translate(4820,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">节</text></g><g transform="translate(5623,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(6426,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">且</text></g><g transform="translate(7230,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">动</text></g><g transform="translate(8033,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">作</text></g><g transform="translate(8836,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(9640,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">上</text></g><g transform="translate(10443,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">升</text></g></g><g transform="translate(0,1201)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">如</text><g transform="translate(803,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">果</text></g><g transform="translate(1606,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">桌</text></g><g transform="translate(2410,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(3213,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(4016,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">双</text></g><g transform="translate(4820,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">节</text></g><g transform="translate(5623,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(6426,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">且</text></g><g transform="translate(7230,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">动</text></g><g transform="translate(8033,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">作</text></g><g transform="translate(8836,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(9640,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">下</text></g><g transform="translate(10443,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">降</text></g></g><g transform="translate(0,-1250)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">如</text><g transform="translate(803,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">果</text></g><g transform="translate(1606,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">桌</text></g><g transform="translate(2410,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(3213,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(4016,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">三</text></g><g transform="translate(4820,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">节</text></g><g transform="translate(5623,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(6426,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">且</text></g><g transform="translate(7230,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">动</text></g><g transform="translate(8033,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">作</text></g><g transform="translate(8836,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(9640,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">上</text></g><g transform="translate(10443,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">升</text></g></g><g transform="translate(0,-3701)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">如</text><g transform="translate(803,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">果</text></g><g transform="translate(1606,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">桌</text></g><g transform="translate(2410,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(3213,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(4016,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">三</text></g><g transform="translate(4820,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">节</text></g><g transform="translate(5623,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">腿</text></g><g transform="translate(6426,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">且</text></g><g transform="translate(7230,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">动</text></g><g transform="translate(8033,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">作</text></g><g transform="translate(8836,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">为</text></g><g transform="translate(9640,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">下</text></g><g transform="translate(10443,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(50.259) matrix(1 0 0 -1 0 0)">降</text></g></g></g></g></g></g></svg></span></span><script type="math/tex; mode=display" id="MathJax-Element-25">
[Arg_6, Arg_7]=
\begin{cases}
    [3,9] &&\mbox{如果桌腿为双节腿且动作为上升}\\
   \\ [3,10] &&\mbox{如果桌腿为双节腿且动作为下降}\\
   \\ [5,13] &&\mbox{如果桌腿为三节腿且动作为上升}\\
   \\ [5,14] &&\mbox{如果桌腿为三节腿且动作为下降}\\
   \end{cases}
</script></div><div contenteditable="false" class="mathjax-block md-end-block" id="mathjax-c6757" cid="c6757" mdtype="math_block"><span class="MathJax_Preview"></span><span class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-26-Frame" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="40.142ex" height="2.694ex" viewBox="0 -806.1 17283.5 1160" role="img" focusable="false" style="vertical-align: -0.822ex;"><defs><path stroke-width="1" id="E26-MJMATHI-54" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path><path stroke-width="1" id="E26-MJMATHI-63" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path><path stroke-width="1" id="E26-MJMATHI-61" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path><path stroke-width="1" id="E26-MJMATHI-6C" d="M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"></path><path stroke-width="1" id="E26-MJMATHI-69" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E26-MJMATHI-62" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path><path stroke-width="1" id="E26-MJMATHI-72" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E26-MJMATHI-74" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path><path stroke-width="1" id="E26-MJMATHI-6F" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path><path stroke-width="1" id="E26-MJMATHI-6E" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path><path stroke-width="1" id="E26-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path stroke-width="1" id="E26-MJMATHI-73" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path><path stroke-width="1" id="E26-MJMAIN-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path stroke-width="1" id="E26-MJMATHI-56" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"></path><path stroke-width="1" id="E26-MJMATHI-70" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path><path stroke-width="1" id="E26-MJMATHI-65" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path><path stroke-width="1" id="E26-MJMATHI-6B" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path><path stroke-width="1" id="E26-MJMAIN-F7" d="M318 466Q318 500 339 518T386 537Q418 537 438 517T458 466Q458 438 440 417T388 396Q355 396 337 417T318 466ZM56 237T56 250T70 270H706Q721 262 721 250T706 230H70Q56 237 56 250ZM318 34Q318 68 339 86T386 105Q418 105 438 85T458 34Q458 6 440 -15T388 -36Q355 -36 337 -15T318 34Z"></path><path stroke-width="1" id="E26-MJMATHI-41" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path><path stroke-width="1" id="E26-MJMATHI-67" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path><path stroke-width="1" id="E26-MJMAIN-36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path><path stroke-width="1" id="E26-MJMAIN-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path><path stroke-width="1" id="E26-MJMAIN-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-54" x="0" y="0"></use><g transform="translate(584,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-61" x="433" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-6C" x="963" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-69" x="1261" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-62" x="1607" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-72" x="2036" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-61" x="2488" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-74" x="3017" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-69" x="3379" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-6F" x="3724" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-6E" x="4210" y="0"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMAIN-3D" x="4363" y="0"></use><g transform="translate(5420,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-54" x="0" y="0"></use><g transform="translate(584,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-6C" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-61" x="298" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-73" x="828" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-74" x="1297" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMAIN-2212" x="7499" y="0"></use><g transform="translate(8500,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-56" x="0" y="0"></use><g transform="translate(583,-150)"><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-65" x="503" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-73" x="970" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-6B" x="1439" y="0"></use></g></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMAIN-F7" x="10792" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-41" x="11793" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-72" x="12544" y="0"></use><g transform="translate(12995,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMAIN-36" x="675" y="-213"></use></g><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMAIN-D7" x="14149" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-41" x="15150" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-72" x="15900" y="0"></use><g transform="translate(16352,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E26-MJMAIN-37" x="675" y="-213"></use></g></g></svg></span></span><script type="math/tex; mode=display" id="MathJax-Element-26">
T_{calibration}=T_{last}-V_{pesk}\div Arg_6 \times Arg_7
</script></div><p>​										<strong>公式2-4</strong></p><p>​</p><p>	<strong>（*注：在控制盒为英制时，所有的高度值皆需要转化成为公制以后再进行以上计算。）</strong></p></li></ul><ul><li><p>桌腿控制流程图</p><p><strong>图2-3 桌腿控制流程示意图：</strong></p></li></ul><p><img src='peskmove%20ctrl.png' alt='peskmove ctrl' /></p><h4><a name='header-c6772' class='md-header-anchor '></a>1.4 看门狗逻辑</h4><ul><li><p>目的</p><p>​	加入看门狗是为了防止程序跑飞，进入非正常状态且无法自己恢复。</p></li><li><p>看门狗添加逻辑</p><p>​	在程序初始化阶段加入看门狗，看门狗超时时间为1000ms，之后每500ms喂一次狗，如果1000ms内，没有走到500ms内的喂狗程序，看门狗会自动重启芯片以确保程序1000ms内不会跑飞。</p></li></ul><h3><a name='header-c6784' class='md-header-anchor '></a>2.通讯协议</h3><h4><a name='header-c6785' class='md-header-anchor '></a>2.1 蓝牙收/发通信协议</h4><ul><li><p>蓝牙数据收/发协议</p><p><strong>表2-1 蓝牙数据收/发协议表</strong></p></li></ul><p><img src='table1.png' alt='table1' /></p><ul><li><p>关于各个特征值数据的解释：</p><ul><li><p>FFF0：硬件信息（存入snv）</p><p>	手机端通过读取特征值FFF0可以得到当前设备的硬件信息，这些硬件信息全部都写在非易失性存储器中。断电后，硬件信息依然保存在设备中。由于现有版本的设备无法识别桌腿的类型，所以加入写的属性可以通过APP来设定该设备的桌腿类型。</p><p>	硬件信息包括：桌腿类型（包括控制盒类型）、设备类型（Cube\Bar）、具体版本信息（两个字节组成）。</p></li></ul><p><img src='peskinfo.png' alt='peskinfo' /></p><ul><li><p>FFF1：高度及状态</p><p>​	手机端可以直接通过读取该特征值的数据来得到当前桌子的信息，包括：高度值、桌子信息、人体姿态信息、以及桌子错误信息。而高度值 = 高度高位x256 + 高度地位（十进制）。具体的错误信息以及人体姿态信息见下表。</p><p><strong>表2-2 错误信息及人体姿态信息表</strong></p></li></ul><p> <img src='table2.png' alt='table1' /></p><ul><li><p>FFF2：站坐姿态判断阈值（存入snv中）</p><p>​	该特征值用于更改设备的站坐判断阈值，应用于某些特殊的场合，比如身高比较特殊的用户以及不同单位制的控制盒。</p><p>​	<em>注：该值也可以从设备读到APP中。</em></p></li><li><p>FFF3：桌子动作上下限（存入snv中）</p><p>​	该特征值可以设置/读取桌子动作的上限/下限。格式为：动作阈值上限H 动作阈值上限L 动作阈值下限H 动作阈值下限L。</p><p>​	其中真实高度数据 = 数据H * 256 + 数据L 。 </p><p>​	<em>在设置桌子动作上下限时，如果数据值为0，则忽略该数据的设置。</em></p></li><li><p>FFF4：控制指令</p><ul><li><p>控制指令分为多种指令：</p><ul><li>基础指令：上升、下降、停止</li><li>到达预设高度指令：预设0、预设1、预设2、预设3</li><li>进阶指令：获取健康数据、等等……</li></ul></li><li><p>指令表格如下：</p><p>​		<strong>表2-3 指令信息表</strong></p><p><img src='table3.png' alt='table3' /></p><ul><li><p>FFF5：存入/读取预设高度（4个 也存入snv中）</p><p>​	预设高度一共4个，通过该特征值可以修改预设高度，也可以读取预设高度，在写入预设高度时，如果设置的高度值为0，则忽略该预设高度的设置。</p><p>​	格式为：预设高度0H 预设高度0L 预设高度1H 预设高度1L 预设高度2H 预设高度2L 预设高度3H 预设高度3L</p><p>​	其中：预设高度值 = 数据H * 256 + 数据L</p></li><li><p>FFF6：锁定状态+延时锁时间（锁定状态存入snv中而延时锁时间不存）</p><p>​	该特征值用于读取剩余非解锁状态时间及状态/设置当前锁状态。设置的时间为从当前时间算起，剩余的非解锁时间。</p><p>​	格式为：锁定状态 时间0 时间1 时间2 时间3</p><p>​	如果设置的锁定状态为0x01的条件下将时间戳设置为0x00 0x00 0x00 0x00的话，那么桌子就会立即进入锁定状态，在锁定状态为0x01的条件下，如果设置时间戳为非零的话，那么桌子进入延时锁定状态，剩余解锁时间为设置的时间戳的值。</p><p>​	如果设置的锁定状态为0x00的话，那么无论后面的时间戳设置时什么，桌子都会进入到永久解锁状态。</p></li><li><p>FFF7：获得开机时间戳</p><p>​	该特征值用于得到硬件自上电到当前时间的时间戳。内部数据每一秒更新一次，APP只需要读取该特征值内的数据即可得知硬件当前的上电时间戳。</p></li><li><p>FFF8：健康数据（201组）</p><p>​	该特征值用于发送健康数据，健康数据最多可以在底层存储201个包，每个包有一个包计数数据和三组数据，每组数据5个字节（姿态 时间 时间 时间 时间）。现阶段它存储在已逝性存储器中，断电后便会消失。未来或许可以存储在非易失性存储器中。</p><p>​	在控制指令中写入0x20时，FFF8开始发送健康数据，每30ms发送一个包，一共201个包。</p></li></ul></li></ul></li></ul></li></ul><h4><a name='header-c6889' class='md-header-anchor '></a>2.2 捷昌控制盒数据协议</h4><ul><li><p>数据发送方式</p><p>​	根据检测，以及“捷昌控制器SCI通讯协议”得知，捷倡控制盒至手控板的数据发送方式为异步数据传输方式，且一次性发送4个字节。</p><p>​	根据示波器检测结果，可知，单组数据发送需要约5ms，两组数据发送间隔约23ms，通过这一点可以正确地获得捷倡数据的帧头和有效数据。</p><p>​			<strong>图2-4 捷昌接收数据波形图</strong></p><p><img src='data%20scope.jpg' alt='797997993240365601' /></p></li><li><p>数据发送格式</p><ul><li>标准的信息格式定义如下 </li></ul><p><img src='table4.png' alt='table4' /></p><ul><li><p>串口参数： </p><p>波特率——9600 </p><p>数据位——8 位 </p><p>停止位——1 位 </p><p>奇偶校验——无 </p></li><li><p>SCI 具体定义如下： </p></li></ul></li></ul><p><img src='JC%20info.png' alt='JC info' /></p><h2><a name='header-c6928' class='md-header-anchor '></a>三、具体代码讲解</h2><h3><a name='header-c6929' class='md-header-anchor '></a>1.协议栈修改</h3><p>​	本应用程序基于TI cc2540 BLE stack 1.4.2协议栈，参考TI的simpleBLEPeripheral Profile。</p><h4><a name='header-c6932' class='md-header-anchor '></a>1.1 GATT层修改</h4><ul><li><p>涉及修改的文件有：</p><ul><li>simpleGATTprofile.h</li><li>simpleGATTprofile.c</li></ul></li><li><p>simpleGATTprofile.h下的修改：</p><p>以下参数的修改全部根据&lt;表2-1&gt;</p><ul><li>定义各个特征值的参数</li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Profile Parameters</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR0 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0  </span><span class="cm-comment">// RW uint8 - Profile Characteristic 0 value </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1  </span><span class="cm-comment">// RW uint8 - Profile Characteristic 1 value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2  </span><span class="cm-comment">// RW uint8 - Profile Characteristic 2 value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3  </span><span class="cm-comment">// RW uint8 - Profile Characteristic 3 value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4  </span><span class="cm-comment">// RW uint8 - Profile Characteristic 4 value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5  </span><span class="cm-comment">// RW uint8 - Profile Characteristic 5 value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6  </span><span class="cm-comment">// RW uint8 - Profile Characteristic 6 value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 7  </span><span class="cm-comment">// RW uint8 - Profile Characteristic 7 value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR8 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8  </span><span class="cm-comment">// RW uint8 - Profile Characteristic 8 value</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 230px;"></div></div></div></pre><ul><li>定义各个特征值的UUID</li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR0_UUID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0xFFF0</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR1_UUID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0xFFF1</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR2_UUID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0xFFF2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR3_UUID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0xFFF3</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR4_UUID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0xFFF4</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR5_UUID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0xFFF5</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR6_UUID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0xFFF6</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR7_UUID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0xFFF7</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR8_UUID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0xFFF8</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 207px;"></div></div></div></pre><ul><li>定义各个特征值的数据长度</li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR0_LEN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR1_LEN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR2_LEN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR3_LEN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR5_LEN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR6_LEN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 5</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR7_LEN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SIMPLEPROFILE_CHAR8_LEN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 16</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre></li><li><p>在simpleGATTprofile.c下做如下修改：</p><p>以下参数的修改全部根据&lt;表2-1&gt;</p><ul><li><p>修改全部传输层数组大小</p><ul><li>传输层特征值数据中包括用户描述、特征值声明、特征值属性以及特征值配置。</li><li>根据&lt;表2-1&gt;可知，一共9组特征值数据，其中2组拥有广播属性，需要特征值配置数据，其它6组只需用户描述、特征值声明以及特征值属性数据，所以该Service下至少应该有<span class="MathJax_Preview"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="-1" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.594ex" height="2.11ex" viewBox="0 -755.9 8005.9 908.7" role="img" focusable="false" style="vertical-align: -0.355ex;"><defs><path stroke-width="1" id="E8-MJMAIN-32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path stroke-width="1" id="E8-MJMAIN-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path><path stroke-width="1" id="E8-MJMAIN-34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path stroke-width="1" id="E8-MJMAIN-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path><path stroke-width="1" id="E8-MJMAIN-37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path><path stroke-width="1" id="E8-MJMAIN-33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path stroke-width="1" id="E8-MJMAIN-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path stroke-width="1" id="E8-MJMAIN-39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E8-MJMAIN-32" x="0" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E8-MJMAIN-D7" x="722" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E8-MJMAIN-34" x="1723" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E8-MJMAIN-2B" x="2446" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E8-MJMAIN-37" x="3446" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E8-MJMAIN-D7" x="4169" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E8-MJMAIN-33" x="5170" y="0"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E8-MJMAIN-3D" x="5948" y="0"></use><g transform="translate(7004,0)"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E8-MJMAIN-32"></use><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#E8-MJMAIN-39" x="500" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-8">2\times4+7\times3=29</script> 组数据。加上Service数据一共30组数据。</li></ul></li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/*********************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* CONSTANTS</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SERVAPP_NUM_ATTR_SUPPORTED &nbsp; &nbsp; &nbsp;  30</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><ul><li><p>将16位UUID值分为2个高低8位的数据</p><ul><li>无需修改Service UUID的分值语句，只需添加所需要的特征值。</li></ul></li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 0 UUID: 0xFFF0</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">CONST</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfilechar0UUID</span>[<span class="cm-variable">ATT_BT_UUID_SIZE</span>] <span class="cm-operator">=</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{ </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">LO_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR0_UUID</span>), <span class="cm-variable">HI_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR0_UUID</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 1 UUID: 0xFFF1</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">CONST</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfilechar1UUID</span>[<span class="cm-variable">ATT_BT_UUID_SIZE</span>] <span class="cm-operator">=</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{ </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">LO_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR1_UUID</span>), <span class="cm-variable">HI_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR1_UUID</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 2 UUID: 0xFFF2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">CONST</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfilechar2UUID</span>[<span class="cm-variable">ATT_BT_UUID_SIZE</span>] <span class="cm-operator">=</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{ </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">LO_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR2_UUID</span>), <span class="cm-variable">HI_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR2_UUID</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 3 UUID: 0xFFF3</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">CONST</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfilechar3UUID</span>[<span class="cm-variable">ATT_BT_UUID_SIZE</span>] <span class="cm-operator">=</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{ </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">LO_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR3_UUID</span>), <span class="cm-variable">HI_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR3_UUID</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 4 UUID: 0xFFF4</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">CONST</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfilechar4UUID</span>[<span class="cm-variable">ATT_BT_UUID_SIZE</span>] <span class="cm-operator">=</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{ </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">LO_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR4_UUID</span>), <span class="cm-variable">HI_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR4_UUID</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 5 UUID: 0xFFF5</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">CONST</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfilechar5UUID</span>[<span class="cm-variable">ATT_BT_UUID_SIZE</span>] <span class="cm-operator">=</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{ </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">LO_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR5_UUID</span>), <span class="cm-variable">HI_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR5_UUID</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 6 UUID: 0xFFF6</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">CONST</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfilechar6UUID</span>[<span class="cm-variable">ATT_BT_UUID_SIZE</span>] <span class="cm-operator">=</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{ </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">LO_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR6_UUID</span>), <span class="cm-variable">HI_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR6_UUID</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 7 UUID: 0xFFF7</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">CONST</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfilechar7UUID</span>[<span class="cm-variable">ATT_BT_UUID_SIZE</span>] <span class="cm-operator">=</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{ </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">LO_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR7_UUID</span>), <span class="cm-variable">HI_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR7_UUID</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 8 UUID: 0xFFF8</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">CONST</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfilechar8UUID</span>[<span class="cm-variable">ATT_BT_UUID_SIZE</span>] <span class="cm-operator">=</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{ </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">LO_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR8_UUID</span>), <span class="cm-variable">HI_UINT16</span>(<span class="cm-variable">SIMPLEPROFILE_CHAR8_UUID</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">};</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1219px;"></div></div></div></pre><ul><li><p>初始化各个特征值的默认值以及描述、属性等</p><ul><li><p>根据&lt;表2-1&gt;的描述修改以下数据</p><ul><li><p>特征值0属性为<strong>可读可写</strong></p><p>特征值0初始值为<strong>{ 0, 0, 0, 0 }</strong></p><p>特征值0描述为：<strong>Hardware Information</strong> (硬件信息)</p></li><li><p>特征值1属性为<strong>可读可写</strong></p><p>特征值1初始值为<strong>{ 0, 0, 0, 0, 0, 0, 0, 0 }</strong></p><p>特征值1描述为：<strong>Preset Height</strong> (预设高度)</p></li><li><p>特征值2属性为<strong>可读可写</strong></p><p>特征值2初始值为<strong>{ 0, 0 }</strong></p><p>特征值2描述为：<strong>Posture Judgement</strong> (姿态判断)</p></li><li><p>特征值3属性为<strong>可读可写</strong></p><p>特征值3初始值为<strong>{ 0, 0, 0, 0 }</strong></p><p>特征值3描述为：<strong>Action Range</strong> (桌子动作上下限)</p></li><li><p>特征值4属性为<strong>仅仅可写</strong></p><p>特征值4初始值为<strong>0</strong></p><p>特征值4描述为：<strong>Control Command</strong> (控制指令)</p></li><li><p>特征值5属性为<strong>读及通知</strong></p><p>特征值5初始值为<strong>{ 0, 0, 0, 0 }</strong></p><p>特征值5描述为：<strong>Pesk Status</strong> (桌子状态信息)</p></li><li><p>特征值6属性为<strong>可读可写</strong></p><p>特征值6初始值为<strong>{ 0, 0, 0, 0, 0 }</strong></p><p>特征值6描述为：<strong>Lock Status</strong> (锁定状态信息)</p></li><li><p>特征值7属性为<strong>仅仅可读 </strong></p><p>特征值7初始值为<strong>{ 0, 0, 0, 0 }</strong></p><p>特征值7描述为：<strong>Powerup Timestamp</strong> (上电时间戳信息)</p></li><li><p>特征值8属性为<strong>仅仅通知 </strong></p><p>特征值8初始值为<strong>{ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0  }</strong></p><p>特征值8描述为：<strong>Health Data</strong> (健康数据)</p></li></ul></li></ul></li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/*********************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* Profile Attributes - variables</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Service attribute</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">CONST</span> <span class="cm-variable">gattAttrType_t</span> <span class="cm-variable">simpleProfileService</span> <span class="cm-operator">=</span> { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">simpleProfileServUUID</span> };</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 0 Properties</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar0Props</span> <span class="cm-operator">=</span> <span class="cm-variable">GATT_PROP_READ</span> <span class="cm-operator">|</span> <span class="cm-variable">GATT_PROP_WRITE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 0 Value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar0</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR0_LEN</span>] <span class="cm-operator">=</span> { <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span> };</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 0 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar0UserDesp</span>[<span class="cm-number">21</span>] <span class="cm-operator">=</span> <span class="cm-string">"Hardware Information\0"</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 1 Properties</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar1Props</span> <span class="cm-operator">=</span> <span class="cm-variable">GATT_PROP_READ</span> <span class="cm-operator">|</span> <span class="cm-variable">GATT_PROP_WRITE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 1 Value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar1</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span>] <span class="cm-operator">=</span> { <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span> };</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 1 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar1UserDesp</span>[<span class="cm-number">14</span>] <span class="cm-operator">=</span> <span class="cm-string">"Preset Height\0"</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 2 Properties</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar2Props</span> <span class="cm-operator">=</span> <span class="cm-variable">GATT_PROP_READ</span> <span class="cm-operator">|</span> <span class="cm-variable">GATT_PROP_WRITE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 2 Value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar2</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR2_LEN</span>] <span class="cm-operator">=</span> { <span class="cm-number">0</span>, <span class="cm-number">0</span> };</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 2 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar2UserDesp</span>[<span class="cm-number">18</span>] <span class="cm-operator">=</span> <span class="cm-string">"Posture Judgement\0"</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 3 Properties</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar3Props</span> <span class="cm-operator">=</span> <span class="cm-variable">GATT_PROP_READ</span> <span class="cm-operator">|</span> <span class="cm-variable">GATT_PROP_WRITE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 3 Value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar3</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR3_LEN</span>] <span class="cm-operator">=</span> { <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span> };</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 3 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar3UserDesp</span>[<span class="cm-number">13</span>] <span class="cm-operator">=</span> <span class="cm-string">"Action Range\0"</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 4 Properties</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar4Props</span> <span class="cm-operator">=</span> <span class="cm-variable">GATT_PROP_WRITE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 4 Value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar4</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 4 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar4UserDesp</span>[<span class="cm-number">16</span>] <span class="cm-operator">=</span> <span class="cm-string">"Control Command\0"</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 5 Properties</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar5Props</span> <span class="cm-operator">=</span> <span class="cm-variable">GATT_PROP_NOTIFY</span> <span class="cm-operator">|</span> <span class="cm-variable">GATT_PROP_READ</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 5 Value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar5</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR5_LEN</span>] <span class="cm-operator">=</span> { <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span> };</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 5 Configuration Each client has its own</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// instantiation of the Client Characteristic Configuration. Reads of the</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Client Characteristic Configuration only shows the configuration for</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// that client and writes only affect the configuration of that client.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">gattCharCfg_t</span> <span class="cm-variable">simpleProfileChar5Config</span>[<span class="cm-variable">GATT_MAX_NUM_CONN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 5 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar5UserDesp</span>[<span class="cm-number">12</span>] <span class="cm-operator">=</span> <span class="cm-string">"Pesk Status\0"</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 6 Properties</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar6Props</span> <span class="cm-operator">=</span> <span class="cm-variable">GATT_PROP_READ</span> <span class="cm-operator">|</span> <span class="cm-variable">GATT_PROP_WRITE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 6 Value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar6</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span>] <span class="cm-operator">=</span> { <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span> };</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 6 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar6UserDesp</span>[<span class="cm-number">12</span>] <span class="cm-operator">=</span> <span class="cm-string">"Lock Status\0"</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 7 Properties</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar7Props</span> <span class="cm-operator">=</span> <span class="cm-variable">GATT_PROP_READ</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 7 Value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar7</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR7_LEN</span>] <span class="cm-operator">=</span> { <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span> };</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 7 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar7UserDesp</span>[<span class="cm-number">19</span>] <span class="cm-operator">=</span> <span class="cm-string">"Powerup Timestamp\0"</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 8 Properties</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar8Props</span> <span class="cm-operator">=</span> <span class="cm-variable">GATT_PROP_NOTIFY</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Characteristic 8 Value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar8</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR8_LEN</span>] <span class="cm-operator">=</span> { <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span>, <span class="cm-number">0</span> };</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 8 Configuration Each client has its own</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// instantiation of the Client Characteristic Configuration. Reads of the</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Client Characteristic Configuration only shows the configuration for</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// that client and writes only affect the configuration of that client.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">gattCharCfg_t</span> <span class="cm-variable">simpleProfileChar8Config</span>[<span class="cm-variable">GATT_MAX_NUM_CONN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple Profile Characteristic 8 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">simpleProfileChar8UserDesp</span>[<span class="cm-number">12</span>] <span class="cm-operator">=</span> <span class="cm-string">"Health Data\0"</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2300px;"></div></div></div></pre><ul><li><p>修改特征值表格
特征值表格内的一组数据的格式应为：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/**</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">* GATT Attribute format.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">typedef</span> <span class="cm-keyword">struct</span> <span class="cm-def">attAttribute_t</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-variable">gattAttrType_t</span> <span class="cm-variable">type</span>; <span class="cm-comment">//!&lt; Attribute type (2 or 16 octet UUIDs)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-variable">uint8</span> <span class="cm-variable">permissions</span>; &nbsp; <span class="cm-comment">//!&lt; Attribute permissions</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-variable">uint16</span> <span class="cm-variable">handle</span>; &nbsp; &nbsp; &nbsp; <span class="cm-comment">//!&lt; Attribute handle - assigned internally by attribute server</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-variable">uint8</span><span class="cm-operator">*</span> <span class="cm-keyword">const</span> <span class="cm-variable">pValue</span>; <span class="cm-comment">//!&lt; Attribute value - encoding of the octet array is defined in </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//!&lt; the applicable profile. The maximum length of an attribute </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//!&lt; value shall be 512 octets.</span></span></pre><pre class=""><span style="padding-right: 0.1px;">} <span class="cm-variable">gattAttribute_t</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre><p>这些特征值表格内的一组数据中包含了该特征值描述的类型、GATT层权限、句柄、和数据。</p></li><li><p>Service相关数据</p><pre class='md-fences mock-cm' style='display:block;position:relative'>特征值表格的第1组数据是关于Service的描述。</pre></li></ul></li><li><p>Characteristic 0相关数据</p></li></ul><p>特征值表格的第2组数据是关于Characteristic 0声明的描述。</p><p>特征值表格的第3组数据是关于Characteristic 0数据的描述。</p><p>特征值表格的第4组数据是关于Characteristic 0用户显示的描述。</p><ul><li>Characteristic 1相关数据</li></ul><p>特征值表格的第5组数据是关于Characteristic 1声明的描述。</p><p>特征值表格的第6组数据是关于Characteristic 1数据的描述。</p><p>特征值表格的第7组数据是关于Characteristic 1用户显示的描述。</p><ul><li>Characteristic 2相关数据</li></ul><p>特征值表格的第8组数据是关于Characteristic 2声明的描述。</p><p>特征值表格的第9组数据是关于Characteristic 2数据的描述。</p><p>特征值表格的第10组数据是关于Characteristic 2用户显示的描述。</p><ul><li>Characteristic 3相关数据</li></ul><p>特征值表格的第11组数据是关于Characteristic 3声明的描述。</p><p>特征值表格的第12组数据是关于Characteristic 3数据的描述。</p><p>特征值表格的第13组数据是关于Characteristic 3用户显示的描述。</p><ul><li>Characteristic 4相关数据</li></ul><p>特征值表格的第14组数据是关于Characteristic 4声明的描述。</p><p>特征值表格的第15组数据是关于Characteristic 4数据的描述。</p><p>特征值表格的第16组数据是关于Characteristic 4用户显示的描述。</p><ul><li>Characteristic 5相关数据</li></ul><p>特征值表格的第17组数据是关于Characteristic 5声明的描述。</p><p>特征值表格的第18组数据是关于Characteristic 5数据的描述。</p><p>特征值表格的第19组数据是关于Characteristic 5配置的描述。</p><p>特征值表格的第20组数据是关于Characteristic 5用户显示的描述。</p><ul><li>Characteristic 6相关数据</li></ul><p>特征值表格的第21组数据是关于Characteristic 6声明的描述。</p><p>特征值表格的第22组数据是关于Characteristic 6数据的描述。</p><p>特征值表格的第23组数据是关于Characteristic 6用户显示的描述。</p><ul><li>Characteristic 7相关数据</li></ul><p>特征值表格的第24组数据是关于Characteristic 7声明的描述。</p><p>特征值表格的第25组数据是关于Characteristic 7数据的描述。</p><p>特征值表格的第26组数据是关于Characteristic 7用户显示的描述。</p><ul><li>Characteristic 8相关数据</li></ul><p>特征值表格的第27组数据是关于Characteristic 8声明的描述。</p><p>特征值表格的第28组数据是关于Characteristic 8数据的描述。</p><p>特征值表格的第29组数据是关于Characteristic 8配置的描述。</p><p>特征值表格的第30组数据是关于Characteristic 8用户显示的描述。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/*********************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">* Profile Attributes - Table</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">gattAttribute_t</span> <span class="cm-variable">simpleProfileAttrTbl</span>[<span class="cm-variable">SERVAPP_NUM_ATTR_SUPPORTED</span>] <span class="cm-operator">=</span> </span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// Simple Profile Service</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">primaryServiceUUID</span> }, <span class="cm-comment">/* type */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">/* permissions */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-number">0</span>, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">/* handle */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-operator">&amp;</span><span class="cm-variable">simpleProfileService</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">/* pValue */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 0 Declaration</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">characterUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-operator">&amp;</span><span class="cm-variable">simpleProfileChar0Props</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic Value 0</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">simpleProfilechar0UUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span> <span class="cm-operator">|</span> <span class="cm-variable">GATT_PERMIT_WRITE</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar0</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 0 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">charUserDescUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar0UserDesp</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 1 Declaration</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">characterUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-operator">&amp;</span><span class="cm-variable">simpleProfileChar1Props</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic Value 1</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">simpleProfilechar1UUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span> <span class="cm-operator">|</span> <span class="cm-variable">GATT_PERMIT_WRITE</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar1</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 1 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">charUserDescUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar1UserDesp</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 2 Declaration</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">characterUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-operator">&amp;</span><span class="cm-variable">simpleProfileChar2Props</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic Value 2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">simpleProfilechar2UUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span> <span class="cm-operator">|</span> <span class="cm-variable">GATT_PERMIT_WRITE</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 2 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">charUserDescUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar2UserDesp</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 3 Declaration</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">characterUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-operator">&amp;</span><span class="cm-variable">simpleProfileChar3Props</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic Value 3</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">simpleProfilechar3UUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span> <span class="cm-operator">|</span> <span class="cm-variable">GATT_PERMIT_WRITE</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar3</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 3 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">charUserDescUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar3UserDesp</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 4 Declaration</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">characterUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-operator">&amp;</span><span class="cm-variable">simpleProfileChar4Props</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic Value 4</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">simpleProfilechar4UUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_WRITE</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-operator">&amp;</span><span class="cm-variable">simpleProfileChar4</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 4 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">charUserDescUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar4UserDesp</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }, &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// Characteristic 5 Declaration</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">characterUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-operator">&amp;</span><span class="cm-variable">simpleProfileChar5Props</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic Value 5</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">simpleProfilechar5UUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar5</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 5 configuration</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">clientCharCfgUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span> <span class="cm-operator">|</span> <span class="cm-variable">GATT_PERMIT_WRITE</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">simpleProfileChar5Config</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 5 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">charUserDescUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar5UserDesp</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 6 Declaration</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">characterUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-operator">&amp;</span><span class="cm-variable">simpleProfileChar6Props</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic Value 6</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">simpleProfilechar6UUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span> <span class="cm-operator">|</span> <span class="cm-variable">GATT_PERMIT_WRITE</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar6</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 6 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">charUserDescUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar6UserDesp</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 7 Declaration</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">characterUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-operator">&amp;</span><span class="cm-variable">simpleProfileChar7Props</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic Value 7</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">simpleProfilechar7UUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar7</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 7User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">charUserDescUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar7UserDesp</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// Characteristic 8 Declaration</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">characterUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-operator">&amp;</span><span class="cm-variable">simpleProfileChar8Props</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic Value 8</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">simpleProfilechar8UUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar8</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 8 configuration</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">clientCharCfgUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span> <span class="cm-operator">|</span> <span class="cm-variable">GATT_PERMIT_WRITE</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">simpleProfileChar8Config</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Characteristic 8 User Description</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  { </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-variable">ATT_BT_UUID_SIZE</span>, <span class="cm-variable">charUserDescUUID</span> },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATT_PERMIT_READ</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar8UserDesp</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  },</span></pre><pre class=""><span style="padding-right: 0.1px;">  };</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 5681px;"></div></div></div></pre><ul><li><p>修改特征值数据发送函数</p><p>​	特征值数据发送函数，根据特征值参数ID确定数据通过哪一个特征值发送（如果无效则返回INVALID</p><p>PARAMETER），根据特征值数据长度判断用户所发送的数据长度是否有效（是否超出或者不够，如果无效则返回bleInvalidRange），根据所发送数据实现数据的传输。</p><p>​	<em>需要注意的是，如果数据为多个数据，则在赋值时需要用到osal_memcpy函数进行赋值。</em></p></li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/*********************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @fn &nbsp; &nbsp;  SimpleProfile_SetParameter</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @brief &nbsp; Set a Simple Profile parameter.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @param &nbsp; param - Profile parameter ID</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @param &nbsp; len - length of data to right</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @param &nbsp; value - pointer to data to write.  This is dependent on</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* &nbsp; &nbsp; &nbsp; &nbsp;  the parameter ID and WILL be cast to the appropriate </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* &nbsp; &nbsp; &nbsp; &nbsp;  data type (example: data type of uint16 will be cast to </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* &nbsp; &nbsp; &nbsp; &nbsp;  uint16 pointer).</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @return  bStatus_t</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">bStatus_t</span> <span class="cm-def">SimpleProfile_SetParameter</span>( <span class="cm-variable">uint8</span> <span class="cm-variable">param</span>, <span class="cm-variable">uint8</span> <span class="cm-variable">len</span>, <span class="cm-variable-3">void</span> <span class="cm-variable-3">*</span><span class="cm-variable">value</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">bStatus_t</span> <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">SUCCESS</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">switch</span> ( <span class="cm-variable">param</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR0</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">len</span> <span class="cm-operator">==</span> <span class="cm-variable">SIMPLEPROFILE_CHAR0_LEN</span> ) </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">simpleProfileChar0</span>, <span class="cm-variable">value</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR0_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">bleInvalidRange</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR1</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">len</span> <span class="cm-operator">==</span> <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span> ) </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">simpleProfileChar1</span>, <span class="cm-variable">value</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">bleInvalidRange</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR2</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">len</span> <span class="cm-operator">==</span> <span class="cm-variable">SIMPLEPROFILE_CHAR2_LEN</span> ) </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">simpleProfileChar2</span>, <span class="cm-variable">value</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR2_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">bleInvalidRange</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR3</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">len</span> <span class="cm-operator">==</span> <span class="cm-variable">SIMPLEPROFILE_CHAR3_LEN</span> ) </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">simpleProfileChar3</span>, <span class="cm-variable">value</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR3_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">bleInvalidRange</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR4</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">len</span> <span class="cm-operator">==</span> <span class="cm-number">1</span> ) </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileChar4</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span>((<span class="cm-variable">uint8</span><span class="cm-operator">*</span>)<span class="cm-variable">value</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">bleInvalidRange</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR5</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">len</span> <span class="cm-operator">==</span> <span class="cm-variable">SIMPLEPROFILE_CHAR5_LEN</span> ) </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">simpleProfileChar5</span>, <span class="cm-variable">value</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR5_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// See if Notification has been enabled</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATTServApp_ProcessCharCfg</span>( <span class="cm-variable">simpleProfileChar5Config</span>, <span class="cm-variable">simpleProfileChar5</span>, <span class="cm-variable">FALSE</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileAttrTbl</span>, <span class="cm-variable">GATT_NUM_ATTRS</span>( <span class="cm-variable">simpleProfileAttrTbl</span> ),</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">INVALID_TASK_ID</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">bleInvalidRange</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR6</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">len</span> <span class="cm-operator">==</span> <span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span> ) </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">simpleProfileChar6</span>, <span class="cm-variable">value</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">bleInvalidRange</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR7</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">len</span> <span class="cm-operator">==</span> <span class="cm-variable">SIMPLEPROFILE_CHAR7_LEN</span> ) </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">simpleProfileChar7</span>, <span class="cm-variable">value</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR7_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">bleInvalidRange</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR8</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">len</span> <span class="cm-operator">==</span> <span class="cm-variable">SIMPLEPROFILE_CHAR8_LEN</span> ) </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">simpleProfileChar8</span>, <span class="cm-variable">value</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR8_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// See if Notification has been enabled</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GATTServApp_ProcessCharCfg</span>( <span class="cm-variable">simpleProfileChar8Config</span>, <span class="cm-variable">simpleProfileChar8</span>, <span class="cm-variable">FALSE</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">simpleProfileAttrTbl</span>, <span class="cm-variable">GATT_NUM_ATTRS</span>( <span class="cm-variable">simpleProfileAttrTbl</span> ),</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">INVALID_TASK_ID</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">bleInvalidRange</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">INVALIDPARAMETER</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> ( <span class="cm-variable">ret</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 3105px;"></div></div></div></pre><ul><li><p>修改特征值数据接收函数</p><p>​	特征值数据接收函数，根据特征值参数ID确定数据通过哪一个特征值进入了接收回调（如果无效则返回INVALIDPARAMETER），根据所接收到的数据的地址实现数据的获取。</p><p>​	<em>需要注意的是，如果数据为多个数据，则在赋值时需要用到osal_memcpy函数进行赋值。</em></p></li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/*********************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @fn &nbsp; &nbsp;  SimpleProfile_GetParameter</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @brief &nbsp; Get a Simple Profile parameter.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @param &nbsp; param - Profile parameter ID</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @param &nbsp; value - pointer to data to put.  This is dependent on</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* &nbsp; &nbsp; &nbsp; &nbsp;  the parameter ID and WILL be cast to the appropriate </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* &nbsp; &nbsp; &nbsp; &nbsp;  data type (example: data type of uint16 will be cast to </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* &nbsp; &nbsp; &nbsp; &nbsp;  uint16 pointer).</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @return  bStatus_t</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">bStatus_t</span> <span class="cm-def">SimpleProfile_GetParameter</span>( <span class="cm-variable">uint8</span> <span class="cm-variable">param</span>, <span class="cm-variable-3">void</span> <span class="cm-variable-3">*</span><span class="cm-variable">value</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">bStatus_t</span> <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">SUCCESS</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">switch</span> ( <span class="cm-variable">param</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR0</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">value</span>, <span class="cm-variable">simpleProfileChar0</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR0_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR1</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">value</span>, <span class="cm-variable">simpleProfileChar1</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR2</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">value</span>, <span class="cm-variable">simpleProfileChar2</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR2_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR3</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">value</span>, <span class="cm-variable">simpleProfileChar3</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR3_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR4</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-operator">*</span>((<span class="cm-variable">uint8</span><span class="cm-operator">*</span>)<span class="cm-variable">value</span>) <span class="cm-operator">=</span> <span class="cm-variable">simpleProfileChar4</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR6</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">value</span>, <span class="cm-variable">simpleProfileChar6</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">ret</span> <span class="cm-operator">=</span> <span class="cm-variable">INVALIDPARAMETER</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> ( <span class="cm-variable">ret</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1127px;"></div></div></div></pre><ul><li>修改特征值读取回调函数</li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/*********************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @fn &nbsp; &nbsp; &nbsp; &nbsp;  simpleProfile_ReadAttrCB</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @brief &nbsp; &nbsp; &nbsp; Read an attribute.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @param &nbsp; &nbsp; &nbsp; connHandle - connection message was received on</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @param &nbsp; &nbsp; &nbsp; pAttr - pointer to attribute</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @param &nbsp; &nbsp; &nbsp; pValue - pointer to data to be read</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @param &nbsp; &nbsp; &nbsp; pLen - length of data to be read</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @param &nbsp; &nbsp; &nbsp; offset - offset of the first octet to be read</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @param &nbsp; &nbsp; &nbsp; maxLen - maximum length of data to be read</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @return &nbsp; &nbsp;  Success or Failure</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-def">simpleProfile_ReadAttrCB</span>( <span class="cm-variable">uint16</span> <span class="cm-variable">connHandle</span>, <span class="cm-variable">gattAttribute_t</span> <span class="cm-operator">*</span><span class="cm-variable">pAttr</span>, </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">pValue</span>, <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">pLen</span>, <span class="cm-variable">uint16</span> <span class="cm-variable">offset</span>, <span class="cm-variable">uint8</span> <span class="cm-variable">maxLen</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">bStatus_t</span> <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">SUCCESS</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// If attribute permissions require authorization to read, return error</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">gattPermitAuthorRead</span>( <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">permissions</span> ) )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// Insufficient authorization</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">return</span> ( <span class="cm-variable">ATT_ERR_INSUFFICIENT_AUTHOR</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// Make sure it's not a blob operation (no attributes in the profile are long)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">offset</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">return</span> ( <span class="cm-variable">ATT_ERR_ATTR_NOT_LONG</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">type</span>.<span class="cm-variable">len</span> <span class="cm-operator">==</span> <span class="cm-variable">ATT_BT_UUID_SIZE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// 16-bit UUID</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">uint16</span> <span class="cm-variable">uuid</span> <span class="cm-operator">=</span> <span class="cm-variable">BUILD_UINT16</span>( <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">type</span>.<span class="cm-variable">uuid</span>[<span class="cm-number">0</span>], <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">type</span>.<span class="cm-variable">uuid</span>[<span class="cm-number">1</span>]);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">switch</span> ( <span class="cm-variable">uuid</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// No need for "GATT_SERVICE_UUID" or "GATT_CLIENT_CHAR_CFG_UUID" cases;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// gattserverapp handles those reads</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// characteristics 0,1,2,3,5,6,7 have read permissions</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// characteritisc 4 does not have read permissions; therefore it is not</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// &nbsp; included here</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// characteristic 8 does not have read permissions, but because it</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// &nbsp; can be sent as a notification, it is included here</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR0_UUID</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-operator">*</span><span class="cm-variable">pLen</span> <span class="cm-operator">=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR0_LEN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">pValue</span>, <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pValue</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR0_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR1_UUID</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-operator">*</span><span class="cm-variable">pLen</span> <span class="cm-operator">=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">pValue</span>, <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pValue</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR2_UUID</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-operator">*</span><span class="cm-variable">pLen</span> <span class="cm-operator">=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR2_LEN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">pValue</span>, <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pValue</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR2_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR3_UUID</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-operator">*</span><span class="cm-variable">pLen</span> <span class="cm-operator">=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR3_LEN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">pValue</span>, <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pValue</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR3_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR5_UUID</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-operator">*</span><span class="cm-variable">pLen</span> <span class="cm-operator">=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR5_LEN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">pValue</span>, <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pValue</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR5_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR6_UUID</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-operator">*</span><span class="cm-variable">pLen</span> <span class="cm-operator">=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">pValue</span>, <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pValue</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR7_UUID</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-operator">*</span><span class="cm-variable">pLen</span> <span class="cm-operator">=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR7_LEN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">pValue</span>, <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pValue</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR7_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR8_UUID</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-operator">*</span><span class="cm-variable">pLen</span> <span class="cm-operator">=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR8_LEN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">pValue</span>, <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pValue</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR8_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Should never get here! (characteristics 1 and 2 do not have read permissions)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-operator">*</span><span class="cm-variable">pLen</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_ATTR_NOT_FOUND</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// 128-bit UUID</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-operator">*</span><span class="cm-variable">pLen</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_INVALID_HANDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> ( <span class="cm-variable">status</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2346px;"></div></div></div></pre><ul><li>修改特征值写入回调函数</li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/*********************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @fn &nbsp; &nbsp;  simpleProfile_WriteAttrCB</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @brief &nbsp; Validate attribute data prior to a write operation</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @param &nbsp; connHandle - connection message was received on</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @param &nbsp; pAttr - pointer to attribute</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @param &nbsp; pValue - pointer to data to be written</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @param &nbsp; len - length of data</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @param &nbsp; offset - offset of the first octet to be written</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* @return  Success or Failure</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">bStatus_t</span> <span class="cm-def">simpleProfile_WriteAttrCB</span>( <span class="cm-variable">uint16</span> <span class="cm-variable">connHandle</span>, <span class="cm-variable">gattAttribute_t</span> <span class="cm-operator">*</span><span class="cm-variable">pAttr</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">pValue</span>, <span class="cm-variable">uint8</span> <span class="cm-variable">len</span>, <span class="cm-variable">uint16</span> <span class="cm-variable">offset</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">bStatus_t</span> <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">SUCCESS</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">uint8</span> <span class="cm-variable">notifyApp</span> <span class="cm-operator">=</span> <span class="cm-number">0xFF</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// If attribute permissions require authorization to write, return error</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">gattPermitAuthorWrite</span>( <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">permissions</span> ) )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// Insufficient authorization</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">return</span> ( <span class="cm-variable">ATT_ERR_INSUFFICIENT_AUTHOR</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">type</span>.<span class="cm-variable">len</span> <span class="cm-operator">==</span> <span class="cm-variable">ATT_BT_UUID_SIZE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// 16-bit UUID</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">uint16</span> <span class="cm-variable">uuid</span> <span class="cm-operator">=</span> <span class="cm-variable">BUILD_UINT16</span>( <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">type</span>.<span class="cm-variable">uuid</span>[<span class="cm-number">0</span>], <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">type</span>.<span class="cm-variable">uuid</span>[<span class="cm-number">1</span>]);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">switch</span> ( <span class="cm-variable">uuid</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR0_UUID</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//Validate the value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Make sure it's not a blob oper</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">offset</span> <span class="cm-operator">==</span> <span class="cm-number">0</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">len</span> <span class="cm-operator">!=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR0_LEN</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_INVALID_VALUE_SIZE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_ATTR_NOT_LONG</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//Write the value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">status</span> <span class="cm-operator">==</span> <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-tab">  </span> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pValue</span>, <span class="cm-variable">pValue</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR0_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">notifyApp</span> <span class="cm-operator">=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR1_UUID</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//Validate the value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Make sure it's not a blob oper</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">offset</span> <span class="cm-operator">==</span> <span class="cm-number">0</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">len</span> <span class="cm-operator">!=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_INVALID_VALUE_SIZE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_ATTR_NOT_LONG</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//Write the value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">status</span> <span class="cm-operator">==</span> <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-tab">  </span> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pValue</span>, <span class="cm-variable">pValue</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">notifyApp</span> <span class="cm-operator">=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR2_UUID</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//Validate the value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Make sure it's not a blob oper</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">offset</span> <span class="cm-operator">==</span> <span class="cm-number">0</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">len</span> <span class="cm-operator">!=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR2_LEN</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_INVALID_VALUE_SIZE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_ATTR_NOT_LONG</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//Write the value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">status</span> <span class="cm-operator">==</span> <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-tab"> </span> &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pValue</span>, <span class="cm-variable">pValue</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR2_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">notifyApp</span> <span class="cm-operator">=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR2</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR3_UUID</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//Validate the value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Make sure it's not a blob oper</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">offset</span> <span class="cm-operator">==</span> <span class="cm-number">0</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">len</span> <span class="cm-operator">!=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR3_LEN</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_INVALID_VALUE_SIZE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_ATTR_NOT_LONG</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//Write the value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">status</span> <span class="cm-operator">==</span> <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-tab">  </span> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pValue</span>, <span class="cm-variable">pValue</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR3_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">notifyApp</span> <span class="cm-operator">=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR3</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR4_UUID</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//Validate the value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Make sure it's not a blob oper</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">offset</span> <span class="cm-operator">==</span> <span class="cm-number">0</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">len</span> <span class="cm-operator">!=</span> <span class="cm-number">1</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_INVALID_VALUE_SIZE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_ATTR_NOT_LONG</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//Write the value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">status</span> <span class="cm-operator">==</span> <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">pCurValue</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pValue</span>; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-operator">*</span><span class="cm-variable">pCurValue</span> <span class="cm-operator">=</span> <span class="cm-variable">pValue</span>[<span class="cm-number">0</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">notifyApp</span> <span class="cm-operator">=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR4</span>; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR5_UUID</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//Validate the value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Make sure it's not a blob oper</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">offset</span> <span class="cm-operator">==</span> <span class="cm-number">0</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">len</span> <span class="cm-operator">!=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR5_LEN</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_INVALID_VALUE_SIZE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_ATTR_NOT_LONG</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//Write the value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">status</span> <span class="cm-operator">==</span> <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-tab">  </span> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pValue</span>, <span class="cm-variable">pValue</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR5_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">notifyApp</span> <span class="cm-operator">=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR5</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR6_UUID</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//Validate the value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Make sure it's not a blob oper</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">offset</span> <span class="cm-operator">==</span> <span class="cm-number">0</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">len</span> <span class="cm-operator">!=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_INVALID_VALUE_SIZE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_ATTR_NOT_LONG</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">//Write the value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">status</span> <span class="cm-operator">==</span> <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-tab">  </span> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_memcpy</span>( <span class="cm-variable">pAttr</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pValue</span>, <span class="cm-variable">pValue</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">notifyApp</span> <span class="cm-operator">=</span> <span class="cm-variable">SIMPLEPROFILE_CHAR6</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">GATT_CLIENT_CHAR_CFG_UUID</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">GATTServApp_ProcessCCCWriteReq</span>( <span class="cm-variable">connHandle</span>, <span class="cm-variable">pAttr</span>, <span class="cm-variable">pValue</span>, <span class="cm-variable">len</span>,</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">offset</span>, <span class="cm-variable">GATT_CLIENT_CFG_NOTIFY</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Should never get here! (characteristics 5,7,8 do not have write permissions)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_ATTR_NOT_FOUND</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// 128-bit UUID</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">status</span> <span class="cm-operator">=</span> <span class="cm-variable">ATT_ERR_INVALID_HANDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// If a charactersitic value changed then callback function to notify application of change</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span> ( (<span class="cm-variable">notifyApp</span> <span class="cm-operator">!=</span> <span class="cm-number">0xFF</span> ) <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">simpleProfile_AppCBs</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">simpleProfile_AppCBs</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pfnSimpleProfileChange</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">simpleProfile_AppCBs</span><span class="cm-operator">-&gt;</span><span class="cm-variable">pfnSimpleProfileChange</span>( <span class="cm-variable">notifyApp</span> );  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> ( <span class="cm-variable">status</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 5221px;"></div></div></div></pre><h4><a name='header-c7183' class='md-header-anchor '></a>1.2 HAL层修改</h4><ul><li><p>原理</p><p>​	由于需要利用芯片端的串口来接收控制盒所发送的高度/信息数据，所以需要利用到TI 1.4.2协议栈HAL层下的uart模块。为了适应应用需要，所以需要更改协议栈的HAL层代码。</p><p>​	协议栈默认的uart数据读取模式为DMA模式（即直接内存读取），与ISR模式所不同的是，它不会占用CPU的中断资源，这种模式的好处是不会影响到CPU处理其他任务；尤其在数据传输量大、传输间隔小的情况下，这种优势更为明显。在TI的协议栈中，读取DMA数据是采用轮询的方式。</p><p>​	在<code>osal_start_system()</code>=&gt; <code>osal_run_system()</code> =&gt; <code>Hal_ProcessPoll()</code> 中可以看到uart的轮询处理函数。</p></li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/***************************************************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">* @fn &nbsp; &nbsp;  HalUARTPoll</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">* @brief &nbsp; Poll the UART.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">* @param &nbsp; none</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">* @return  none</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">*****************************************************************************/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">HalUARTPoll</span>(<span class="cm-variable-3">void</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if (HAL_UART_DMA &amp;&amp; HAL_UART_SPI)  </span><span class="cm-comment">// When both are defined, port is run-time choice.</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> (<span class="cm-variable">HAL_UART_PORT</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">HalUARTPollSPI</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">HalUARTPollDMA</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if HAL_UART_DMA</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">HalUARTPollDMA</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if HAL_UART_ISR</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">HalUARTPollISR</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if HAL_UART_SPI</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">HalUARTPollSPI</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if HAL_UART_USB</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">HalUARTPollUSB</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 805px;"></div></div></div></pre><p> 	由于协议栈uart的宏定义为DMA模式，所以只需了解在<code>HalUARTPollDMA()</code>函数里的过程。在<code>HalUARTPollDMA()</code>函数中，有各种事件的触发条件，根据&lt;图2-4&gt;所示，串口接收的数据是连续的，所以如果想要判断捷昌所发送数据的帧头帧尾及有效数据，必须要通过接收数据触发事件。</p><p> 	根据&lt;图2-4&gt;所示，由于捷昌的异步数据是以4个字节为一组每23ms一发，且在一组中，每字节的接收时间不超过2ms，所以可以根据2个数据接收间隔作为判断，来确定数据的帧头是哪一位。如果两个字节接收时间超过17ms即可证明接收的前一个字节为帧尾，接收的最近一个字节为帧头。</p><ul><li><p>需要做出修改的文件</p><ul><li>hal_uart_dma.c</li><li>npi.h</li></ul></li><li><p>hal_uart_dma.c中做出的修改</p><pre class='md-fences mock-cm' style='display:block;position:relative'>        ​	为了保证每次接收到的数据不超过4个字节，所以在hal_uart_dma.c文件里做如下修改：</pre></li></ul><pre class='md-fences mock-cm' style='display:block;position:relative'> ```c
 #if !defined HAL_UART_DMA_RX_MAX

 #if (defined PRODUCT_TYPE_BAR2) || (defined PRODUCT_TYPE_CUBE)
 #define HAL_UART_DMA_RX_MAX        4
 #elif (defined PRODUCT_TYPES_BAR)
 #define HAL_UART_DMA_RX_MAX        128
 #endif

 #endif
 #if !defined HAL_UART_DMA_TX_MAX
 #define HAL_UART_DMA_TX_MAX        HAL_UART_DMA_RX_MAX
 #endif
 #if !defined HAL_UART_DMA_HIGH
 #define HAL_UART_DMA_HIGH         (HAL_UART_DMA_RX_MAX - 1)
 #endif
 #if !defined HAL_UART_DMA_IDLE
 #define HAL_UART_DMA_IDLE         (0 * HAL_UART_MSECS_TO_TICKS)
 #endif
 #if !defined HAL_UART_DMA_FULL
 #define HAL_UART_DMA_FULL         (HAL_UART_DMA_RX_MAX)
 #endif
 ```</pre><ul><li><p>npi.h中做出的修改</p><p>​	根据捷昌控制盒数据协议可知：数据波特率为9600，停止位为1位，数据位为8位，无奇偶校验，所以还需要更改底层异步端口的波特率，该值需要在npi.h文件里做出如下修改：</p></li></ul><pre class='md-fences mock-cm' style='display:block;position:relative'> ```c
 #if !defined( NPI_UART_BR )
 #define NPI_UART_BR                    HAL_UART_BR_9600
 #endif // !NPI_UART_BR
 ```</pre><h4><a name='header-c7222' class='md-header-anchor '></a>1.3 NPI函数的添改</h4><ul><li><p>添加NPI清除缓存函数</p><p>​	添加一个NPI的清除缓存函数，以防dma缓冲区超过限值后无法回到正常状态。</p></li><li><p>添加这个函数需要在如下文件进行修改：</p><ul><li>npi.h</li><li>npi.c</li><li>hal_uart.c</li><li>hal_uart_dma.c</li></ul></li><li><p>在npi.h文件中做出的修改</p><pre class='md-fences mock-cm' style='display:block;position:relative'>        ​	在FUNCTIONS声明底下添加：</pre></li></ul><pre class='md-fences mock-cm' style='display:block;position:relative'> ```c                                                                      extern uint16 NPI_ClearTransport( uint16 len );
 extern uint16 NPI_ClearTransport( uint16 len );
 ```</pre><ul><li><p>在npi.c文件中做出的修改</p><p>​	在FUNCTIONS声明底下添加：</p></li></ul><pre class='md-fences mock-cm' style='display:block;position:relative'> ```c
 /*******************************************************************************
 * @fn          NPI_ClearTransport
 *
 * @brief       This routine clears the data from the transport layer based on len
 *
 * input parameters
 *
 * @param       len - Number of bytes to read.
 *
 * output parameters
 *
 * @param       None.
 *
 * @return      Returns the number of bytes clear from transport.
 */
  uint16 NPI_ClearTransport( uint16 len )
  {
    return( HalUARTClear( NPI_UART_PORT, len ) );
  }
 ```</pre><ul><li><p>在hal_uart.c文件中做出的修改</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/*****************************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @fn &nbsp; &nbsp;  HalUARTClear</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @brief &nbsp; Clear a buffer from the UART</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @param &nbsp; port - USART module designation</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* &nbsp; &nbsp; &nbsp; &nbsp;  len  - max length number of bytes to copy to 'buf'</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @return  length of buffer that was read</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*****************************************************************************/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">uint16</span> <span class="cm-def">HalUARTClear</span>(<span class="cm-variable">uint8</span> <span class="cm-variable">port</span>, <span class="cm-variable">uint16</span> <span class="cm-variable">len</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if (HAL_UART_DMA == 1)</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> (<span class="cm-variable">port</span> <span class="cm-operator">==</span> <span class="cm-variable">HAL_UART_PORT_0</span>)  <span class="cm-keyword">return</span> <span class="cm-variable">HalUARTClearDMA</span>(<span class="cm-variable">len</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if (HAL_UART_DMA == 2)</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> (<span class="cm-variable">port</span> <span class="cm-operator">==</span> <span class="cm-variable">HAL_UART_PORT_1</span>)  <span class="cm-keyword">return</span> <span class="cm-variable">HalUARTClearDMA</span>(<span class="cm-variable">len</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if (HAL_UART_ISR == 1)</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> (<span class="cm-variable">port</span> <span class="cm-operator">==</span> <span class="cm-variable">HAL_UART_PORT_0</span>)  <span class="cm-keyword">return</span> <span class="cm-variable">HalUARTReadISR</span>(<span class="cm-variable">buf</span>, <span class="cm-variable">len</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if (HAL_UART_ISR == 2)</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> (<span class="cm-variable">port</span> <span class="cm-operator">==</span> <span class="cm-variable">HAL_UART_PORT_1</span>)  <span class="cm-keyword">return</span> <span class="cm-variable">HalUARTReadISR</span>(<span class="cm-variable">buf</span>, <span class="cm-variable">len</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if (HAL_UART_SPI == 1)</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> (<span class="cm-variable">port</span> <span class="cm-operator">==</span> <span class="cm-variable">HAL_UART_PORT_0</span>)  <span class="cm-keyword">return</span> <span class="cm-variable">HalUARTReadSPI</span>(<span class="cm-variable">buf</span>, <span class="cm-variable">len</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if (HAL_UART_SPI == 2)</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> (<span class="cm-variable">port</span> <span class="cm-operator">==</span> <span class="cm-variable">HAL_UART_PORT_1</span>)  <span class="cm-keyword">return</span> <span class="cm-variable">HalUARTReadSPI</span>(<span class="cm-variable">buf</span>, <span class="cm-variable">len</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if HAL_UART_USB</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">return</span> <span class="cm-variable">HalUARTRx</span>(<span class="cm-variable">buf</span>, <span class="cm-variable">len</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-meta">#if (HAL_UART_DMA == 0) &amp;&amp; (HAL_UART_ISR == 0) &amp;&amp; (HAL_UART_SPI == 0)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// UART is not enabled. Do nothing.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  (<span class="cm-variable-3">void</span>) <span class="cm-variable">port</span>; &nbsp; <span class="cm-comment">// unused argument</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  (<span class="cm-variable-3">void</span>) <span class="cm-variable">buf</span>; &nbsp; <span class="cm-comment">// unused argument</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  (<span class="cm-variable-3">void</span>) <span class="cm-variable">len</span>; &nbsp; <span class="cm-comment">// unused argument</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 989px;"></div></div></div></pre></li><li><p>在hal_uart.c文件中做出的修改</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">/*****************************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">* @fn &nbsp; &nbsp;  HalUARTClearDMA</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">* @brief &nbsp; Clear a buffer from the UART</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">* @param &nbsp; buf  - valid data buffer at least 'len' bytes in size</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">* &nbsp; &nbsp; &nbsp; &nbsp;  len  - max length number of bytes to copy to 'buf'</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">* @return  length of buffer that was read</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">*****************************************************************************/</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 230px;"></div></div></div></pre><p>static uint16 HalUARTClearDMA( uint16 len )
{
  uint16 cnt;</p><p>  for (cnt = 0; cnt &lt; len; cnt++)
  {</p><pre class='md-fences mock-cm' style='display:block;position:relative'>HAL_UART_DMA_CLR_RX_BYTE(dmaCfg.rxHead);
HAL_UART_RX_IDX_T_INCR(dmaCfg.rxHead);</pre><p>  }</p><p>  /* Update pointers after reading the bytes */
  dmaCfg.rxTail = dmaCfg.rxHead;</p><p>  if (!DMA_PM &amp;&amp; (UxUCR &amp; UCR_FLOW))
  {</p><pre class='md-fences mock-cm' style='display:block;position:relative'>HAL_UART_DMA_SET_RDY_OUT();  // Re-enable the flow asap (i.e. not wait until next uart poll).    </pre><p>  }</p><p>  return cnt;
}</p><pre class='md-fences mock-cm' style='display:block;position:relative'></pre></li></ul><h3><a name='header-c7290' class='md-header-anchor '></a>2.应用层逻辑实现</h3><h4><a name='header-c7291' class='md-header-anchor '></a>前言</h4><h5><a name='header-c7292' class='md-header-anchor '></a>应用层逻辑说明</h5><p>​	大部分的应用层功能都在以下代码中实现，需要实现的功能按照周期性非周期性分类，将捷昌接收处理作为单独事件进行处理。</p><p><img src='logic%20realize.png' alt='logic realize' /></p><p>​	实现逻辑所需要编辑的文件：</p><ul><li>applicationBLE.h</li><li>applicationBLE.c</li><li>simpleBLEPeripheral.c</li><li>simpleBLEPeripheral.h</li></ul><h5><a name='header-c7312' class='md-header-anchor '></a>程序内部公共变量有效性验证</h5><ul><li><p>工程内部全部应用层公有变量</p><ul><li><p>uint16类型</p><ul><li><code>postureChange_Threshold</code></li><li><code>pesk_Stop_Count</code></li><li><code>pesk_Current_Height</code></li><li><code>device_PeskMove_Interval</code></li><li><code>uart_DataReceivedCounter</code></li><li><code>device_Height_Destinate</code></li></ul></li><li><p>uint8类型</p><ul><li><code>pesk_Lock_Status</code></li><li><code>user_HealthData_Count</code></li><li><code>pesk_Move_CurrentStatus</code></li><li><code>pesk_Move_PreviousStatus</code></li><li><code>cmd_Previous</code></li></ul></li><li><p>bool类型</p><ul><li><code>device_SendHealthData_Enable</code></li><li><code>device_BLE_Connect_Flag</code></li></ul></li><li><p>自定义类型</p><ul><li><code>pesk_Hardware_Info</code> (<code>hardwareInfo_t</code> 类型)</li><li><code>user_HealthData[]</code>(<code>healthData_t</code> 类型)</li><li><code>device_LockData</code> (<code>lockData_t</code> 类型)</li><li><code>peskData</code> (<code>peskStatus_t</code>类型)</li><li><code>device_Memory_Set[]</code> (<code>memorySet_t</code> 类型)</li><li><code>device_Init_Info</code> (<code>deviceInfo_t</code> 类型)</li></ul></li></ul></li><li><p>公有变量有效性验证</p><ul><li><p><code>postureChange_Threshold</code></p><p><strong>说明：</strong>该数据为用户站坐姿态判断阈值，当用户的桌子高度高于这个值时，该值则代表用户当前姿态为站立，否则则为坐姿状态。</p><p><strong>数据类型：</strong>uint16</p><p><strong>数据来源：</strong> </p><hr /><p><em>static void device_Get_Posture( uint8 *buffer )</em></p><p>​	此函数为该数据的来源之一，从snv中读取postureChange_Threshold，如果读取失败则将默认值赋给它。</p><p>​	判断snv读取过程是否成功：</p><p>​	<code>if( osal_snv_read( BLE_NVID_USER_POSTURE, BLE_NVID_USER_POSTURE_LEN, &amp;postureChange_Threshold ) != SUCCESS )</code></p><p>​	如果snv读取失败：</p><p>​	<code>postureChange_Threshold = USER_POSTURE_THRESHOLD_METRIC;</code></p><p>​	<code>postureChange_Threshold = USER_POSTURE_THRESHOLD_IMPERIAL;</code></p><p>​	该过程仅仅在程序初始化时才会执行，所以不会跟device_Set_PostureThreshold( uint8 *getData )所冲突。</p><hr /><p><em>void device_Set_PostureThreshold( uint8 *getData )</em></p><p>​	此函数为该数据的来源之一，在调用该函数时，将需要设置的姿势判断阈值写到该数据中并将该数据写入snv中。</p><p>​	<code>postureChange_Threshold = *(getData) * 256 + *(getData + 1);</code></p><p>​	该过程会在蓝牙数据接收回调时调用，所以需要在初始化过程之后进行调用，否则设置的阈值不会生效。</p><p><strong>作用的函数：</strong></p><hr /><p><em>static void device_Get_Posture( uint8 *buffer )</em></p><p>​	该数据在此函数的作用为将用户的判断阈值作为参数发送到APP端，该方法不会造成该数据改变。</p><p>​	<code>*buffer = postureChange_Threshold / 256;</code></p><p>​	<code>*(buffer + 1) = postureChange_Threshold % 256;</code></p><hr /><p><em>static void performPeriodicTask( uint16 timeParam )</em></p><p>​	该数据在此函数的作用为根据当前高度数值与该数据作比较得出用户站坐姿态，该方法不会造成该数据改变。</p><p>​	<code>userPosture = user_PostureEstimate( pesk_Current_Height, postureChange_Threshold );</code></p><hr /></li><li><p><code>pesk_Stop_Count</code></p><p>     <strong>说明：</strong>该数据为计算桌腿动作持续时间的计量变量。</p><p>     <strong>数据类型：</strong>uint16</p><p>     <strong>数据来源：</strong></p><hr /><p><em>void device_Set_Stop()</em></p><p>     	该数据来源之一为此函数，在此函数中该数据被清零，目的是使桌子立刻停止。</p><p>     	<code>pesk_Stop_Count = 0;</code></p><hr /><p><em>void device_Set_PeskMoveStatus()</em></p><p>     	该数据另一来源为此函数，在此函数中该数据其中一个功能为在桌子上升时自减，桌子下降时自加。目的为动作持续时间的改变。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_DOWN</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">pesk_Stop_Count</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_UP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">pesk_Stop_Count</span><span class="cm-operator">--</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 345px;"></div></div></div></pre><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_UP</span>:</span></pre></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_UP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Stop_Count</span><span class="cm-operator">--</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_DOWN</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_DOWN</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Stop_Count</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">break</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 575px;"></div></div></div></pre><p>     	其中另一个功能为在初次状态变化时计算桌子动作持续时间的最大值。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_UP</span>:</span></pre></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Count_Calculate</span>( (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Current_Height</span>), <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_DOWN</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Count_Calculate</span>( (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Current_Height</span>), <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_SET</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Count_Calculate</span>( (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Current_Height</span>), <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">break</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 690px;"></div></div></div></pre><hr /><p><strong>作用的函数：</strong></p><hr /><p><em>void device_Set_PeskMoveStatus()</em></p><p>     	在此函数中，该数据用于判断桌子当前状态应为上升、下降还是停止。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_DOWN</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">pesk_Stop_Count</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_UP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">pesk_Stop_Count</span><span class="cm-operator">--</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">pesk_Stop_Count</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">cmd_Previous</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_COMMON_STOP</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_CTRL_HANDSET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre><hr /><p>     	由于该变量涉及到的场景较多，所以给出一个较为清晰的逻辑图，分析各个场景下，该变量的变化。</p><p>     <img src='peskmove%20stophighlight.png' alt='peskmove stophighlight' /></p><p>     	在以上流程图中，红色部分为对<code>pesk_Stop_Count</code>变量的改变，且都是在独立分支以下，且执行周期内及各个作用域中都不会造成意外改变。蓝色部分为对<code>pesk_Stop_Count</code>变量的引用，并不会改变变量值。</p><p>     	另一种条件下为手机端信号接收，如果接收到的手机端指令为停止，也会对<code>pesk_Stop_Count</code>变量进行设置。</p><hr /><p></p></li><li><p><code>pesk_Current_Height</code></p><p><strong>说明：</strong> 桌子当前高度</p><p><strong>数据类型：</strong>uint16</p><p><strong>数据来源：</strong> </p><hr /><p><em>void device_Set_PeskMoveStatus()</em></p><p>     	此函数为该数据的唯一来源。目的即将桌腿所发送过来的信息转化为高度信息。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">==</span> <span class="cm-variable">PESK_STATUS_NORMAL</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">=</span> <span class="cm-variable">peskData</span>.<span class="cm-variable">info</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><hr /><p><strong>作用的函数：</strong> </p><hr /><p><em>static void device_Get_DeviceInfo( uint8 *buffer )</em></p><p>	该数据在此函数中的作用为根据当前高度值来判断桌腿的类型，该方法不会造成该数据改变。</p><p>	<code>pesk_Current_Height &lt; PESK_METRICHEIGHT_MIN &amp;&amp; peskData.peskStatus == PESK_STATUS_NORMAL</code></p><hr /><p>	<em>void device_Set_PeskMoveStatus()</em></p><p>	该数据在此函数中有多个作用，然而此函数中均不会造成该数据改变：</p><p>	(1)用于计算持续动作时间</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_UP</span>:</span></pre></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Count_Calculate</span>( (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Current_Height</span>), <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_DOWN</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Count_Calculate</span>( (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Current_Height</span>),<span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">break</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 391px;"></div></div></div></pre><p>	(2)用于判断当前高度是否超过上/下限</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_UP</span>:  </span></pre></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_UP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Stop_Count</span><span class="cm-operator">--</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_DOWN</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_DOWN</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Stop_Count</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">break</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 575px;"></div></div></div></pre><hr /><p>	 <em>void device_Get_HandsetStatus()</em></p><p>	该数据在此函数中作用为将当前的高度数据存入到芯片的snv中。</p><p>	<code>device_Set_Single_Memory( 0, BLE_NVID_MEMORY_HEIGHT1, pesk_Current_Height );</code></p><p>	<code>device_Set_Single_Memory( 1, BLE_NVID_MEMORY_HEIGHT2, pesk_Current_Height );</code></p><p>	<code>device_Set_Single_Memory( 2, BLE_NVID_MEMORY_HEIGHT3, pesk_Current_Height );</code></p><p>	<code>device_Set_Single_Memory( 3, BLE_NVID_MEMORY_HEIGHT4, pesk_Current_Height );</code></p><hr /></li><li><p><code>device_PeskMove_Interval</code></p><p><strong>说明：</strong> 该数据为桌子执行桌子动作时的每次执行周期。</p><p><strong>数据类型：</strong>uint16</p><p><strong>数据来源：</strong> </p><hr /><p><em>static void device_Get_DeviceInfo( uint8 *buffer )</em></p><p>	此函数为该数据的数据来源，目的为将执行桌子动作周期的值进行调整。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-operator">!</span>(<span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">PESK_TYPE_BITS</span>) )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_PeskMove_Interval</span> <span class="cm-operator">=</span> <span class="cm-variable">PESKMOVE_INTERVAL_DOUBLESEG</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-variable">device_PeskMove_Interval</span> <span class="cm-operator">=</span> <span class="cm-variable">PESKMOVE_INTERVAL_TRIPLESEG</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><hr /><p><strong>作用的函数</strong></p><hr /><p><em>static void performPeriodicTask( uint16 timeParam )</em></p><p>	该数据在此函数中的作用为调整桌子动作的执行周期。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-operator">!</span>( <span class="cm-variable">timeParam</span> <span class="cm-operator">%</span> <span class="cm-variable">device_PeskMove_Interval</span> ) )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* Move the pesk */</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Set_PeskMoveStatus</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><hr /></li><li><p><code>uart_DataReceivedCounter</code></p><p><strong>说明：</strong> 该数据的作用为取得每次接收到控制盒异步串行数据的间隔时间。</p><p><strong>数据类型：</strong>uint16</p><p><strong>数据来源：</strong></p><hr /><p><em>void verifyingUartData()</em></p><p>	此函数为该数据的来源，在此函数中，<code>uart_DataReceivedCounter</code> 将自加或清零。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-variable">uart_DataReceivedCounter</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">UART_MAX_COUNTER</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uart_DataReceivedCounter</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">} </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">else</span> </span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uart_DataReceivedCounter</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><hr /><p><strong>作用的函数</strong></p><hr /><p><em>void uart_DataHandle( uint8 numBytes )</em></p><p>	该数据在此函数中的作用为计算每次接收到控制盒异步串行数据的间隔时间，该方法不会造成该数据改变。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span> ( (<span class="cm-variable">numBytes</span> <span class="cm-operator">==</span> <span class="cm-variable">L_RCV_JC_LEN</span>) <span class="cm-operator">&amp;&amp;</span> (<span class="cm-variable">uart_DataReceivedCounter</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">RX_TIME_DELAY</span>) )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> ( <span class="cm-variable">uart_DataReceivedCounter</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">RX_TIME_OVERFLOW</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NPI_ReadTransport</span>( <span class="cm-variable">buffer</span>, <span class="cm-variable">numBytes</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NPI_ClearTransport</span>( <span class="cm-variable">numBytes</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">data</span>[<span class="cm-number">0</span>] <span class="cm-operator">=</span> <span class="cm-operator">*</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">data</span>[<span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-operator">*</span>( <span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">1</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">data</span>[<span class="cm-number">2</span>] <span class="cm-operator">=</span> <span class="cm-operator">*</span>( <span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">2</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">data</span>[<span class="cm-number">3</span>] <span class="cm-operator">=</span> <span class="cm-operator">*</span>( <span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">3</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">previous_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">==</span> <span class="cm-variable">PESKDATA_IN_RST</span> <span class="cm-operator">&amp;&amp;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  ( <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">==</span> <span class="cm-variable">PESKDATA_RST_ERRCODE</span> <span class="cm-operator">||</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  ( (<span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">PESKDATA_IN_NORMAL_FILTER</span>) <span class="cm-operator">!=</span> <span class="cm-variable">PESKDATA_IN_ERROR</span> <span class="cm-operator">&amp;&amp;</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  (<span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">PESKDATA_IN_NORMAL_FILTER</span>) <span class="cm-operator">!=</span> <span class="cm-variable">PESKDATA_IN_NORMAL</span> ) <span class="cm-operator">||</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">==</span> <span class="cm-variable">PESKDATA_RST_ERRCODE2</span> <span class="cm-operator">||</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">==</span> <span class="cm-variable">PESKDATA_RST_ERRCODE3</span>) )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">=</span> <span class="cm-variable">PESKDATA_IN_RST</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span>( <span class="cm-variable">buffer</span><span class="cm-operator">+</span><span class="cm-number">1</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">peskData</span>.<span class="cm-variable">info_H</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span>( <span class="cm-variable">buffer</span><span class="cm-operator">+</span><span class="cm-number">2</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">peskData</span>.<span class="cm-variable">info_L</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span>( <span class="cm-variable">buffer</span><span class="cm-operator">+</span><span class="cm-number">3</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">previous_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">!=</span> <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">previous_PeskData</span> <span class="cm-operator">=</span> <span class="cm-variable">current_PeskData</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">else</span> <span class="cm-keyword">if</span> ( <span class="cm-variable">numBytes</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">L_RCV_JC_LEN</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">NPI_ClearTransport</span>( <span class="cm-variable">numBytes</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">uart_DataReceivedCounter</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 920px;"></div></div></div></pre><hr /><p></p></li><li><p><code>device_Height_Destinate</code></p><p><strong>说明：</strong>该数据为桌子动作的目的高度，在桌子当前状态为<code>SET</code> 时，桌子会以<code>device_Height_Destinate</code> 为目标动作到该位置。</p><p><strong>数据类型：</strong>uint16</p><p><strong>数据来源及应用：</strong> </p><hr /><p><em>int16 device_Count_Calculate( int16 heightDiffer, uint8 standType )</em></p><p><em>static void peskCmdHandle( uint8 cmd_H, uint8 cmd_L )</em></p><p><em>void device_Get_HandsetStatus()</em></p><p>	由于该变量涉及到的场景较多，所以给出几个较为清晰的逻辑图，分析各个场景下，该变量的变化。<img src='peskmove%20destinatehighlight.png' alt='peskmove destinatehighlight' /></p><p>	上图中，红色代表该变量的写入，蓝色代表该变量的读取。</p><p><img src='handset%20destinatehighlight.png' alt='handset destinatehighlight' /></p><p>	上图中，红色代表该变量的写入。</p><hr /><p></p></li><li><p><code>pesk_Lock_Status</code></p><p><strong>说明：</strong>该数据代表桌子的当前锁定状态。如果该值为锁定状态，则无论手控板还是手机端都无法对控制盒进行控制。反之，则可以正常进行控制行为。</p><p><strong>数据类型：</strong>uint8</p><p><strong>数据来源：</strong> </p><hr /><p><em>static void performPeriodicTask( uint16 timeParam )</em></p><p>	此函数为该数据的来源，每一秒检测当前的锁定状态，并将当前锁定状态存入到该数据中。</p><p>	<code>pesk_Lock_Status = device_Get_Current_LockStatus( device_LockData );</code></p><hr /><p><strong>作用的函数：</strong></p><hr /><p><em>uint16 peskMoveCommand( uint8 cmd )</em></p><p>	该数据在此函数中的作用为判断当前状态是否为锁定状态，如果当前为锁定状态，则不执行控制的指令。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_COMMON_CMD</span>:</span></pre></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">pesk_Lock_Status</span> <span class="cm-operator">&amp;&amp;</span> (<span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">!=</span> <span class="cm-variable">DEVICE_CTRL_HANDSET</span>) )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_CTRL_APP</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">stopTime</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STOP_TIMEOUT_COMMON</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">cmd</span> <span class="cm-operator">&amp;</span> <span class="cm-number">0x0f</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_COMMON_UP</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">peskCmdHandle</span>( <span class="cm-variable">DEVICE_COMMON_CMD</span>, <span class="cm-variable">DEVICE_COMMON_UP</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_COMMON_DOWN</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">peskCmdHandle</span>( <span class="cm-variable">DEVICE_COMMON_CMD</span>, <span class="cm-variable">DEVICE_COMMON_DOWN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_COMMON_STOP</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Stop</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Discard the useless command!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_MEMORY_CMD</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">pesk_Lock_Status</span> <span class="cm-operator">&amp;&amp;</span> (<span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">!=</span> <span class="cm-variable">DEVICE_CTRL_HANDSET</span>) )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_CTRL_FREE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">stopTime</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STOP_TIMEOUT_MEMORY</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">cmd</span> <span class="cm-operator">&amp;</span> <span class="cm-number">0x0f</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_MEMORY_SET1</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">peskCmdHandle</span>( <span class="cm-variable">DEVICE_MEMORY_CMD</span>, <span class="cm-variable">DEVICE_MEMORY_SET1</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_MEMORY_SET2</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">peskCmdHandle</span>( <span class="cm-variable">DEVICE_MEMORY_CMD</span>, <span class="cm-variable">DEVICE_MEMORY_SET2</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_MEMORY_SET3</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">peskCmdHandle</span>( <span class="cm-variable">DEVICE_MEMORY_CMD</span>, <span class="cm-variable">DEVICE_MEMORY_SET3</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_MEMORY_SET4</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">peskCmdHandle</span>( <span class="cm-variable">DEVICE_MEMORY_CMD</span>, <span class="cm-variable">DEVICE_MEMORY_SET4</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Discard the useless command!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">break</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1265px;"></div></div></div></pre><hr /><p><em>void device_Get_HandsetStatus()</em></p><p>	该数据在此函数中的作用为判断当前状态是否为锁定状态，如果是锁定状态，则忽略当前手控板所执行的动作。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">pesk_Lock_Status</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">handset_PreviousPressed</span> <span class="cm-operator">!=</span> <span class="cm-variable">handset_CurrentPressed</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SET</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">handset_CurrentPressed</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_UP</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_UP</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_DOWN</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_DOWN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SET1</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">0</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INVALID</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">0</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Single_Memory</span>( <span class="cm-number">0</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT1</span>, <span class="cm-variable">pesk_Current_Height</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SET1</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SET2</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">1</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INVALID</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">1</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Single_Memory</span>( <span class="cm-number">1</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT2</span>, <span class="cm-variable">pesk_Current_Height</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SET2</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SET3</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">2</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INVALID</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">2</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Single_Memory</span>( <span class="cm-number">2</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT3</span>, <span class="cm-variable">pesk_Current_Height</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SET3</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SET4</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">3</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INVALID</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">3</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Single_Memory</span>( <span class="cm-number">3</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT4</span>, <span class="cm-variable">pesk_Current_Height</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SET4</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SETTING</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SETTING</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// should not get here!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">handset_PreviousPressed</span> <span class="cm-operator">=</span> <span class="cm-variable">handset_CurrentPressed</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2254px;"></div></div></div></pre><hr /><p></p></li><li><p><code>user_HealthData_Count</code></p><p><strong>说明：</strong> 用户站坐姿态记录组数。</p><p><strong>数据类型：</strong>uint8</p><p><strong>数据来源：</strong></p><hr /><p><em>static void device_HealthData_Save( uint8 userStatus )</em></p><p>	此函数为该数据的来源，在此函数中，该数据用于自加、及清零，代表<code>HealthData</code> 的索引。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-variable">user_HealthData_Count</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">USER_HEALTHDATA_MAX_COUNT</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">user_HealthData</span>[<span class="cm-variable">user_HealthData_Count</span>].<span class="cm-variable">userStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">userStatus</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">user_HealthData</span>[<span class="cm-variable">user_HealthData_Count</span>].<span class="cm-variable">timeStamp</span> <span class="cm-operator">=</span> <span class="cm-variable">timeStampTemp</span>.<span class="cm-variable">dataValue</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">user_HealthData_Count</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 138px;"></div></div></div></pre><hr /><p><strong>作用的函数</strong></p><hr /><p><em>static void device_HealthData_Save( uint8 userStatus )</em></p><p>	该数据在此函数中的作用为作为索引来指代健康数据数组里的那一组数据。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-variable">user_HealthData_Count</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">USER_HEALTHDATA_MAX_COUNT</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">user_HealthData</span>[<span class="cm-variable">user_HealthData_Count</span>].<span class="cm-variable">userStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">userStatus</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">user_HealthData</span>[<span class="cm-variable">user_HealthData_Count</span>].<span class="cm-variable">timeStamp</span> <span class="cm-operator">=</span> <span class="cm-variable">timeStampTemp</span>.<span class="cm-variable">dataValue</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">user_HealthData_Count</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> (<span class="cm-variable">user_HealthData_Count</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>); <span class="cm-variable">i</span><span class="cm-operator">++</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">user_HealthData</span>[<span class="cm-variable">i</span>] <span class="cm-operator">=</span> <span class="cm-variable">user_HealthData</span>[<span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">user_HealthData</span>[<span class="cm-variable">user_HealthData_Count</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>].<span class="cm-variable">userStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">userStatus</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">user_HealthData</span>[<span class="cm-variable">user_HealthData_Count</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>].<span class="cm-variable">timeStamp</span> <span class="cm-operator">=</span> <span class="cm-variable">timeStampTemp</span>.<span class="cm-variable">dataValue</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">user_HealthData_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 368px;"></div></div></div></pre><hr /><p></p></li><li><p><code>pesk_Move_CurrentStatus</code></p><p><strong>说明：</strong> 该数据为当前桌子的运动状态</p><p><strong>数据类型：</strong>uint8</p><p><strong>数据来源：</strong></p><hr /><p><em>static void peskCmdHandle( uint8 cmd_H, uint8 cmd_L )</em></p><p>	此函数为该数据的来源之一，目的在于处理从手机端所接受到的指令时对该数据的设置。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-variable">cmd_Previous</span> <span class="cm-operator">!=</span> <span class="cm-variable">cmd</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">cmd_H</span> <span class="cm-operator">==</span> <span class="cm-variable">DEVICE_MEMORY_CMD</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">cmd_L</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">cmd_H</span> <span class="cm-operator">==</span> <span class="cm-variable">DEVICE_COMMON_CMD</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">cmd_L</span> <span class="cm-operator">==</span> <span class="cm-variable">DEVICE_COMMON_UP</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">cmd_L</span> <span class="cm-operator">==</span> <span class="cm-variable">DEVICE_COMMON_DOWN</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// Discard the useless command</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// Should not get here</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 644px;"></div></div></div></pre><hr /><p><em>void device_Set_Stop()</em></p><p>	此函数为该数据的另一个来源，目的在于处理手控板或手机端命令结束后需要停止，则需要将该数据进行设置。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-variable">device_Set_Stopvoid</span> <span class="cm-def">device_Set_Stop</span>()</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_CTRL_FREE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">cmd_Previous</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_COMMON_STOP</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 161px;"></div></div></div></pre><hr /><p><strong>作用的函数：</strong></p><hr /><p><em>void device_Set_PeskMoveStatus()</em></p><p>	该数据在此函数中的作用为根据该数据来判断当前桌子的动作状态。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Set_PeskMoveStatus</span>()</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">==</span> <span class="cm-variable">PESK_STATUS_NORMAL</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">=</span> <span class="cm-variable">peskData</span>.<span class="cm-variable">info</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">==</span> <span class="cm-variable">PESK_STATUS_IDLE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">==</span> <span class="cm-variable">PESK_STATUS_SET</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_DOWN</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Stop_Count</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_UP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Stop_Count</span><span class="cm-operator">--</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_IDLE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">pesk_Move_PreviousStatus</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">pesk_Move_CurrentStatus</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_UP</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Count_Calculate</span>( (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Current_Height</span>), <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_DOWN</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Count_Calculate</span>( (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Current_Height</span>), <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_SET</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">if</span>( <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Count_Calculate</span>( (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Current_Height</span>), <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">// should not get here</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Move_CurrentStatus</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">pesk_Stop_Count</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">cmd_Previous</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_COMMON_STOP</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_CTRL_HANDSET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">switch</span>( <span class="cm-variable">pesk_Move_CurrentStatus</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_UP</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_UP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">pesk_Stop_Count</span><span class="cm-operator">--</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_DOWN</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_DOWN</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">pesk_Stop_Count</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">// should not get here!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; }</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2944px;"></div></div></div></pre><hr /><p><em>void device_Get_HandsetStatus()</em></p><p>	在此函数中，该数据的作用为提供当前的动作状态。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Get_HandsetStatus</span>()</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">handset_CurrentPressed</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">handset_PreviousPressed</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">GET_CURRENT_HANDSET</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">!=</span> <span class="cm-variable">DEVICE_CTRL_APP</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">handset_CurrentPressed</span> <span class="cm-operator">==</span> <span class="cm-variable">HANDSET_STATUS_IDLE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_CTRL_FREE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">handset_PreviousPressed</span> <span class="cm-operator">=</span> <span class="cm-variable">HANDSET_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">/* i added this line to solve the problem that once pressed the setting button,</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">handset will continuousily sending the setting command to the control box */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SET</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_STOP</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_CTRL_HANDSET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">pesk_Lock_Status</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">handset_PreviousPressed</span> <span class="cm-operator">!=</span> <span class="cm-variable">handset_CurrentPressed</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SET</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">handset_CurrentPressed</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_UP</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_UP</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_DOWN</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_DOWN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SET1</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">0</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INVALID</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">0</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Single_Memory</span>( <span class="cm-number">0</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT1</span>, <span class="cm-variable">pesk_Current_Height</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SET1</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SET2</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">1</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INVALID</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">1</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Single_Memory</span>( <span class="cm-number">1</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT2</span>, <span class="cm-variable">pesk_Current_Height</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SET2</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SET3</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">2</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INVALID</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">2</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Single_Memory</span>( <span class="cm-number">2</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT3</span>, <span class="cm-variable">pesk_Current_Height</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SET3</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SET4</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">3</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INVALID</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">3</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Single_Memory</span>( <span class="cm-number">3</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT4</span>, <span class="cm-variable">pesk_Current_Height</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SET4</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SETTING</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SETTING</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// should not get here!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">handset_PreviousPressed</span> <span class="cm-operator">=</span> <span class="cm-variable">handset_CurrentPressed</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2875px;"></div></div></div></pre><hr /><p></p></li><li><p><code>cmd_Previous</code></p><p><strong>说明：</strong> 该数据用于存储之前的命令值。</p><p><strong>数据类型：</strong>uint8</p><p><strong>数据来源：</strong> </p><hr /><p><em>uint16 peskMoveCommand( uint8 cmd )</em></p><p>	此函数为该函数的来源之一，它将蓝牙所接收到的控制指令存储到该数据中。</p><p>	<code>cmd_Previous = cmd;</code></p><hr /><p><em>void device_Set_Stop()</em></p><p>	此函数为该数据的另一来源，在<code>device_Set_Stop()</code> 函数被调用时，将停止的命令存储到该数据中。</p><p>	<code>cmd_Previous = DEVICE_COMMON_STOP;</code></p><hr /><p><em>void device_Set_PeskMoveStatus()</em></p><p>	此函数为该数据的最后一处来源，在<code>pesk_Stop_Count</code> 值在此函数中函数被检测到为0时，则将停止的命令存储到该数据中。</p><p>	<code>cmd_Previous = DEVICE_COMMON_STOP;</code></p><hr /><p><strong>作用的函数：</strong></p><hr /><p><em>static void peskCmdHandle( uint8 cmd_H, uint8 cmd_L )</em></p><p>	该数据在此函数中的作用为根据<code>cmd_Previous</code> 的值来判断当前命令值与之前命令值是否相同。</p><p>     	<code>if( cmd_Previous != cmd )</code></p><hr /><p></p></li><li><p><code>device_SendHealthData_Enable</code></p><p><strong>说明：</strong>该数据为布尔型数据，这个数据为一个标志位，当它为true时，即开始发送健康数据，当它为false时，立刻停止发送健康数据。</p><p><strong>数据类型：</strong>bool</p><p><strong>数据来源：</strong> </p><hr /><p><em>uint16 peskMoveCommand( uint8 cmd )</em></p><p>	此函数为该数据的来源之一，此函数作为蓝牙数据接收回调，可以在手机端发送命令时将该数据值设置为true以此让芯片向手机端发送健康数据。</p><p>	<code>device_SendHealthData_Enable = true;</code></p><hr /><p><em>void device_Send_HealthData()</em></p><p>	此函数为该数据的另一个来源，此函数作为健康数据发送过程，在检测到健康数据发送完毕后，将该数据设置为false，以此让芯片停止向手机端发送健康数据。</p><p>	<code>device_SendHealthData_Enable = false;</code></p><hr /><p><strong>作用的函数：</strong></p><hr /><p><em>void device_Send_HealthData()</em></p><p>	该数据在此函数中的作用为判断当前该数据的值为true还是为false，若为true，则向手机单发送健康书，否则反之。</p><p>	<code>if( device_SendHealthData_Enable )</code></p><hr /><p></p></li><li><p><code>device_BLE_Connect_Flag</code></p><p><strong>说明：</strong> 该数据类型为布尔型，当它值设置为true时，则意味着当前设备正在与手机端连接，否则则意味着当前设备与手机端还未建立连接。</p><p><strong>数据类型：</strong>bool</p><p><strong>数据来源：</strong> </p><hr /><p><em>static void peripheralStateNotificationCB( gaprole_States_t newState )</em></p><p>	此函数为该数据的来源，此函数是连接状态改变的回调函数，当连接状态为断开时，则将该数据值设置为false，否则反之。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">case</span> <span class="cm-variable">GAPROLE_ADVERTISING</span>:</span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-meta">#if (defined HAL_LCD) &amp;&amp; (HAL_LCD == TRUE)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">HalLcdWriteString</span>( <span class="cm-string">"Advertising"</span>,  <span class="cm-variable">HAL_LCD_LINE_3</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-meta">#endif </span><span class="cm-comment">// (defined HAL_LCD) &amp;&amp; (HAL_LCD == TRUE)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">GAPROLE_CONNECTED</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  { &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-meta">#if (defined HAL_LCD) &amp;&amp; (HAL_LCD == TRUE)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">HalLcdWriteString</span>( <span class="cm-string">"Connected"</span>,  <span class="cm-variable">HAL_LCD_LINE_3</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-meta">#endif </span><span class="cm-comment">// (defined HAL_LCD) &amp;&amp; (HAL_LCD == TRUE)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_BLE_Connect_Flag</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#ifdef PLUS_BROADCASTER</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Only turn advertising on for this state when we first connect</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// otherwise, when we go from connected_advertising back to this state</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// we will be turning advertising back on.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">first_conn_flag</span> <span class="cm-operator">==</span> <span class="cm-number">0</span> ) </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">uint8</span> <span class="cm-variable">adv_enabled_status</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GAPRole_SetParameter</span>(<span class="cm-variable">GAPROLE_ADVERT_ENABLED</span>, <span class="cm-keyword">sizeof</span>(<span class="cm-variable">uint8</span>), <span class="cm-operator">&amp;</span><span class="cm-variable">adv_enabled_status</span>); <span class="cm-comment">// Turn on Advertising</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">first_conn_flag</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif </span><span class="cm-comment">// PLUS_BROADCASTER</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">GAPROLE_CONNECTED_ADV</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-meta">#if (defined HAL_LCD) &amp;&amp; (HAL_LCD == TRUE)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">HalLcdWriteString</span>( <span class="cm-string">"Connected Advertising"</span>,  <span class="cm-variable">HAL_LCD_LINE_3</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-meta">#endif </span><span class="cm-comment">// (defined HAL_LCD) &amp;&amp; (HAL_LCD == TRUE)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">GAPROLE_WAITING</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-meta">#if (defined HAL_LCD) &amp;&amp; (HAL_LCD == TRUE)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">HalLcdWriteString</span>( <span class="cm-string">"Disconnected"</span>,  <span class="cm-variable">HAL_LCD_LINE_3</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-meta">#endif </span><span class="cm-comment">// (defined HAL_LCD) &amp;&amp; (HAL_LCD == TRUE)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_BLE_Connect_Flag</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">GAPROLE_WAITING_AFTER_TIMEOUT</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-meta">#if (defined HAL_LCD) &amp;&amp; (HAL_LCD == TRUE)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">HalLcdWriteString</span>( <span class="cm-string">"Timed Out"</span>,  <span class="cm-variable">HAL_LCD_LINE_3</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-meta">#endif </span><span class="cm-comment">// (defined HAL_LCD) &amp;&amp; (HAL_LCD == TRUE)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_BLE_Connect_Flag</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#ifdef PLUS_BROADCASTER</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Reset flag for next connection.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">first_conn_flag</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif </span><span class="cm-comment">//#ifdef (PLUS_BROADCASTER)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">GAPROLE_ERROR</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-meta">#if (defined HAL_LCD) &amp;&amp; (HAL_LCD == TRUE)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">HalLcdWriteString</span>( <span class="cm-string">"Error"</span>,  <span class="cm-variable">HAL_LCD_LINE_3</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-meta">#endif </span><span class="cm-comment">// (defined HAL_LCD) &amp;&amp; (HAL_LCD == TRUE)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_BLE_Connect_Flag</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">break</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1541px;"></div></div></div></pre><hr /><p><strong>作用的函数：</strong></p><hr /><p><em>int16 device_Count_Calculate( int16 heightDiffer, uint8 standType )</em></p><p>	该数据在此函数中的作用为重新计算参数，当该数据为true时和为false时的计算参数不同。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">int16</span> <span class="cm-def">device_Count_Calculate</span>( <span class="cm-variable">int16</span> <span class="cm-variable">heightDiffer</span>, <span class="cm-variable">uint8</span> <span class="cm-variable">standType</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">int16</span> <span class="cm-variable">countValue</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint16</span> <span class="cm-variable">pesk_Max_Default</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint16</span> <span class="cm-variable">pesk_Min_Default</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">int16</span> <span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">int16</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable-3">bool</span> <span class="cm-variable">destinate_InCritical</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable-3">bool</span> <span class="cm-variable">over_Critical_Flag</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/*-----------------------------------------</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* arg1[][0] for parameter_Double upward</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* arg1[][1] for parameter_Triple upward</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* arg1[][2] for parameter_Double downward</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* arg1[][3] for parameter_Triple downward</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">int16</span> <span class="cm-variable">arg1</span>[<span class="cm-number">2</span>][<span class="cm-number">4</span>] <span class="cm-operator">=</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-number">2</span>, <span class="cm-operator">-</span><span class="cm-number">30</span>, <span class="cm-number">2</span>, <span class="cm-operator">-</span><span class="cm-number">25</span> },  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-number">2</span>, <span class="cm-operator">-</span><span class="cm-number">13</span>, <span class="cm-number">2</span>, <span class="cm-operator">-</span><span class="cm-number">13</span> }, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  };</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">int16</span> <span class="cm-variable">arg2</span>[<span class="cm-number">2</span>][<span class="cm-number">4</span>] <span class="cm-operator">=</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-operator">-</span><span class="cm-number">6</span>, <span class="cm-number">7</span>, <span class="cm-number">3</span>, <span class="cm-operator">-</span><span class="cm-number">7</span>, },  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-operator">-</span><span class="cm-number">5</span>, <span class="cm-number">7</span>, <span class="cm-number">4</span>, <span class="cm-operator">-</span><span class="cm-number">9</span>, },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  };</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable">int16</span> <span class="cm-variable">inertiaValue</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">switch</span>( <span class="cm-variable">standType</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Max_Default</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Min_Default</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">inertiaValue</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Max_Default</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Min_Default</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">inertiaValue</span> <span class="cm-operator">=</span> <span class="cm-number">4</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Max_Default</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Min_Default</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">inertiaValue</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Max_Default</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Min_Default</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">inertiaValue</span> <span class="cm-operator">=</span> <span class="cm-number">4</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// Should not get here</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-variable">heightDiffer</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span> ) <span class="cm-comment">/* upward */</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Max_Default</span> <span class="cm-operator">-</span> <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">PESK_CRITICAL_VALUE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">destinate_InCritical</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> (<span class="cm-variable">pesk_Max_Default</span> <span class="cm-operator">-</span> <span class="cm-variable">PESK_CRITICAL_VALUE</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>(<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">=</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">over_Critical_Flag</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">heightDiffer</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">inertiaValue</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// FIXME adjust the count value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">destinate_InCritical</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">switch</span>(<span class="cm-variable">standType</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">heightDiffer</span>) <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">1</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">*</span> <span class="cm-number">2</span> <span class="cm-operator">+</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">1</span>] <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">heightDiffer</span>) <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">0</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">0</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">*</span> <span class="cm-number">2</span> <span class="cm-operator">+</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">0</span>] <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">0</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Should not get here!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span> <span class="cm-comment">/* in critical */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">switch</span>(<span class="cm-variable">standType</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">differ_Current_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">differ_Current_Critical</span>) <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">1</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">1</span>] <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">-</span> <span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> <span class="cm-variable">over_Critical_Flag</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">1</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">1</span>] <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">-</span> <span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> <span class="cm-variable">over_Critical_Flag</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">differ_Current_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">differ_Current_Critical</span>) <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">0</span>] </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">0</span>] <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">-</span> <span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> <span class="cm-variable">over_Critical_Flag</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">0</span>] </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">0</span>] <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">-</span> <span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> <span class="cm-variable">over_Critical_Flag</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Should not get here!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">heightDiffer</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span> ) <span class="cm-comment">/* downward */</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Min_Default</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">PESK_CRITICAL_VALUE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">destinate_InCritical</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> (<span class="cm-variable">pesk_Min_Default</span> <span class="cm-operator">+</span> <span class="cm-variable">PESK_CRITICAL_VALUE</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>(<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">=</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">over_Critical_Flag</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">heightDiffer</span> <span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-variable">inertiaValue</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// FIXME adjust the count value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">destinate_InCritical</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">switch</span>(<span class="cm-variable">standType</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">heightDiffer</span>) <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">3</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">3</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">*</span> <span class="cm-number">2</span> <span class="cm-operator">+</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">3</span>] <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">3</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">heightDiffer</span>) <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">2</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">2</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">*</span> <span class="cm-number">2</span> <span class="cm-operator">+</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">2</span>] <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">2</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Should not get here!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span> <span class="cm-comment">/* in critical */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">switch</span>(<span class="cm-variable">standType</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">differ_Current_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">differ_Current_Critical</span>) <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">3</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">3</span>] <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">-</span> <span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> <span class="cm-variable">over_Critical_Flag</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">3</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">3</span>] <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">-</span> <span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> <span class="cm-variable">over_Critical_Flag</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">differ_Current_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">differ_Current_Critical</span>) <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">2</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">2</span>] <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">-</span> <span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> <span class="cm-variable">over_Critical_Flag</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">2</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">2</span>] <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">-</span> <span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> <span class="cm-variable">over_Critical_Flag</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Should not get here!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">return</span> <span class="cm-variable">countValue</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 6095px;"></div></div></div></pre><hr /><p></p></li><li><p><code>pesk_Hardware_Info</code> </p><p>	该数据为结构体变量，其中包含数据：</p><ul><li><p><code>pesk_Hardware_Info.height_Maximum</code></p><p><strong>说明：</strong> 硬件snv中所存储的高度最大值。</p><p><strong>数据类型：</strong>uint16</p><p><strong>数据来源：</strong></p><hr /><p> <em>static void device_Get_MoveRange( uint8 *buffer )</em></p><p>​	此函数为该数据的来源，在执行该函数时，则将<code>buffer</code> 里的值赋值到该数据中。</p></li></ul></li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap     " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code     "><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">device_Get_MoveRange</span>( <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">buffer</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">rangeTemp</span>[<span class="cm-variable">BLE_NVID_PESK_RANGE_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">osal_snv_read</span>( <span class="cm-variable">BLE_NVID_PESK_MAX</span>, <span class="cm-variable">BLE_NVID_PESK_RANGE_LEN</span>, <span class="cm-variable">rangeTemp</span> ) <span class="cm-operator">!=</span>  <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">HEIGHT_VALUE_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">rangeTemp</span>[<span class="cm-number">0</span>] <span class="cm-operator">*</span> <span class="cm-number">256</span> <span class="cm-operator">+</span> <span class="cm-variable">rangeTemp</span>[<span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">osal_snv_read</span>( <span class="cm-variable">BLE_NVID_PESK_MIN</span>, <span class="cm-variable">BLE_NVID_PESK_RANGE_LEN</span>, <span class="cm-variable">rangeTemp</span> ) <span class="cm-operator">!=</span>  <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">HEIGHT_VALUE_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">rangeTemp</span>[<span class="cm-number">0</span>] <span class="cm-operator">*</span> <span class="cm-number">256</span> <span class="cm-operator">+</span> <span class="cm-variable">rangeTemp</span>[<span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span><span class="cm-variable">buffer</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">/</span> <span class="cm-number">256</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">%</span> <span class="cm-number">256</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">2</span>) <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">/</span> <span class="cm-number">256</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">3</span>) <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">%</span> <span class="cm-number">256</span>;</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1541px;"></div></div></div></pre><hr /><p><strong>作用的函数：</strong></p><hr /><p><em>void device_Set_PeskMoveStatus()</em></p><p>	该值在该函数中起到的作用为，作为限值对当前动作状态进行判断。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap    " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">device_Get_MoveRange</span>( <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">buffer</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">rangeTemp</span>[<span class="cm-variable">BLE_NVID_PESK_RANGE_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">osal_snv_read</span>( <span class="cm-variable">BLE_NVID_PESK_MAX</span>, <span class="cm-variable">BLE_NVID_PESK_RANGE_LEN</span>, <span class="cm-variable">rangeTemp</span> ) <span class="cm-operator">!=</span>  <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">HEIGHT_VALUE_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">rangeTemp</span>[<span class="cm-number">0</span>] <span class="cm-operator">*</span> <span class="cm-number">256</span> <span class="cm-operator">+</span> <span class="cm-variable">rangeTemp</span>[<span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">osal_snv_read</span>( <span class="cm-variable">BLE_NVID_PESK_MIN</span>, <span class="cm-variable">BLE_NVID_PESK_RANGE_LEN</span>, <span class="cm-variable">rangeTemp</span> ) <span class="cm-operator">!=</span>  <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">HEIGHT_VALUE_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">rangeTemp</span>[<span class="cm-number">0</span>] <span class="cm-operator">*</span> <span class="cm-number">256</span> <span class="cm-operator">+</span> <span class="cm-variable">rangeTemp</span>[<span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span><span class="cm-variable">buffer</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">/</span> <span class="cm-number">256</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">%</span> <span class="cm-number">256</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">2</span>) <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">/</span> <span class="cm-number">256</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">3</span>) <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">%</span> <span class="cm-number">256</span>;</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1541px;"></div></div></div></pre><hr /><p></p><ul><li><p><code>pesk_Hardware_Info.height_Minimum</code></p><p><strong>说明：</strong> 硬件snv中所存储的高度最大值。</p><p><strong>数据类型：</strong>uint16</p><p><strong>数据来源：</strong> 同上</p><p><strong>作用的函数：</strong> 同上</p></li><li><p><code>user_HealthData[]</code></p><p>  	该数据为结构体变量，其中包含数据：</p><ul><li><p><code>user_HealthData.userStatus</code></p><p><strong>说明：</strong> 该数据为当前姿态改变时的用户姿态。</p><p><strong>数据类型：</strong> uint32</p><p>​	该数据下包含4个uint8数据，分别用于存储该32为数据的4个分数据。</p><p><strong>数据来源：</strong></p><hr /><p><em>static void device_HealthData_Save( uint8 userStatus )</em></p><p>​	此函数为该数据的来源，及将健康数据的信息分次一个一个赋值到该数据中。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#pragma inline = forced</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">device_HealthData_Save</span>( <span class="cm-variable">uint8</span> <span class="cm-variable">userStatus</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">seprate_DataU32_t</span> <span class="cm-variable">timeStampTemp</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">userStatus_Previous</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">userStatus_Previous</span> <span class="cm-operator">!=</span> <span class="cm-variable">userStatus</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">timeStampTemp</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Get_Current_Timestamp</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">user_HealthData_Count</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">USER_HEALTHDATA_MAX_COUNT</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">user_HealthData</span>[<span class="cm-variable">user_HealthData_Count</span>].<span class="cm-variable">userStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">userStatus</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">user_HealthData</span>[<span class="cm-variable">user_HealthData_Count</span>].<span class="cm-variable">timeStamp</span> <span class="cm-operator">=</span> <span class="cm-variable">timeStampTemp</span>.<span class="cm-variable">dataValue</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">user_HealthData_Count</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> (<span class="cm-variable">user_HealthData_Count</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>); <span class="cm-variable">i</span><span class="cm-operator">++</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">user_HealthData</span>[<span class="cm-variable">i</span>] <span class="cm-operator">=</span> <span class="cm-variable">user_HealthData</span>[<span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">user_HealthData</span>[<span class="cm-variable">user_HealthData_Count</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>].<span class="cm-variable">userStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">userStatus</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">user_HealthData</span>[<span class="cm-variable">user_HealthData_Count</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>].<span class="cm-variable">timeStamp</span> <span class="cm-operator">=</span> <span class="cm-variable">timeStampTemp</span>.<span class="cm-variable">dataValue</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">user_HealthData_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">userStatus_Previous</span> <span class="cm-operator">=</span> <span class="cm-variable">userStatus</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 644px;"></div></div></div></pre><hr /><p><strong>作用的函数：</strong></p><hr /><p><em>void device_Send_HealthData()</em></p><p>​	该数据在此函数的中的作用为作为健康数据发送给手机端。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Send_HealthData</span>()</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">sendBuffer_Char8</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">getBuffer</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">healthData_Send_Count</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">device_SendHealthData_Enable</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">sendBuffer_Char8</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">osal_mem_alloc</span>( <span class="cm-keyword">sizeof</span>(<span class="cm-variable">uint8</span>) <span class="cm-operator">*</span> <span class="cm-variable">SIMPLEPROFILE_CHAR8_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">getBuffer</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">user_HealthData</span> <span class="cm-operator">+</span> (<span class="cm-variable">SIMPLEPROFILE_CHAR8_LEN</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>) <span class="cm-operator">*</span> <span class="cm-variable">healthData_Send_Count</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-operator">*</span><span class="cm-variable">sendBuffer_Char8</span> <span class="cm-operator">=</span> <span class="cm-variable">healthData_Send_Count</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">SIMPLEPROFILE_CHAR8_LEN</span> <span class="cm-operator">-</span> <span class="cm-number">1</span> ; <span class="cm-variable">i</span><span class="cm-operator">++</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">sendBuffer_Char8</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span> <span class="cm-operator">*</span>(<span class="cm-variable">getBuffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>); </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR8</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR8_LEN</span>, <span class="cm-variable">sendBuffer_Char8</span> ); </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">osal_mem_free</span>( <span class="cm-variable">sendBuffer_Char8</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">healthData_Send_Count</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable">USER_HEALTHDATA_MAX_COUNT</span> <span class="cm-operator">/</span> <span class="cm-number">3</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">healthData_Send_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_SendHealthData_Enable</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 598px;"></div></div></div></pre><hr /></li><li><p><code>user_HealthData.timeStamp</code></p><p><strong>说明：</strong> 该数据为当前姿态改变时的时间戳。</p><p><strong>数据类型：</strong> uint32</p><p>​	该数据下包含4个uint8数据，分别用于存储该32为数据的4个分数据。</p><p><strong>数据来源：</strong> 同上</p><p><strong>作用的函数：</strong> 同上</p></li></ul></li><li><p><code>device_LockData</code> </p><p>  	该数据为结构体变量，其中包含数据：</p><ul><li><p><code>device_LockData.lockStatus</code></p><p><strong>说明：</strong> 该数据表现为桌子的锁定状态，如果该值为<code>LOCKED</code> 则代表当前桌子有可能为延时解锁状态也有可能为锁定状态。</p><p><strong>数据类型：</strong>uint8</p><p><strong>数据来源：</strong> </p><hr /><p><em>static void device_Get_Lock( uint8 *buffer )</em></p><p>​	此函数为该数据的来源，当初始化时如果snv为中没有锁定数据的话，则将默认非锁定状态写入该数据中。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">device_Get_Lock</span>( <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">buffer</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">osal_snv_read</span>( <span class="cm-variable">BLE_NVID_DEVICE_LOCK</span>, <span class="cm-variable">BLE_NVID_DEVICE_LOCK_LEN</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">device_LockData</span>.<span class="cm-variable">lockStatus</span> ) <span class="cm-operator">!=</span> <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_LockData</span>.<span class="cm-variable">lockStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_UNLOCK</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span><span class="cm-variable">buffer</span> <span class="cm-operator">=</span> <span class="cm-variable">device_LockData</span>.<span class="cm-variable">lockStatus</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">BLE_NVID_DEVICE_LOCK_LEN</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span> <span class="cm-number">0x00</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 299px;"></div></div></div></pre><hr /><p><em>void device_Set_LockData( uint8 *getData )</em></p><p>​	此函数为该数据的来源，当接收到蓝牙指令时，将该指令的数据悉数写入该数据中。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Set_LockData</span>( <span class="cm-variable">uint8</span><span class="cm-operator">*</span> <span class="cm-variable">getData</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_LockData</span>.<span class="cm-variable">lockStatus</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span><span class="cm-variable">getData</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_LockData</span>.<span class="cm-variable">timeStamp_S</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span> <span class="cm-operator">-</span> <span class="cm-variable">i</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-operator">*</span>(<span class="cm-variable">getData</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_snv_write</span>( <span class="cm-variable">BLE_NVID_DEVICE_LOCK</span>, <span class="cm-variable">BLE_NVID_DEVICE_LOCK_LEN</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">device_LockData</span>.<span class="cm-variable">lockStatus</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 230px;"></div></div></div></pre><hr /><p><strong>作用的函数：</strong></p><hr /><p><em>static void device_Get_Lock( uint8 *buffer )</em></p><p>​	该数据在此函数中的作用为将数据通过蓝牙发送到手机端。</p><p>​	<code>*buffer = device_LockData.lockStatus;</code></p><hr /><p><em>void device_Set_LockData( uint8 *getData )</em></p><p>​	该数据在此函数中的作用为将锁定值写入到snv中。</p><p>​	<code>osal_snv_write( BLE_NVID_DEVICE_LOCK, BLE_NVID_DEVICE_LOCK_LEN, &amp;device_LockData.lockStatus );</code></p><hr /></li><li><p><code>device_LockData.timeStamp</code></p><p><strong>说明：</strong> 该数据为桌子延时锁定状态剩余时间时间戳。</p><p><strong>数据类型：</strong>uint32</p><p>​	该数据下有4个uint8类型，用来分解这个uint32类型的数据。</p><p><strong>数据来源：</strong> 同上</p><p><strong>作用的函数：</strong> 除去<code>device_Set_Lock( uint8 *buffer )</code> 的<code>osal_snv_write( BLE_NVID_DEVICE_LOCK, BLE_NVID_DEVICE_LOCK_LEN, &amp;device_LockData.lockStatus );</code> 以外，同上</p></li></ul></li><li><p><code>device_Memory_Set[]</code></p><p>  	该数据为结构体变量，其中包含数据：</p><ul><li><p><code>device_Memory_Set.heightValue</code></p><p><strong>说明：</strong>该数据为记忆位置，是一个数组，代表所有的记忆位置。</p><p><strong>数据类型：</strong>uint16</p><p>​	该该数据下有2个uint8类型数据，用于分解这个uint16类型的数据。</p><p><strong>数据来源：</strong> </p><hr /><p><em>static void device_Get_MemoryInit( uint8 *buffer )</em></p><p>​	此函数为该数据的来源之一，为了在初始化阶段对<code>device_Memory_Set.heightValue</code> 进行赋值。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">device_Get_MemoryInit</span>( <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">buffer</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">dataTemp</span>[<span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span> <span class="cm-operator">*</span> <span class="cm-variable">DEVICE_MEMORY_NUM</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-variable">i</span> <span class="cm-operator">+=</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">osal_snv_read</span>( <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT1</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>, <span class="cm-variable">dataTemp</span> ) <span class="cm-operator">!=</span> <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Default</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>].<span class="cm-variable">height_H</span> <span class="cm-operator">=</span> <span class="cm-variable">dataTemp</span>[<span class="cm-number">0</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>].<span class="cm-variable">height_L</span> <span class="cm-operator">=</span> <span class="cm-variable">dataTemp</span>[<span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>].<span class="cm-variable">height_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>].<span class="cm-variable">height_L</span>; </span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre><hr /><p><em>void device_Set_Multiple_Memory( uint16 *setHeight )</em></p><p>​	此函数为该数据的来源之一，为了在手机端发送记忆位置时对<code>device_Memory_Set.heightValue</code> 进行赋值。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Set_Multiple_Memory</span>( <span class="cm-variable">uint16</span> <span class="cm-operator">*</span><span class="cm-variable">setHeight</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">buffer</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">dataTemp</span>[<span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">DEVICE_MEMORY_NUM</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">*</span>(<span class="cm-variable">setHeight</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>) <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INGNORED</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span>(<span class="cm-variable">setHeight</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">dataTemp</span>[<span class="cm-number">0</span>] <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">dataTemp</span>[<span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">osal_snv_write</span>( (<span class="cm-variable">BLE_NVID_MEMORY_HEIGHT1</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>), <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>, <span class="cm-variable">dataTemp</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-number">2</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-number">2</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span>  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR1</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 460px;"></div></div></div></pre><hr /><p><em>void device_Set_Single_Memory( int index, uint8 ble_NVID, uint16 setHeight )</em></p><p>​	此函数为该数据的来源之一，为了在手控板上设置忆位置时对<code>device_Memory_Set.heightValue</code> 进行赋值。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Set_Multiple_Memory</span>( <span class="cm-variable">uint16</span> <span class="cm-operator">*</span><span class="cm-variable">setHeight</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">buffer</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">dataTemp</span>[<span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">DEVICE_MEMORY_NUM</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">*</span>(<span class="cm-variable">setHeight</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>) <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INGNORED</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span>(<span class="cm-variable">setHeight</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">dataTemp</span>[<span class="cm-number">0</span>] <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">dataTemp</span>[<span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">osal_snv_write</span>( (<span class="cm-variable">BLE_NVID_MEMORY_HEIGHT1</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>), <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>, <span class="cm-variable">dataTemp</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-number">2</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-number">2</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span>  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR1</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 460px;"></div></div></div></pre><hr /><p><strong>作用的函数：</strong> </p><hr /><p><em>void device_Set_Single_Memory( int index, uint8 ble_NVID, uint16 setHeight )</em></p><p>​	该数据在此函数中作用为发送该数据到手机端。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Set_Multiple_Memory</span>( <span class="cm-variable">uint16</span> <span class="cm-operator">*</span><span class="cm-variable">setHeight</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">buffer</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">dataTemp</span>[<span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">DEVICE_MEMORY_NUM</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">*</span>(<span class="cm-variable">setHeight</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>) <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INGNORED</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span>(<span class="cm-variable">setHeight</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">dataTemp</span>[<span class="cm-number">0</span>] <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">dataTemp</span>[<span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">osal_snv_write</span>( (<span class="cm-variable">BLE_NVID_MEMORY_HEIGHT1</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>), <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>, <span class="cm-variable">dataTemp</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-number">2</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-number">2</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span>  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR1</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 460px;"></div></div></div></pre><hr /><p><em>static void device_Get_MemoryInit( uint8 *buffer )</em></p><p>​	该数据在此函数中作用为发送该数据到手机端。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">device_Get_MemoryInit</span>( <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">buffer</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">dataTemp</span>[<span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span> <span class="cm-operator">*</span> <span class="cm-variable">DEVICE_MEMORY_NUM</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-variable">i</span> <span class="cm-operator">+=</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">osal_snv_read</span>( <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT1</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>, <span class="cm-variable">dataTemp</span> ) <span class="cm-operator">!=</span> <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Default</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>].<span class="cm-variable">height_H</span> <span class="cm-operator">=</span> <span class="cm-variable">dataTemp</span>[<span class="cm-number">0</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>].<span class="cm-variable">height_L</span> <span class="cm-operator">=</span> <span class="cm-variable">dataTemp</span>[<span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>].<span class="cm-variable">height_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>].<span class="cm-variable">height_L</span>; </span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre><hr /><p><em>void device_Set_Multiple_Memory( uint16 *setHeight )</em></p><p>​	该数据在此函数中作用为发送该数据到手机端。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Set_Multiple_Memory</span>( <span class="cm-variable">uint16</span> <span class="cm-operator">*</span><span class="cm-variable">setHeight</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">buffer</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">dataTemp</span>[<span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">DEVICE_MEMORY_NUM</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">*</span>(<span class="cm-variable">setHeight</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>) <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INGNORED</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span>(<span class="cm-variable">setHeight</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">dataTemp</span>[<span class="cm-number">0</span>] <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">dataTemp</span>[<span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">osal_snv_write</span>( (<span class="cm-variable">BLE_NVID_MEMORY_HEIGHT1</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>), <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>, <span class="cm-variable">dataTemp</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-number">2</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-number">2</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span>  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR1</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 460px;"></div></div></div></pre><hr /><p><em>void device_Get_HandsetStatus()</em></p><p>​	该数据在此函数中的作用为在手控板上按下动作到指定记忆位置时，将目的高度设置为当前记忆位置值。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Get_HandsetStatus</span>()</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">handset_CurrentPressed</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">handset_PreviousPressed</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">GET_CURRENT_HANDSET</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">!=</span> <span class="cm-variable">DEVICE_CTRL_APP</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">handset_CurrentPressed</span> <span class="cm-operator">==</span> <span class="cm-variable">HANDSET_STATUS_IDLE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_CTRL_FREE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">handset_PreviousPressed</span> <span class="cm-operator">=</span> <span class="cm-variable">HANDSET_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">/* i added this line to solve the problem that once pressed the setting button,</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">handset will continuousily sending the setting command to the control box */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SET</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_STOP</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_CTRL_HANDSET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">pesk_Lock_Status</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">handset_PreviousPressed</span> <span class="cm-operator">!=</span> <span class="cm-variable">handset_CurrentPressed</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SET</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">handset_CurrentPressed</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_UP</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_UP</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_DOWN</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_DOWN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SET1</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">0</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INVALID</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">0</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Single_Memory</span>( <span class="cm-number">0</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT1</span>, <span class="cm-variable">pesk_Current_Height</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SET1</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SET2</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">1</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INVALID</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">1</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Single_Memory</span>( <span class="cm-number">1</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT2</span>, <span class="cm-variable">pesk_Current_Height</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SET2</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SET3</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">2</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INVALID</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">2</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Single_Memory</span>( <span class="cm-number">2</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT3</span>, <span class="cm-variable">pesk_Current_Height</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SET3</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SET4</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">3</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INVALID</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">3</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Single_Memory</span>( <span class="cm-number">3</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT4</span>, <span class="cm-variable">pesk_Current_Height</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SET4</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SETTING</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SETTING</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// should not get here!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">handset_PreviousPressed</span> <span class="cm-operator">=</span> <span class="cm-variable">handset_CurrentPressed</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2875px;"></div></div></div></pre><hr /><p><em>static void peskCmdHandle( uint8 cmd_H, uint8 cmd_L )</em></p><p>​	该数据在此函数中的作用为在手机端发送动作到指定记忆位置时，将目的高度设置为当前记忆位置值。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">peskCmdHandle</span>( <span class="cm-variable">uint8</span> <span class="cm-variable">cmd_H</span>, <span class="cm-variable">uint8</span> <span class="cm-variable">cmd_L</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">cmd</span> <span class="cm-operator">=</span> <span class="cm-variable">cmd_H</span> <span class="cm-operator">|</span> <span class="cm-variable">cmd_L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">cmd_Previous</span> <span class="cm-operator">!=</span> <span class="cm-variable">cmd</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">cmd_H</span> <span class="cm-operator">==</span> <span class="cm-variable">DEVICE_MEMORY_CMD</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">cmd_L</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">cmd_H</span> <span class="cm-operator">==</span> <span class="cm-variable">DEVICE_COMMON_CMD</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">cmd_L</span> <span class="cm-operator">==</span> <span class="cm-variable">DEVICE_COMMON_UP</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">cmd_L</span> <span class="cm-operator">==</span> <span class="cm-variable">DEVICE_COMMON_DOWN</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Discard the useless command</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Should not get here</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 736px;"></div></div></div></pre><hr /><p>​</p></li></ul></li><li><p><code>peskData</code></p><p>该数据为结构体变量，其中包含数据：</p><ul><li><p><code>peskData.peskStatus</code></p><p><strong>说明：</strong>从捷昌控制盒异步串口所得到的数据，代表桌子当前状态，状态分别有正常（高度显示），错误（E01、E02、H01……），重启（RST），保存（S-、S-1、S-2……），具体数据格式参照&lt;表2-2&gt;。</p><p><strong>数据类型：</strong>uint8</p><p><strong>数据来源：</strong> </p><hr /><p><em>uart_DataHandle( uint8 numBytes )</em></p><p>​	此函数为该数据的来源，从控制盒获得的异步数据经过处理后得到该数据，用于表示桌腿当前的状态。</p><p>​	具体参数形式参照&lt;表2-2&gt;。</p><p>​	<code>peskData.peskStatus = *( buffer+1 );</code></p><hr /><p><strong>作用的函数：</strong> </p><hr /><p><em>device_Get_DeviceInfo( uint8 *buffer )</em></p><p>​	该数据在此函数中用为在获取桌子高度时判断桌腿状态是否正常，该方法不会造成该数据改变。</p><p>​	<code>if( pesk_Current_Height &lt; PESK_METRICHEIGHT_MIN &amp;&amp; peskData.peskStatus == PESK_STATUS_NORMAL )</code></p><hr /><p><em>device_Send_PeskData( uint16 send_Interval )</em></p><p>​	该数据在此函数中用于蓝牙数据的发送，该方法不会造成该数据改变。</p><p>​	<code>*buffer = peskData.peskStatus;</code></p><hr /><p><em>device_HeightInfo_Setup()</em></p><p>​	该数据在此函数中用于蓝牙数据的发送，该方法不会造成该数据改变。</p><p>​	<code>*buffer = peskData.peskStatus;</code></p><hr /><p><em>device_Set_PeskMoveStatus()</em></p><p>​	该数据在此函数中用为判断桌腿当前状态（正常、非正常、保存），该方法不会造成数据改变。</p><p>​	<code>if( peskData.peskStatus == PESK_STATUS_NORMAL )</code></p><p>​	<code>else if( peskData.peskStatus != PESK_STATUS_SAVE )</code></p><hr /><p><em>device_Get_HandsetStatus()</em></p><p>​	该数据在此函数中用为判断桌腿当前状态（是否为保存），该方法不会造成该数据改变。</p><p>​	<code>if( peskData.peskStatus != PESK_STATUS_SAVE )</code></p><hr /><p><em>performPeriodicTask( uint16 timeParam )</em></p><p>​	该数据在此函数中的作用为在判断用户姿态时，桌腿状态是否为正常，该方法不会造成该数据改变。</p><p>​	<code>if( peskData.peskStatus == PESK_STATUS_NORMAL )</code></p><hr /></li><li><p><code>peskData.info</code></p><p><strong>说明：</strong>从捷昌控制盒异步串口所得到的数据，代表桌腿当前所发送的信息，包括高度信息、存储信息、错误信息等，具体数据格式参照&lt;表2-2&gt;。</p><p><strong>数据类型：</strong>uint16</p><p>​	<code>peskData.info</code>下有两个uint8类型数据，分别用于表示它的高八位和低八位。</p><p>​	<code>peskData.info_H</code>代表高八位。</p><p>​	<code>peskData.info_L</code>代表低八位。</p><p><strong>数据来源：</strong> </p><hr /><p><em>void uart_DataHandle( uint8 numBytes )</em></p><p>​	此函数为该数据的来源，从控制盒获得的异步数据经过处理后得到该数据，用于表示桌腿当前的状态。</p><p>​	具体参数形式参照&lt;表2-2&gt;。</p><p>​	<code>peskData.info_H = *( buffer+2 );</code></p><p>​	<code>peskData.info_L = *( buffer+3 );</code></p><p>​	<em>注：通过对peskData.info_H和peskData.info_L的赋值可以间接对peskData.info赋值。</em></p><hr /><p><strong>作用的函数:</strong> </p><hr /><p><em>int16 device_Send_PeskData( uint16 send_Interval )</em></p><p>​	该数据在此函数中的作用为在速度计算中提供桌子高度信息，在蓝牙信息发送中提供桌子高度信息、错误信息、保存信息等，具体参数形式参照&lt;表2-2&gt;，该方法不会造成该数据改变。</p><p>​	速度计算中提供高度信息：</p><p>​	<code>previousData = peskData;</code></p><p>​	<code>speed_FIFO = Data_FIFO_In( speed_FIFO, (peskData.info - previousData.info), FIFO_DATA_MAX );</code></p><p>​	在蓝牙信息发送中提供高度信息、错误信息、保存信息等：</p><p>​	<code>previousData_Send = peskData;</code></p><p>​	<code>*(buffer + 2) = peskData.info_H;</code></p><p>​	<code>*(buffer + 3) = peskData.info_L;</code></p><p>​	<em>注：通过对peskData.info_H和peskData.info_L的读取可以间接对peskData.info取值。</em></p><hr /><p><em>void device_HeightInfo_Setup()</em></p><p>​	该数据在此函数中的作用为在初硬件始化时提供桌子高度信息，并在蓝牙信息发送中提供桌子高度信息、错误信息、保存信息等，具体参数形式参照&lt;表2-2&gt;，该方法不会造成该数据改变。</p><p>​	<code>*(buffer + 2) = peskData.info_H;</code></p><p>​	<code>*(buffer + 3) = peskData.info_L;</code></p><p>​	<em>注：通过对peskData.info_H和peskData.info_L的读取可以间接对peskData.info取值。</em></p><hr /><p><em>void device_Set_PeskMoveStatus()</em></p><p>​	该数据在此函数中的作用为在桌子控制过程当中提供桌子高度信息，具体参数形式参照&lt;表2-2&gt;，该方法不会造成该数据改变。</p><p>​	<code>pesk_Current_Height = peskData.info;</code></p><hr /></li><li><p><code>peskData.userPosture</code></p><p><strong>说明：</strong> 该值为人体姿态数据，根据当前高度值来判断人体姿态，如果高度超过判断阈值，则判断人体当前为站姿，具体数据格式参照&lt;表2-2&gt;。</p><p><strong>数据类型：</strong>uint8</p><p><strong>数据来源：</strong> </p><hr /><p><em>static void performPeriodicTask( uint16 timeParam )</em></p><p>​	此函数中存在该数据的来源，通过高度值判断得到的用户姿势，具体数据格式参照&lt;表2-2&gt;。</p><p>​	<code>peskData.userPosture = userPosture;</code></p><hr /><p><strong>作用的函数：</strong></p><hr /><p><em>int16 device_Send_PeskData( uint16 send_Interval )</em></p><p>​	该数据在此函数中的作用为将人体姿态信息通过蓝牙发送到APP端、以及将人体姿态存入健康数据。具体数据格式参照&lt;表2-2&gt;，该方法不会造成该数据改变。</p><p>​	将人体姿态信息存入健康数据：</p><p>​	<code>device_HealthData_Save( peskData.userPosture );</code></p><p>​	将人体姿态信息通过蓝牙发送到APP端：</p><p>​	<code>*(buffer + 1) = peskData.userPosture;</code></p><hr /></li></ul></li><li><p><code>device_Init_Info</code></p><p>该数据为结构体变量，其中包含数据：</p><ul><li><p><code>device_Init_Info.peskType</code></p><p><strong>说明：</strong>该数据为硬件信息中的桌腿类型，桌腿的类型直接影响到桌子动作的上下限，桌子动作持续时间的计算参数。</p><p><strong>数据类型：</strong>uint8</p><p><strong>数据来源：</strong> </p><hr /><p><em>static void device_Get_DeviceInfo( uint8 *buffer )</em></p><p>​	此函数为该数据的来源，此函数为该数据写入手机端所发送的硬件信息数据，也同时在初始化时对硬件信息进行读取。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">osal_snv_read</span>( <span class="cm-variable">BLE_NVID_HARDWARE_INFO</span>, <span class="cm-variable">BLE_NVID_HARDWARE_INFO_LEN</span>, <span class="cm-variable">tempData</span> ) <span class="cm-operator">!=</span> <span class="cm-variable">SUCCESS</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_PESK_DEFAULT</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">PESK_METRICHEIGHT_MIN</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">==</span> <span class="cm-variable">PESK_STATUS_NORMAL</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">|=</span> <span class="cm-variable">PESK_UNIT_BIT</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">&amp;=</span> <span class="cm-variable">~PESK_UNIT_BIT</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">deviceType</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_TYPE_DEFAULT</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">deviceVersion</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_VERSION_DEFAULT</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">deviceType</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span><span class="cm-variable">tempData</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span>(<span class="cm-variable">tempData</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">deviceVersion</span> <span class="cm-operator">=</span> (<span class="cm-operator">*</span>(<span class="cm-variable">tempData</span> <span class="cm-operator">+</span> <span class="cm-number">2</span>) <span class="cm-operator">&lt;&lt;</span> <span class="cm-number">8</span>) <span class="cm-operator">|</span> <span class="cm-operator">*</span>(<span class="cm-variable">tempData</span> <span class="cm-operator">+</span> <span class="cm-number">3</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre><hr /><p><strong>作用的函数：</strong></p><hr /><p><em>static void device_Get_MoveRange( uint8 *buffer )</em></p><p>​	该数据在此函数中的作用为为桌子的上下限设置提供依据。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 345px;"></div></div></div></pre><hr /><p><em>static void device_Get_DeviceInfo( uint8 *buffer )</em></p><p>​	该数据在此函数中的作用为向手机端发送该数据。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span><span class="cm-variable">buffer</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">deviceType</span>;</span></pre></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">2</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">version_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">3</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">version_L</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><hr /><p><em>static void device_Get_Posture( uint8 *buffer )</em></p><p>​	该数据在此函数中的作用为在初始化过程中为用户站坐判断阈值提供依据。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-operator">!</span>(<span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">PESK_UNIT_BIT</span>) )</span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">postureChange_Threshold</span> <span class="cm-operator">=</span> <span class="cm-variable">USER_POSTURE_THRESHOLD_METRIC</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">postureChange_Threshold</span> <span class="cm-operator">=</span> <span class="cm-variable">USER_POSTURE_THRESHOLD_IMPERIAL</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><hr /><p><em>void device_Set_PeskMoveStatus()</em></p><p>​	该数据在此函数中的作用为在设置桌子动作状态时，为桌子动作持续时间及上下限提供依据。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Count_Calculate</span>( (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Current_Height</span>),<span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> );</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 46px;"></div></div></div></pre><hr /><p><em>void device_Count_Calibration( int16 pesk_Move_Speed )</em></p><p>​	该数据在此函数中的作用为在动态校准过程中，为桌子动作持续时间提供依据。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">switch</span>(<span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span>)</span></pre></div><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">args</span> <span class="cm-operator">=</span> <span class="cm-variable">arg_DoubleSeg</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">args</span> <span class="cm-operator">=</span> <span class="cm-variable">arg_TripleSeg</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">args</span> <span class="cm-operator">=</span> <span class="cm-variable">arg_DoubleSeg</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_Speed</span> <span class="cm-operator">*=</span> <span class="cm-variable">SCALE_IMPERIAL_TO_METRIC</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">heightDiffer</span> <span class="cm-operator">*=</span> <span class="cm-variable">SCALE_IMPERIAL_TO_METRIC</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">args</span> <span class="cm-operator">=</span> <span class="cm-variable">arg_TripleSeg</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_Speed</span> <span class="cm-operator">*=</span> <span class="cm-variable">SCALE_IMPERIAL_TO_METRIC</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">heightDiffer</span> <span class="cm-operator">*=</span> <span class="cm-variable">SCALE_IMPERIAL_TO_METRIC</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// should not get here</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_Speed</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">args</span>[<span class="cm-number">0</span>] )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Count_Calculate</span>( (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Current_Height</span>), <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">-</span> <span class="cm-variable">pesk_Move_Speed</span> <span class="cm-operator">/</span> <span class="cm-variable">args</span>[<span class="cm-number">1</span>] <span class="cm-operator">*</span> <span class="cm-variable">args</span>[<span class="cm-number">2</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_Speed</span> <span class="cm-operator">&lt;</span> <span class="cm-operator">-</span><span class="cm-variable">args</span>[<span class="cm-number">0</span>] )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Count_Calculate</span>( (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> &nbsp;  <span class="cm-variable">pesk_Current_Height</span>), <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-operator">-</span> <span class="cm-variable">pesk_Move_Speed</span> <span class="cm-operator">/</span> <span class="cm-variable">args</span>[<span class="cm-number">3</span>] <span class="cm-operator">*</span> <span class="cm-variable">args</span>[<span class="cm-number">4</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> }</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 874px;"></div></div></div></pre></li></ul><hr /><ul><li><p><code>device_Init_Info.deviceType</code></p><p><strong>说明：</strong>该数据为硬件信息中的设备类型，<code>CUBE</code>，<code>BAR</code>或者是<code>BAR2</code> 。</p><p><strong>数据类型：</strong>uint8</p><p><strong>数据来源：</strong> </p><hr /><p><em>static void device_Get_DeviceInfo( uint8 *buffer )</em></p><p>​	此函数为该数据的来源，在初始化时或手机端发送相应数据时，都会将该数据改变。</p><p>​	<code>device_Init_Info.deviceType = DEVICE_TYPE_DEFAULT;</code></p><p>​	<code>device_Init_Info.deviceType = *tempData;</code></p><hr /><p><strong>作用的函数：</strong></p><hr /><p><em>static void device_Get_DeviceInfo( uint8 *buffer )</em></p><p>​	该数据在此函数中的作用为向手机端发送硬件信息时需要提供此数据。</p><p>​	<code>*buffer = device_Init_Info.deviceType;</code></p><hr /></li><li><p><code>device_Init_Info.deviceVersion</code></p><p><strong>说明：</strong>该数据为硬件信息中的设备类型，<code>CUBE</code>，<code>BAR</code>或者是<code>BAR2</code> 。</p><p><strong>数据类型：</strong>uint16</p><p>​	该数据下有2个uint8类型，用于分解该uint16类型数据。</p><p><strong>数据来源：</strong></p><hr /><p><em>static void device_Get_DeviceInfo( uint8 *buffer )</em></p><p>	此函数为该数据的来源，在初始化时或手机端发送相应数据时，都会将该数据改变。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">if</span>( <span class="cm-variable">osal_snv_read</span>( <span class="cm-variable">BLE_NVID_HARDWARE_INFO</span>, <span class="cm-variable">BLE_NVID_HARDWARE_INFO_LEN</span>, <span class="cm-variable">tempData</span> ) <span class="cm-operator">!=</span> <span class="cm-variable">SUCCESS</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_PESK_DEFAULT</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">PESK_METRICHEIGHT_MIN</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">==</span> <span class="cm-variable">PESK_STATUS_NORMAL</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">|=</span> <span class="cm-variable">PESK_UNIT_BIT</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">&amp;=</span> <span class="cm-variable">~PESK_UNIT_BIT</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">deviceType</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_TYPE_DEFAULT</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">deviceVersion</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_VERSION_DEFAULT</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">deviceType</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span><span class="cm-variable">tempData</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span>(<span class="cm-variable">tempData</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">deviceVersion</span> <span class="cm-operator">=</span> (<span class="cm-operator">*</span>(<span class="cm-variable">tempData</span> <span class="cm-operator">+</span> <span class="cm-number">2</span>) <span class="cm-operator">&lt;&lt;</span> <span class="cm-number">8</span>) <span class="cm-operator">|</span> <span class="cm-operator">*</span>(<span class="cm-variable">tempData</span> <span class="cm-operator">+</span> <span class="cm-number">3</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span>(<span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">PESK_TYPE_BITS</span>) )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_PeskMove_Interval</span> <span class="cm-operator">=</span> <span class="cm-variable">PESKMOVE_INTERVAL_DOUBLESEG</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_PeskMove_Interval</span> <span class="cm-operator">=</span> <span class="cm-variable">PESKMOVE_INTERVAL_TRIPLESEG</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span><span class="cm-variable">buffer</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">deviceType</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">2</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">version_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">3</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">version_L</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 782px;"></div></div></div></pre><hr /><p><strong>作用的函数：</strong></p><hr /><p>	<em>static void device_Get_DeviceInfo( uint8 *buffer )</em></p><p>	该数据在此函数中的作用为向手机端发送硬件信息时需要提供此数据。</p><p>	<code>*(buffer + 2) = device_Init_Info.version_H;</code></p><p>	<code>*(buffer + 3) = device_Init_Info.version_L;</code></p><hr /></li></ul></li></ul></li><li><p>共有变量有效性验证逻辑图</p><p><img src='public%20varible.png' alt='public varible' /></p><p>​</p></li></ul><h4><a name='header-c8312' class='md-header-anchor '></a>2.1 周期性事件</h4><p>​	在控制过程中，大部分的控制逻辑都是以轮询的方式实现的，这时，就需要利用周期性事件对逻辑进行处理，各个事件的处理周期根据&lt;表2-1&gt;来确定。</p><h6><a name='header-c8315' class='md-header-anchor '></a>原理</h6><p>​	实现周期性功能依赖于TI协议栈下的simpleBLEPeripheral Profile，在这个Profile下，TI相当于添加了一个新的task，这个task用于执行simpleBLEPeripheral的应用，而在这个task下，还有各种各样的事件，这些有TI用于蓝牙数据传输的事件也有可以由用户自由定义的事件。应用层做了一个初始化，定义了初始化时所需要完成的事件以及注册回调初始化HAL等等，并且做了一个轮询函数，在轮询过程中不断判断osal底层所发生的event以及传递的消息，并根据这些信息执行相应的功能。</p><p>​	在OSAL中，有多个task，这些task存储在taskArray这个指针数组里，而每一个task都是一个函数指针，OSAL系统每个周期轮询所有的task，将event作为参数传入task函数指针中，并判断是否有event发生，且调用相应task下处理该event的函数。所以在OSAL中执行任务下事件的模式如下图所示：</p><p><strong>图3-1 OSAL时间执行示意图</strong></p><p><img src='osal%20task.png' alt='osal task' /></p><p>​	所以当多个事件同时发生时，OSAL做了一个事件处理队列，将未处理的事件存入事件队列中，将处理完毕的事件从队列中去除，这样就可以实现一个多事件处理的机制。</p><p>​	这个Profile的应用层代码在simpleBLEPeripheral.c文件下。</p><p>​	添加事件可以利用TI协议栈所提供的 osal_start_timerEx( uint8 taskID, uint16 event_id, uint32 timeout_value )函数，该函数有三个参数，一个是taskID，一个是event_id，还有一个是timeout_value。这个函数可以在timeout_value时间(ms)后将这个事件加入到事件队列中。所以如果希望处理周期性事件的话，需要在event事件触发后的执行函数里重新启动这个延时事件添加函数。</p><p>	TI协议栈所提供的OSAL系统下，每一个event都是以位标识的，这样做的好处是，可以同时表示两个未完成的event。当一个event发生时（无论是通过osal_start_timerEx函数的方式还是通过直接调用osal_set_event函数的方式），会调用osal_set_event函数，用于设置当前发生的事件并将事件的id加入到事件队列中。以下即osal_set_event函数的原貌：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/*********************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @fn &nbsp; &nbsp;  osal_set_event</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @brief</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* &nbsp;  This function is called to set the event flags for a task. The</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* &nbsp;  event passed in is OR'd into the task's event variable.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @param &nbsp; uint8 task_id - receiving tasks ID</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @param &nbsp; uint8 event_flag - what event to set</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @return  SUCCESS, INVALID_TASK</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">uint8</span> <span class="cm-def">osal_set_event</span>( <span class="cm-variable">uint8</span> <span class="cm-variable">task_id</span>, <span class="cm-variable">uint16</span> <span class="cm-variable">event_flag</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> ( <span class="cm-variable">task_id</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">tasksCnt</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">halIntState_t</span> &nbsp; <span class="cm-variable">intState</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">HAL_ENTER_CRITICAL_SECTION</span>(<span class="cm-variable">intState</span>); &nbsp;  <span class="cm-comment">// Hold off interrupts</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">tasksEvents</span>[<span class="cm-variable">task_id</span>] <span class="cm-operator">|=</span> <span class="cm-variable">event_flag</span>;  <span class="cm-comment">// Stuff the event bit(s)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">HAL_EXIT_CRITICAL_SECTION</span>(<span class="cm-variable">intState</span>); &nbsp; &nbsp; <span class="cm-comment">// Release interrupts</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> ( <span class="cm-variable">SUCCESS</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> ( <span class="cm-variable">INVALID_TASK</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 644px;"></div></div></div></pre><p>​	在这个函数下，当判断到当前的task_id为有效值时，它会将当前的event事件标志(那一位)与当前task_id下的事件表做或运算，以实现将当前event加入到事件列表。</p><p>​	在判断事件是否发生时，则只需在需要处理事件对应的task下的事件处理函数中进行判断，如果相应事件的那一位被置高，则对该事件进行相应的处理，并在处理结束后，对传进来的事件表与相应事件的那一位进行异或运算，来清除事件表中相应事件的那一位，以实现完成事件的清除任务。</p><p>​	以下为参考代码：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* periodic event execute every 1 ms */</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> ( <span class="cm-variable">events</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">SBP_PERIODIC_EVT</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// Restart timer</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">SBP_PERIODIC_EVT_PERIOD</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">osal_start_timerEx</span>( <span class="cm-variable">simpleBLEPeripheral_TaskID</span>, <span class="cm-variable">SBP_PERIODIC_EVT</span>, <span class="cm-variable">SBP_PERIODIC_EVT_PERIOD</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// Process the time counter</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">periodicTimeCounter</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable">PERIODIC_COUNTER_MAX</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">periodicTimeCounter</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">periodicTimeCounter</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// Perform periodic application task</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">performPeriodicTask</span>( <span class="cm-variable">periodicTimeCounter</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if (defined PRODUCT_TYPE_BAR2) || (defined PRODUCT_TYPE_CUBE)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// To verify the uart data get from JC control box</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">verifyingUartData</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> (<span class="cm-variable">events</span> <span class="cm-variable">^</span> <span class="cm-variable">SBP_PERIODIC_EVT</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 621px;"></div></div></div></pre><p>​	在以上函数中，events作为事件表参数传入事件处理函数，如果相应事件的位(SBP_PERIODIC_EVT)为高，那么则说明当前事件需要被处理，则进入事件处理函数。在事件处理完毕后，则需返回已被清除出事件列表的events，而清除的方式则是利用当前事件表与当前事件异或(events ^ SBP_PERIODIC_EVT)。</p><p>​	而且，在以上函数中，还体现了周期性启动事件方法。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Restart timer</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">SBP_PERIODIC_EVT_PERIOD</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">osal_start_timerEx</span>( <span class="cm-variable">simpleBLEPeripheral_TaskID</span>, <span class="cm-variable">SBP_PERIODIC_EVT</span>, <span class="cm-variable">SBP_PERIODIC_EVT_PERIOD</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><p>	<code>if( SBP_PERIODIC_EVT_PERIOD )</code>这句话用于判断该周期是否有效，如果有效，则重新启动延时事件，否则则不启动。</p><h6><a name='header-c8347' class='md-header-anchor '></a>事件添加与实现</h6><p>​	simpleBLEPeripheral的事件处理函数在simpleBLEPeripheral.c文件下：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/*********************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @fn &nbsp; &nbsp;  SimpleBLEPeripheral_ProcessEvent</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @brief &nbsp; Simple BLE Peripheral Application Task event processor.  This function</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* &nbsp; &nbsp; &nbsp; &nbsp;  is called to process all events for the task.  Events</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* &nbsp; &nbsp; &nbsp; &nbsp;  include timers, messages and any other user defined events.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @param &nbsp; task_id  - The OSAL assigned task ID.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @param &nbsp; events - events to process.  This is a bit map and can</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; contain more than one event.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @return  events not processed</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">uint16</span> <span class="cm-def">SimpleBLEPeripheral_ProcessEvent</span>( <span class="cm-variable">uint8</span> <span class="cm-variable">task_id</span>, <span class="cm-variable">uint16</span> <span class="cm-variable">events</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">VOID</span> <span class="cm-variable">task_id</span>; <span class="cm-comment">// OSAL required parameter that isn't used in this function</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">uint16</span> <span class="cm-variable">periodicTimeCounter</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* system event that we shouldn't modify */</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> ( <span class="cm-variable">events</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">SYS_EVENT_MSG</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">pMsg</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span> ( (<span class="cm-variable">pMsg</span> <span class="cm-operator">=</span> <span class="cm-variable">osal_msg_receive</span>( <span class="cm-variable">simpleBLEPeripheral_TaskID</span> )) <span class="cm-operator">!=</span> <span class="cm-variable">NULL</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">simpleBLEPeripheral_ProcessOSALMsg</span>( (<span class="cm-variable">osal_event_hdr_t</span> <span class="cm-operator">*</span>)<span class="cm-variable">pMsg</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// Release the OSAL message</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">osal_msg_deallocate</span>( <span class="cm-variable">pMsg</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// return unprocessed events</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> (<span class="cm-variable">events</span> <span class="cm-variable">^</span> <span class="cm-variable">SYS_EVENT_MSG</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* event that start device */</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> ( <span class="cm-variable">events</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">SBP_START_DEVICE_EVT</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// Start the Device</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">GAPRole_StartDevice</span>( <span class="cm-operator">&amp;</span><span class="cm-variable">simpleBLEPeripheral_PeripheralCBs</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// Start Bond Manager</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">VOID</span> <span class="cm-variable">GAPBondMgr_Register</span>( <span class="cm-operator">&amp;</span><span class="cm-variable">simpleBLEPeripheral_BondMgrCBs</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// Set timer for first periodic event</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">osal_start_timerEx</span>( <span class="cm-variable">simpleBLEPeripheral_TaskID</span>, <span class="cm-variable">SBP_PERIODIC_EVT</span>, <span class="cm-variable">SBP_PERIODIC_EVT_PERIOD</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// Set timer for disposible event</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">osal_start_timerEx</span>( <span class="cm-variable">simpleBLEPeripheral_TaskID</span>, <span class="cm-variable">SBP_INIT_EVT</span>, <span class="cm-variable">SBP_INIT_EVT_TIMEOUT</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> ( <span class="cm-variable">events</span> <span class="cm-variable">^</span> <span class="cm-variable">SBP_START_DEVICE_EVT</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* periodic event execute every 1 ms */</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> ( <span class="cm-variable">events</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">SBP_PERIODIC_EVT</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// Restart timer</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">SBP_PERIODIC_EVT_PERIOD</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">osal_start_timerEx</span>( <span class="cm-variable">simpleBLEPeripheral_TaskID</span>, <span class="cm-variable">SBP_PERIODIC_EVT</span>, <span class="cm-variable">SBP_PERIODIC_EVT_PERIOD</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// Process the time counter</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">periodicTimeCounter</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable">PERIODIC_COUNTER_MAX</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">periodicTimeCounter</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">periodicTimeCounter</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// Perform periodic application task</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">performPeriodicTask</span>( <span class="cm-variable">periodicTimeCounter</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if (defined PRODUCT_TYPE_BAR2) || (defined PRODUCT_TYPE_CUBE)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// To verify the uart data get from JC control box</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">verifyingUartData</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> (<span class="cm-variable">events</span> <span class="cm-variable">^</span> <span class="cm-variable">SBP_PERIODIC_EVT</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if (defined PRODUCT_TYPE_BAR2) || (defined PRODUCT_TYPE_CUBE)</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* pesk moving timeout event */</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> ( <span class="cm-variable">events</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">SBP_PESK_STOP_EVT</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Set_Stop</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* pesk initialize event */</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> ( <span class="cm-variable">events</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">SBP_INIT_EVT</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_HeightInfo_Setup</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_HardwareInfo_Setup</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">// Discard unknown events</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">return</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2300px;"></div></div></div></pre><p>​	以上代码则是simpleBLEPeripheral task处理event的处理函数。这其中一共有5个event，分别为SYS_EVENT_MSG(系统事件)，SBP_START_DEVICE_EVT(task初始化事件)，SBP_PERIODIC_EVT(task周期性事件)，SBP_PESK_STOP_EVT(桌子超时停止事件)，SBP_INIT_EVT(硬件信息初始化事件)。以下为全部事件所代表的位(全部在simpleBLEPeripheral.h文件下)：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Simple BLE Peripheral Task Events</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SBP_START_DEVICE_EVT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0x0001</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SBP_PERIODIC_EVT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0x0002</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SBP_PESK_STOP_EVT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x0004</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define SBP_INIT_EVT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0x0008</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><p>​	每个事件均有它的设定延时时间，以下为事件延时时间值(全部在simpleBLEPeripheral.h文件下)：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Counts of 1ms</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define COUNT_PERIODIC_(x) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (x)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// The max count of periodic counter</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define PERIODIC_COUNTER_MAX &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  3000</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// The max time when moving pesk timedout</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define PESK_STOP_TIMEOUT_COMMON &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  500</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define PESK_STOP_TIMEOUT_MEMORY &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  500</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define PESK_STOP_TIMEOUT_ADVANCE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 230px;"></div></div></div></pre><p>​	SBP_PERIODIC事件为周期性事件，在这里，周期性事件的处理方式为：根据周期进行分类处理。</p><ul><li><p>周期为25ms的事件有</p><ul><li>用户姿态判断</li><li>桌腿动作速度</li><li>桌腿信息发送</li></ul></li><li><p>周期为50ms的事件有</p><ul><li>获得手控板按键信息</li></ul></li><li><p>周期为200ms的事件有</p><ul><li>动作持续时间实时校准</li></ul></li><li><p>周期为500ms的事件有</p><ul><li>喂狗</li></ul></li><li><p>周期为1000ms的事件有</p><ul><li>发送当前时间戳</li><li>发送当前锁定状态</li></ul></li><li><p>周期不定的事件</p><ul><li><p>周期20ms</p><p>在非连接状态下的桌腿动作功能</p></li><li><p>周期15ms</p><p>在连接状态下的桌腿动作功能</p></li></ul><p>​而实现周期性事件的原理为除余的方式，即SBP_PERIODIC事件的周期为1ms，一旦处理SBP_PERIODIC事件，都对时间参数进行自加(1ms一自加)，当当前参数除以期望周期事件余数为零时，则说明正好达到该事件所处周期。而当该参数超过设定的最大值时则需将该参数置零。</p><p>​以下为周期处理函数：</p></li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/*********************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @fn &nbsp; &nbsp;  performPeriodicTask</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @brief &nbsp; Perform a periodic application task. This function gets</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* &nbsp; &nbsp; &nbsp; &nbsp;  called every one millisecond as a result of the SBP_PERIODIC_EVT</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* &nbsp; &nbsp; &nbsp; &nbsp;  OSAL event.</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @param &nbsp; type unsigned int parameter for count</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @return  none</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">performPeriodicTask</span>( <span class="cm-variable">uint16</span> <span class="cm-variable">timeParam</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">int16</span> <span class="cm-variable">pesk_Move_Speed</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">userPosture</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span>( <span class="cm-variable">timeParam</span> <span class="cm-operator">%</span> <span class="cm-variable">COUNT_PERIODIC_</span>(<span class="cm-number">20</span>) ) )</span></pre><pre class=""><span style="padding-right: 0.1px;">  { &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* Send the health data */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Send_HealthData</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span>( <span class="cm-variable">timeParam</span> <span class="cm-operator">%</span> <span class="cm-variable">device_PeskMove_Interval</span> ) )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* Move the pesk */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Set_PeskMoveStatus</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* rj11 port can't observe the handset command */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if (defined PRODUCT_TYPE_BAR2) || (defined PRODCUT_TYPE_CUBE)</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span>( <span class="cm-variable">timeParam</span> <span class="cm-operator">%</span> <span class="cm-variable">COUNT_PERIODIC_</span>(<span class="cm-number">50</span>) ) )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* Get the handset pressed value */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Get_HandsetStatus</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span>( <span class="cm-variable">timeParam</span> <span class="cm-operator">%</span> <span class="cm-variable">COUNT_PERIODIC_</span>(<span class="cm-number">25</span>) ) )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* User posture estimate */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">==</span> <span class="cm-variable">PESK_STATUS_NORMAL</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">userPosture</span> <span class="cm-operator">=</span> <span class="cm-variable">user_PostureEstimate</span>( <span class="cm-variable">pesk_Current_Height</span>, <span class="cm-variable">postureChange_Threshold</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* Send notification message to the APP */</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">peskData</span>.<span class="cm-variable">userPosture</span> <span class="cm-operator">=</span> <span class="cm-variable">userPosture</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Move_Speed</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Send_PeskData</span>( <span class="cm-variable">CHAR5_SEND_PERIOD</span> <span class="cm-operator">/</span> <span class="cm-variable">COUNT_PERIODIC_</span>(<span class="cm-number">25</span>) );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* stop count calibration */</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span>( <span class="cm-variable">timeParam</span> <span class="cm-operator">%</span> <span class="cm-variable">COUNT_PERIODIC_</span>(<span class="cm-number">200</span>) ) )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Count_Calibration</span>( <span class="cm-variable">pesk_Move_Speed</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* feed the dog */</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span>( <span class="cm-variable">timeParam</span> <span class="cm-operator">%</span> <span class="cm-variable">COUNT_PERIODIC_</span>(<span class="cm-number">500</span>) ) )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">DEVICE_WDT_FEED</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span>( <span class="cm-variable">timeParam</span> <span class="cm-operator">%</span> <span class="cm-variable">COUNT_PERIODIC_</span>(<span class="cm-number">1000</span>) ) )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* Send current powered up time with Characteristic7 by 1000ms */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Send_CurrentTime</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#if (defined PRODUCT_TYPE_BAR2) || (defined PRODCUT_TYPE_CUBE)  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* Get current lock status periodicly by 1000ms */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Lock_Status</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Get_Current_LockStatus</span>( <span class="cm-variable">device_LockData</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_LockData</span>.<span class="cm-variable">timeStamp</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_LockData</span>.<span class="cm-variable">timeStamp</span><span class="cm-operator">--</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#elif (defined PRODUCT_TYPE_BAR)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// TODO the lock command protocol by JieChang</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1817px;"></div></div></div></pre><p>​	以下为时间参数自加函数：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* periodic event execute every 1 ms */</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> ( <span class="cm-variable">events</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">SBP_PERIODIC_EVT</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// Restart timer</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">SBP_PERIODIC_EVT_PERIOD</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">osal_start_timerEx</span>( <span class="cm-variable">simpleBLEPeripheral_TaskID</span>, <span class="cm-variable">SBP_PERIODIC_EVT</span>, <span class="cm-variable">SBP_PERIODIC_EVT_PERIOD</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// Process the time counter</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">periodicTimeCounter</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable">PERIODIC_COUNTER_MAX</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">periodicTimeCounter</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">periodicTimeCounter</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 391px;"></div></div></div></pre><p>​	<em>在此函数中需要注意的是：PERIODIC_COUNTER_MAX的值应该为所有周期事件周期的最小公倍数。</em> </p><h5><a name='header-c8428' class='md-header-anchor '></a>2.1.1 桌腿控制</h5><p>​	桌腿控制的逻辑是根据&lt;图2-3&gt;进行实现的。为了保证控制的实时性和快速性，桌腿控制方式采用轮询方式，且以20ms（非连接状态）/15ms（连接状态）为周期。</p><p>​	所以&lt;图2-3&gt;的流程以20ms（非连接状态）/15ms（连接状态）为周期执行的。</p><ul><li><p>该函数中所需要的信息</p><ul><li>桌子当前状态（正常/错误/保存位置）</li><li>桌子当前高度</li><li>桌子当前动作状态（空闲、上升、下降、动作到指定位置）</li><li>桌子之前动作状态（空闲、上升、下降、动作到指定位置）</li><li>动作持续时间</li></ul></li><li><p>关于大部分函数内部值采用公有变量的原因</p><ul><li>为了减少代码调用，提高代码效率。</li><li>为了减少参数变量出栈、入栈，提高代码效率。</li><li>方便不同功能共同调用。</li></ul></li><li><p>桌腿控制的代码实现</p></li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/*********************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @fn &nbsp; &nbsp;  device_Set_PeskMoveStatus</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @brief &nbsp; Set pesk current move status</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @param &nbsp; none</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @return  none</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Set_PeskMoveStatus</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">==</span> <span class="cm-variable">PESK_STATUS_NORMAL</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">=</span> <span class="cm-variable">peskData</span>.<span class="cm-variable">info</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">==</span> <span class="cm-variable">PESK_STATUS_IDLE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">==</span> <span class="cm-variable">PESK_STATUS_SET</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_DOWN</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Stop_Count</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_UP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Stop_Count</span><span class="cm-operator">--</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_IDLE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">pesk_Move_PreviousStatus</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">pesk_Move_CurrentStatus</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_UP</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Count_Calculate</span>( (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Current_Height</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_DOWN</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Count_Calculate</span>( (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Current_Height</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_SET</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Count_Calculate</span>( (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Current_Height</span>),</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// should not get here</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Move_CurrentStatus</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">pesk_Stop_Count</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">cmd_Previous</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_COMMON_STOP</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_CTRL_HANDSET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">pesk_Move_CurrentStatus</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_UP</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_UP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Stop_Count</span><span class="cm-operator">--</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_STATUS_DOWN</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_DOWN</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Stop_Count</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>(<span class="cm-variable">CMD_PESK_STOP</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// should not get here!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 3220px;"></div></div></div></pre><ul><li><p>参数有效性验证：无参数。</p></li><li><p>在功能实现过程中，还调用了计算动作持续时间的函数以及桌腿控制的宏。</p><ul><li><p>动作持续时间计算函数</p><ul><li><p>函数说明</p><p>​动作持续时间计算函数在设定桌腿动作上下限以及控制桌腿动作到指定位置有极大的作用，每一次动作开始时，都会计算最大动作持续时间，当超过这个时间后，桌子则立即停止；如果在最大动作持续时间内桌子改变了状态，则以新的状态重新计算最大动作持续时间。以下全部代码皆根据不同的桌腿进行不同计算，具体参照<strong>1.3芯片控制桌腿逻辑</strong>下的动作持续时间计算公式。</p></li><li><p>函数实现代码</p></li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/*********************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @fn &nbsp; &nbsp;  device_Count_Calculate</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @brief &nbsp; Calculate the count value to stop the pesk</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @param &nbsp; int16 heightDiffer</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* &nbsp; &nbsp; &nbsp; &nbsp;  int16 inertiaValue</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @return  Count value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">int16</span> <span class="cm-def">device_Count_Calculate</span>( <span class="cm-variable">int16</span> <span class="cm-variable">heightDiffer</span>, <span class="cm-variable">uint8</span> <span class="cm-variable">standType</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">int16</span> <span class="cm-variable">countValue</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint16</span> <span class="cm-variable">pesk_Max_Default</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint16</span> <span class="cm-variable">pesk_Min_Default</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">int16</span> <span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">int16</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable-3">bool</span> <span class="cm-variable">destinate_InCritical</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable-3">bool</span> <span class="cm-variable">over_Critical_Flag</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/*-----------------------------------------</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* arg1[][0] for parameter_Double upward</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* arg1[][1] for parameter_Triple upward</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* arg1[][2] for parameter_Double downward</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">* arg1[][3] for parameter_Triple downward</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">int16</span> <span class="cm-variable">arg1</span>[<span class="cm-number">2</span>][<span class="cm-number">4</span>] <span class="cm-operator">=</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-number">2</span>, <span class="cm-operator">-</span><span class="cm-number">30</span>, <span class="cm-number">2</span>, <span class="cm-operator">-</span><span class="cm-number">25</span> },  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-number">2</span>, <span class="cm-operator">-</span><span class="cm-number">13</span>, <span class="cm-number">2</span>, <span class="cm-operator">-</span><span class="cm-number">13</span> }, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  };</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">int16</span> <span class="cm-variable">arg2</span>[<span class="cm-number">2</span>][<span class="cm-number">4</span>] <span class="cm-operator">=</span> {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-operator">-</span><span class="cm-number">6</span>, <span class="cm-number">7</span>, <span class="cm-number">3</span>, <span class="cm-operator">-</span><span class="cm-number">7</span>, },  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { <span class="cm-operator">-</span><span class="cm-number">5</span>, <span class="cm-number">7</span>, <span class="cm-number">4</span>, <span class="cm-operator">-</span><span class="cm-number">9</span>, },</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  };</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">int16</span> <span class="cm-variable">inertiaValue</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">switch</span>( <span class="cm-variable">standType</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Max_Default</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Min_Default</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">inertiaValue</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Max_Default</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Min_Default</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">inertiaValue</span> <span class="cm-operator">=</span> <span class="cm-number">4</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Max_Default</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Min_Default</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">inertiaValue</span> <span class="cm-operator">=</span> <span class="cm-number">2</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Max_Default</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Min_Default</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">inertiaValue</span> <span class="cm-operator">=</span> <span class="cm-number">4</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// Should not get here</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">heightDiffer</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span> ) <span class="cm-comment">/* upward */</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Max_Default</span> <span class="cm-operator">-</span> <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">PESK_CRITICAL_VALUE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">destinate_InCritical</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> (<span class="cm-variable">pesk_Max_Default</span> <span class="cm-operator">-</span> <span class="cm-variable">PESK_CRITICAL_VALUE</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span>(<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">&gt;</span> <span class="cm-number">0</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">=</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">over_Critical_Flag</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">heightDiffer</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">inertiaValue</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// FIXME adjust the count value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">destinate_InCritical</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">switch</span>(<span class="cm-variable">standType</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">heightDiffer</span>) <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">1</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">*</span> <span class="cm-number">2</span> <span class="cm-operator">+</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">1</span>] <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">heightDiffer</span>) <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">0</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">0</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">*</span> <span class="cm-number">2</span> <span class="cm-operator">+</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">0</span>] <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">0</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Should not get here!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">else</span> <span class="cm-comment">/* in critical */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">switch</span>(<span class="cm-variable">standType</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">differ_Current_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">differ_Current_Critical</span>) <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">1</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">1</span>] <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">-</span> <span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> <span class="cm-variable">over_Critical_Flag</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">1</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">1</span>] <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">-</span> <span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> <span class="cm-variable">over_Critical_Flag</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">differ_Current_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">differ_Current_Critical</span>) <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">0</span>] </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">0</span>] <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">-</span> <span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> <span class="cm-variable">over_Critical_Flag</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">0</span>] </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">0</span>] <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">-</span> <span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> <span class="cm-variable">over_Critical_Flag</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Should not get here!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">heightDiffer</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span> ) <span class="cm-comment">/* downward */</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Min_Default</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">PESK_CRITICAL_VALUE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">destinate_InCritical</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> (<span class="cm-variable">pesk_Min_Default</span> <span class="cm-operator">+</span> <span class="cm-variable">PESK_CRITICAL_VALUE</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span>(<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">=</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">over_Critical_Flag</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">heightDiffer</span> <span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-variable">inertiaValue</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// FIXME adjust the count value</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">destinate_InCritical</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">switch</span>(<span class="cm-variable">standType</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">heightDiffer</span>) <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">3</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">3</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">*</span> <span class="cm-number">2</span> <span class="cm-operator">+</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">3</span>] <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">3</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">heightDiffer</span>) <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">2</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">2</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">*</span> <span class="cm-number">2</span> <span class="cm-operator">+</span> <span class="cm-variable">heightDiffer</span> <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">2</span>] <span class="cm-operator">+</span> <span class="cm-variable">arg2</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">2</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Should not get here!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">else</span> <span class="cm-comment">/* in critical */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">switch</span>(<span class="cm-variable">standType</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">differ_Current_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">differ_Current_Critical</span>) <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">3</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">3</span>] <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">-</span> <span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> <span class="cm-variable">over_Critical_Flag</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">3</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">3</span>] <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">-</span> <span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> <span class="cm-variable">over_Critical_Flag</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">differ_Current_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">TRANSFER_IMPERIAL_TO_METRIC</span>(<span class="cm-variable">differ_Current_Critical</span>) <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">2</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">2</span>] <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">-</span> <span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> <span class="cm-variable">over_Critical_Flag</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">*</span> <span class="cm-number">2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">differ_Current_Critical</span> <span class="cm-operator">/</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">2</span>]</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> <span class="cm-variable">arg1</span>[<span class="cm-variable">device_BLE_Connect_Flag</span>][<span class="cm-number">2</span>] <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">differ_Destinate_Critical</span> <span class="cm-operator">-</span> <span class="cm-variable">heightDiffer</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> <span class="cm-variable">over_Critical_Flag</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-operator">+</span> (<span class="cm-variable">heightDiffer</span> <span class="cm-operator">-</span> <span class="cm-variable">differ_Destinate_Critical</span>) <span class="cm-operator">*</span> <span class="cm-number">3</span> <span class="cm-operator">*</span> (<span class="cm-operator">!</span><span class="cm-variable">over_Critical_Flag</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Should not get here!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">countValue</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">return</span> <span class="cm-variable">countValue</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 6371px;"></div></div></div></pre><ul><li>参数有效性分析：int16类型的参量heightDiffer，</li></ul></li><li><p>桌腿控制宏</p><p>​	桌腿控制宏，宏参数为桌腿的控制指令，如果桌腿控制指令为停止，则立即将端口设置为输入状态，以此来保证桌腿不会因为芯片的端口寄存器发生变化而造成电平变化，从而防止了桌腿误触发的现象发生。而在接收到停止以外的指令时，则需要及时将端口调整为输出状态。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// Send command to the pesk </span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define DEVICE_SET_PORT_INPUT() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ( P0DIR &amp;= 0x0f )</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define DEVICE_SET_PORT_OUTPUT() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ( P0DIR |= 0xf0 )</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define DEVICE_SENDCMD_PESK(x) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; do &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-meta">{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-meta">if( !x ) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-meta">{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-meta">P0 = x; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-meta">DEVICE_SET_PORT_INPUT(); &nbsp; &nbsp; &nbsp;  \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-meta">} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-meta">else &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-meta">{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-meta">DEVICE_SET_PORT_OUTPUT(); &nbsp; &nbsp; &nbsp; &nbsp; \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-meta">P0 = x; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-meta">} &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-meta">} while(0)</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 391px;"></div></div></div></pre></li></ul></li></ul><h5><a name='header-c8501' class='md-header-anchor '></a>2.1.2 手控板信息获取</h5><p>​	手控板信息获取逻辑根据<strong>1.2手控板获取按键信息逻辑</strong> 编写。其逻辑流程图请参照&lt;图2-1&gt;。为了保证按键信息获取的实时性和可靠性，其轮询周期为50ms。</p><ul><li><p>实现逻辑所需参数：</p><ul><li>手控板当前按下按键</li><li>手控板之前按下按键</li><li>设备当前控制模式</li><li>桌子之前动作状态</li><li>桌子当前动作状态</li><li>桌子锁定状态</li><li>桌子状态</li><li>记忆位置存储值</li><li>目的高度</li></ul></li><li><p>实现功能：</p><ul><li>根据手控板操作更改桌腿动作的标志位</li><li>根据手控板操作写入预设高度值</li></ul></li><li><p>实现代码如下：</p></li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/*********************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @fn &nbsp; &nbsp;  device_Get_HandsetStatus</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @brief &nbsp; Get the current handset status</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @param &nbsp; none</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @return  none</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Get_HandsetStatus</span>()</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">handset_CurrentPressed</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">handset_PreviousPressed</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">GET_CURRENT_HANDSET</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">!=</span> <span class="cm-variable">DEVICE_CTRL_APP</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">handset_CurrentPressed</span> <span class="cm-operator">==</span> <span class="cm-variable">HANDSET_STATUS_IDLE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_CTRL_FREE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">handset_PreviousPressed</span> <span class="cm-operator">=</span> <span class="cm-variable">HANDSET_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">/* i added this line to solve the problem that once pressed the setting button,</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">handset will continuousily sending the setting command to the control box */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SET</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_STOP</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_CTRL_HANDSET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">pesk_Lock_Status</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">handset_PreviousPressed</span> <span class="cm-operator">!=</span> <span class="cm-variable">handset_CurrentPressed</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_PreviousStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SET</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">handset_CurrentPressed</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_UP</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_UP</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_DOWN</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_DOWN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SET1</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">0</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INVALID</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">0</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Single_Memory</span>( <span class="cm-number">0</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT1</span>, <span class="cm-variable">pesk_Current_Height</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SET1</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SET2</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">1</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INVALID</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">1</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Single_Memory</span>( <span class="cm-number">1</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT2</span>, <span class="cm-variable">pesk_Current_Height</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SET2</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SET3</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">2</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INVALID</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">2</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Single_Memory</span>( <span class="cm-number">2</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT3</span>, <span class="cm-variable">pesk_Current_Height</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SET3</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  } </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SET4</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">!=</span> <span class="cm-variable">PESK_STATUS_SAVE</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">3</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INVALID</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_SET</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-number">3</span>].<span class="cm-variable">height_Value</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Single_Memory</span>( <span class="cm-number">3</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT4</span>, <span class="cm-variable">pesk_Current_Height</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SET4</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">HANDSET_STATUS_SETTING</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DEVICE_SENDCMD_PESK</span>( <span class="cm-variable">CMD_PESK_SETTING</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// should not get here!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">handset_PreviousPressed</span> <span class="cm-operator">=</span> <span class="cm-variable">handset_CurrentPressed</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 3082px;"></div></div></div></pre><p>​	在以上函数中，有一个device_Set_Single_Memory( uint8 idx, uint8 BLE_NVID, uint16 height )函数，该函数的目的在于将高度值存入相应的snv（非已逝性存储器）中。</p><p>​	以下为device_Set_Single_Memory函数的具体实现：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/*********************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @fn &nbsp; &nbsp;  device_Set_Single_Memory</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @brief &nbsp; Set memory presets once it is changed by handset</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @param &nbsp; index - the device_Memory_Set's index</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* &nbsp; &nbsp; &nbsp; &nbsp;  ble_NVID - the NVID address of the snv</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* &nbsp; &nbsp; &nbsp; &nbsp;  setHeight - the height that set to memory</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @return  none</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Set_Single_Memory</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">index</span>, <span class="cm-variable">uint8</span> <span class="cm-variable">ble_NVID</span>, <span class="cm-variable">uint16</span> <span class="cm-variable">setHeight</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">dataTemp</span>[<span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">buffer</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">index</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">=</span> <span class="cm-variable">setHeight</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">dataTemp</span>[<span class="cm-number">0</span>] <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">index</span>].<span class="cm-variable">height_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">dataTemp</span>[<span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">index</span>].<span class="cm-variable">height_L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_snv_write</span>( <span class="cm-variable">ble_NVID</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>, <span class="cm-variable">dataTemp</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">DEVICE_MEMORY_NUM</span>; <span class="cm-variable">i</span> <span class="cm-operator">++</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-number">2</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-number">2</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_L</span>; </span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR1</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 621px;"></div></div></div></pre><p>​	一旦单个预设高度改变，则立即通过Characteristic1发送一个Notification(通知)告诉APP端预设高度已经改变。</p><h5><a name='header-c8557' class='md-header-anchor '></a>2.1.3 控制信号校准</h5><p>​	控制信号校准的实质是重新计算桌子动作持续时间，目的是为了提高控制的精确度。</p><p>​	重新计算桌子动作持续时间根据<strong>1.3芯片控制桌腿逻辑</strong> 的表述以及&lt;公式2-4&gt;的表达。</p><ul><li><p>实现逻辑所需参数：</p><ul><li>目的高度</li><li>桌子当前高度</li><li>桌腿类型</li><li>桌子动作速度（正为上升，负为下降）</li></ul></li><li><p>逻辑实现代码：</p></li></ul><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/*********************************************************************</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @fn &nbsp; &nbsp;  device_Count_Calibration</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @brief &nbsp; calibrate the pesk stop count to move accurate</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @param &nbsp; pesk_Move_Speed - integer type with sign</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* @return  none</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Count_Calibration</span>( <span class="cm-variable">int16</span> <span class="cm-variable">pesk_Move_Speed</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">int16</span> <span class="cm-variable">arg_DoubleSeg</span>[<span class="cm-number">5</span>] <span class="cm-operator">=</span> { <span class="cm-number">7</span>, <span class="cm-number">3</span>, <span class="cm-number">9</span>, <span class="cm-number">3</span>, <span class="cm-number">10</span>};</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">int16</span> <span class="cm-variable">arg_TripleSeg</span>[<span class="cm-number">5</span>] <span class="cm-operator">=</span> { <span class="cm-number">14</span>, <span class="cm-number">5</span>, <span class="cm-number">13</span>, <span class="cm-number">5</span>, <span class="cm-number">14</span> };</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">int16</span> <span class="cm-operator">*</span><span class="cm-variable">args</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">int16</span> <span class="cm-variable">heightDiffer</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">heightDiffer</span> <span class="cm-operator">=</span> (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Current_Height</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">switch</span>(<span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">args</span> <span class="cm-operator">=</span> <span class="cm-variable">arg_DoubleSeg</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">args</span> <span class="cm-operator">=</span> <span class="cm-variable">arg_TripleSeg</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">args</span> <span class="cm-operator">=</span> <span class="cm-variable">arg_DoubleSeg</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_Speed</span> <span class="cm-operator">*=</span> <span class="cm-variable">SCALE_IMPERIAL_TO_METRIC</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">heightDiffer</span> <span class="cm-operator">*=</span> <span class="cm-variable">SCALE_IMPERIAL_TO_METRIC</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">args</span> <span class="cm-operator">=</span> <span class="cm-variable">arg_TripleSeg</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">pesk_Move_Speed</span> <span class="cm-operator">*=</span> <span class="cm-variable">SCALE_IMPERIAL_TO_METRIC</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">heightDiffer</span> <span class="cm-operator">*=</span> <span class="cm-variable">SCALE_IMPERIAL_TO_METRIC</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">// should not get here</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_Speed</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">args</span>[<span class="cm-number">0</span>] )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Count_Calculate</span>( (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Current_Height</span>), <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-operator">-</span> <span class="cm-variable">pesk_Move_Speed</span> <span class="cm-operator">/</span> <span class="cm-variable">args</span>[<span class="cm-number">1</span>] <span class="cm-operator">*</span> <span class="cm-variable">args</span>[<span class="cm-number">2</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Move_Speed</span> <span class="cm-operator">&lt;</span> <span class="cm-operator">-</span><span class="cm-variable">args</span>[<span class="cm-number">0</span>] )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Count_Calculate</span>( (<span class="cm-variable">int16</span>)(<span class="cm-variable">device_Height_Destinate</span> <span class="cm-operator">-</span> <span class="cm-variable">pesk_Current_Height</span>), <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-operator">-</span> <span class="cm-variable">pesk_Move_Speed</span> <span class="cm-operator">/</span> <span class="cm-variable">args</span>[<span class="cm-number">3</span>] <span class="cm-operator">*</span> <span class="cm-variable">args</span>[<span class="cm-number">4</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1265px;"></div></div></div></pre><h5><a name='header-c8583' class='md-header-anchor '></a>2.1.4 速度测算，用户姿态获得及高度信息发送</h5><p>​	由于速度测算、用户姿态获得以及高度信息发送三者息息相关，根据高度信息可以获得用户姿态，而根据高度信息则可以得到速度。</p><p>​	这三者绑定在一起，且单次执行周期为25ms。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span>( <span class="cm-variable">timeParam</span> <span class="cm-operator">%</span> <span class="cm-variable">COUNT_PERIODIC_</span>(<span class="cm-number">25</span>) ) )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* User posture estimate */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">==</span> <span class="cm-variable">PESK_STATUS_NORMAL</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">userPosture</span> <span class="cm-operator">=</span> <span class="cm-variable">user_PostureEstimate</span>( <span class="cm-variable">pesk_Current_Height</span>, <span class="cm-variable">postureChange_Threshold</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* Send notification message to the APP */</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">peskData</span>.<span class="cm-variable">userPosture</span> <span class="cm-operator">=</span> <span class="cm-variable">userPosture</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Move_Speed</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Send_PeskData</span>( <span class="cm-variable">CHAR5_SEND_PERIOD</span> <span class="cm-operator">/</span> <span class="cm-variable">COUNT_PERIODIC_</span>(<span class="cm-number">25</span>) );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre><p>​	在桌子状态为正常时，根据桌子当前高度以及姿态判断阈值返回人体当前的姿态。</p><p>​	而桌子信息发送的周期不要大于500ms，所以要在桌子信息发送函数中进行处理。每25ms处理桌子高度信息时，可以根据前后桌子高度信息差来计算桌子的动作速度。</p><p>​	在进行速度数据处理时，加入了队列的数据结构。</p><pre class='md-fences mock-cm' style='display:block;position:relative'>/*********************************************************************
 * @fn      device_Send_PeskData
 *
 * @brief   Send message from device to app with characteristic 5
 *
 * @param   send_Interval delay period to send messages to the app
 *
 * @return  return the diffrent value once the data changed 
 */
int16 device_Send_PeskData( uint16 send_Interval )
{
  uint8 *buffer;
  int16 speed = 0;
  static FIFO_Data_t *speed_FIFO;
  static peskStatus_t previousData, previousData_Send;
  static uint16 interval_Count;
  
  speed_FIFO = Data_FIFO_In( speed_FIFO, (peskData.info - previousData.info), FIFO_DATA_MAX );
  speed = device_Speed_Calculate( speed_FIFO );
  if( previousData.currentPeskData != peskData.currentPeskData )
  {
    previousData = peskData;
  }
  
  if( previousData_Send.currentPeskData != peskData.currentPeskData &amp;&amp; 
      interval_Count &gt; send_Interval )
  {
    previousData_Send = peskData;
    
    // Save user health data here
    device_HealthData_Save( peskData.userPosture );
    
    interval_Count = 0;
    buffer = (uint8 *)osal_mem_alloc( sizeof( uint8 ) * SIMPLEPROFILE_CHAR5_LEN );
    *buffer = peskData.peskStatus;
    *(buffer + 1) = peskData.userPosture;
    *(buffer + 2) = peskData.info_H;
    *(buffer + 3) = peskData.info_L;
    
    //SimpleProfile_SetParameter( SIMPLEPROFILE_CHAR5, SIMPLEPROFILE_CHAR5_LEN, buffer );
    
    osal_mem_free( buffer );
  }
  interval_Count++;
  return speed;
}</pre><h5><a name='header-c8596' class='md-header-anchor '></a>2.1.5 喂狗</h5><ul><li>说明：</li></ul><p>	在芯片中加入看门狗机制是为了防止程序意外跑飞陷入死循环，导致必须断电重启才可以重新使用。加入了看门狗后，如果程序跑飞，芯片会自动重新，防止自己进入死循环。</p><ul><li>相关代码：</li></ul><p>	在程序宏定义阶段加入看门狗的相关寄存器配置代码：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap     " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define DEVICE_WDT_START() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; do &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  \</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-meta">{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-meta">WDCTL=0x00; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-meta">WDCTL|=0x08; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-meta">} while(0)</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define DEVICE_WDT_FEED() &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  do &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-meta">{ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-meta">WDCTL=0xa0; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-meta">WDCTL|=0x50; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  \</span></span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-meta">} while(0)</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 253px;"></div></div></div></pre><p>	在程序初始化时，打开看门狗：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap   " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_HardwareInfo_Setup</span>()</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">buffer</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">buffer</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">osal_mem_alloc</span>( <span class="cm-keyword">sizeof</span>( <span class="cm-variable">uint8</span> ) <span class="cm-operator">*</span> <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Get_MemoryInit</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR1</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_mem_free</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">buffer</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">osal_mem_alloc</span>( <span class="cm-keyword">sizeof</span>( <span class="cm-variable">uint8</span> ) <span class="cm-operator">*</span> <span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Get_Lock</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR6</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_mem_free</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">buffer</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">osal_mem_alloc</span>( <span class="cm-keyword">sizeof</span>( <span class="cm-variable">uint8</span> ) <span class="cm-operator">*</span> <span class="cm-variable">SIMPLEPROFILE_CHAR0_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Get_DeviceInfo</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR0</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR0_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_mem_free</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">buffer</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">osal_mem_alloc</span>( <span class="cm-keyword">sizeof</span>( <span class="cm-variable">uint8</span> ) <span class="cm-operator">*</span> <span class="cm-variable">SIMPLEPROFILE_CHAR3_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Get_MoveRange</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR3</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR3_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_mem_free</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">buffer</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">osal_mem_alloc</span>( <span class="cm-keyword">sizeof</span>( <span class="cm-variable">uint8</span> ) <span class="cm-operator">*</span> <span class="cm-variable">SIMPLEPROFILE_CHAR2_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Get_Posture</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR2</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR2_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_mem_free</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* start the watch dog timer */</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">DEVICE_WDT_START</span>();</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 736px;"></div></div></div></pre><p>	然后再在周期时间中加入喂狗的处理程序：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* feed the dog */</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span>( <span class="cm-variable">timeParam</span> <span class="cm-operator">%</span> <span class="cm-variable">COUNT_PERIODIC_</span>(<span class="cm-number">500</span>) ) )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">DEVICE_WDT_FEED</span>();</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">  }</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre><h5><a name='header-c9630' class='md-header-anchor '></a>2.1.6 发送当前时间戳及更新锁定状态</h5><ul><li><p>发送当前时间戳事件</p><ul><li><p>周期：1000ms</p></li><li><p>说明：</p><p>	关于发送当前时间戳，需要1000ms向手机端发送一次。于是，芯片端也需要1000ms更新一次osal系统自带的rtc。并且根据rtc所给出的时间戳发送给手机端，该时间戳为从上电开始到当前状态所经历的秒数。</p></li><li><p>相关代码：</p><ul><li><p>时间戳获取函数：</p><p>	在此函数中，得到一个时间戳类型的数据作为返回值。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">seprate_DataU32_t</span> <span class="cm-def">device_Get_Current_Timestamp</span>()</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">seprate_DataU32_t</span> <span class="cm-variable">timeStampTemp</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osalTimeUpdate</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">timeStampTemp</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">=</span> <span class="cm-variable">timestamp_Reverse</span>( <span class="cm-variable">osal_getClock</span>() );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">return</span> <span class="cm-variable">timeStampTemp</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 161px;"></div></div></div></pre><p>	然而由于数据发送的方式是由地址高位向地址低位，可是芯片端内存存储一个32位的数据是有地址低位向地址高位，所以需要对数据进行翻转。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">uint32</span> <span class="cm-def">timestamp_Reverse</span>( <span class="cm-variable">uint32</span> <span class="cm-variable">time</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint32</span> <span class="cm-variable">reverse_Temp</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">while</span>( <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-number">4</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">reverse_Temp</span> <span class="cm-operator">|=</span> ( ( ( (<span class="cm-variable">time</span> <span class="cm-operator">&gt;&gt;</span> (<span class="cm-number">8</span> <span class="cm-operator">*</span> <span class="cm-variable">i</span>)) <span class="cm-operator">&amp;</span> <span class="cm-number">0x000000ff</span> ) ) <span class="cm-operator">&lt;&lt;</span> (<span class="cm-number">8</span> <span class="cm-operator">*</span> (<span class="cm-number">3</span> <span class="cm-operator">-</span> <span class="cm-variable">i</span>)) ) ;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">i</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">return</span> <span class="cm-variable">reverse_Temp</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre></li><li><p>时间戳发送函数：</p><p>	在此函数中，将获取的时间戳通过蓝牙发送到手机端。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Send_CurrentTime</span>()</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">seprate_DataU32_t</span> <span class="cm-variable">device_Current_Time</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">sendBuffer_Char7</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Current_Time</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Get_Current_Timestamp</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">sendBuffer_Char7</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">osal_mem_alloc</span>( <span class="cm-keyword">sizeof</span>(<span class="cm-variable">uint8</span>) <span class="cm-operator">*</span> <span class="cm-variable">SIMPLEPROFILE_CHAR7_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">SIMPLEPROFILE_CHAR7_LEN</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">sendBuffer_Char7</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Current_Time</span>.<span class="cm-variable">data</span>[<span class="cm-variable">i</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR7</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR7_LEN</span>, <span class="cm-variable">sendBuffer_Char7</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_mem_free</span>( <span class="cm-variable">sendBuffer_Char7</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 345px;"></div></div></div></pre></li></ul></li></ul></li><li><p>更新锁定状态事件</p><ul><li><p>周期：1000ms</p></li><li><p>说明：</p><p>	关于更新锁定状态事件，每一秒更新当前的锁定数据（包括锁定状态、延时锁定时间戳），并且将该值通过相应的特征值发送到手机端。</p></li><li><p>相关代码：</p><ul><li><p>得到当前锁定状态</p><p>	得到当前锁定状态的同时，将锁定状态的数据通过蓝牙发送给手机端。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">uint8</span> <span class="cm-def">device_Get_Current_LockStatus</span>( <span class="cm-variable">lockData_t</span> <span class="cm-variable">data</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">buffer</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">buffer</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">osal_mem_alloc</span>( <span class="cm-keyword">sizeof</span>(<span class="cm-variable">uint8</span>) <span class="cm-operator">*</span> <span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span>) <span class="cm-operator">=</span> <span class="cm-variable">data</span>.<span class="cm-variable">lockStatus</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>) <span class="cm-operator">=</span> <span class="cm-variable">data</span>.<span class="cm-variable">timeStamp_S</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span> <span class="cm-operator">-</span> <span class="cm-variable">i</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR6</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_mem_free</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">data</span>.<span class="cm-variable">lockStatus</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-operator">!</span><span class="cm-variable">data</span>.<span class="cm-variable">timeStamp</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> <span class="cm-variable">PESK_LOCKED</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> <span class="cm-variable">PESK_UNLOCK</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 529px;"></div></div></div></pre></li><li><p>锁定状态时间递减</p><p>	当锁定状态时间戳不为0时，每秒递减进行倒计数。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Lock_Status</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Get_Current_LockStatus</span>( <span class="cm-variable">device_LockData</span> );</span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">device_LockData</span>.<span class="cm-variable">timeStamp</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_LockData</span>.<span class="cm-variable">timeStamp</span><span class="cm-operator">--</span>;</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 115px;"></div></div></div></pre></li></ul></li></ul></li></ul><h4><a name='header-c9772' class='md-header-anchor '></a>2.2 非周期性事件</h4><p>	非周期事件与周期事件原理类似，添加事件的方式也与周期事件相同，所以在此不再赘述。</p><p>	在所有非周期性事件中，分为一次性事件以及蓝牙数据接收回调事件，两者不同在于，一次性事件仅仅在某时间执行一次，而蓝牙数据接收回调事件，在每一次有蓝牙数据发送到芯片端时都会触发。</p><h5><a name='header-c8599' class='md-header-anchor '></a>2.2.1 一次性事件</h5><h6><a name='header-c8600' class='md-header-anchor '></a>初始化事件</h6><ul><li><p>在初始化事件中，有对以下若干事件进行处理：</p><ul><li>高度数据上电发送</li><li>记忆位置初始化</li><li>锁定状态初始化</li><li>设备信息初始化</li><li>上下限位置初始化</li><li>姿态判断阈值初始化</li></ul></li><li><p>高度数据上电发送</p><ul><li><p>执行时间：上电后500ms</p></li><li><p>说明：</p><p>	在桌子上电时，由于桌子信息没有发生改变，所以不会向手机端发送桌子当前的数据，所以需要在上电时获得当前桌子的数据，然后发送到手机端。</p></li><li><p>相关代码：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_HeightInfo_Setup</span>()</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">buffer</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">buffer</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">osal_mem_alloc</span>( <span class="cm-keyword">sizeof</span>( <span class="cm-variable">uint8</span> ) <span class="cm-operator">*</span> <span class="cm-variable">SIMPLEPROFILE_CHAR5_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span><span class="cm-variable">buffer</span> <span class="cm-operator">=</span> <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span> <span class="cm-variable">peskData</span>.<span class="cm-variable">userPosture</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">2</span>) <span class="cm-operator">=</span> <span class="cm-variable">peskData</span>.<span class="cm-variable">info_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">3</span>) <span class="cm-operator">=</span> <span class="cm-variable">peskData</span>.<span class="cm-variable">info_L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR5</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR5_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_mem_free</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 253px;"></div></div></div></pre></li></ul></li><li><p>记忆位置初始化</p><ul><li><p>执行时间：上电后500ms</p></li><li><p>说明：</p><p>	在上电时，从snv中读取所有的记忆位置信息，如果读取失败，则用默认值，如果读取成功则将读取到的记忆位置存储到ram中，以便随时调用。</p></li><li><p>相关代码：</p><p>	从snv中读取信息，若失败则用默认值，若成功，则将读取到的记忆位置值存储到ram中。并将该信息通过相应特征值发送到手机端。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">device_Get_MemoryInit</span>( <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">buffer</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">dataTemp</span>[<span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span> <span class="cm-operator">*</span> <span class="cm-variable">DEVICE_MEMORY_NUM</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; <span class="cm-variable">i</span> <span class="cm-operator">+=</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">osal_snv_read</span>( <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT1</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>, <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>, <span class="cm-variable">dataTemp</span> ) <span class="cm-operator">!=</span> <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Default</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>].<span class="cm-variable">height_H</span> <span class="cm-operator">=</span> <span class="cm-variable">dataTemp</span>[<span class="cm-number">0</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>].<span class="cm-variable">height_L</span> <span class="cm-operator">=</span> <span class="cm-variable">dataTemp</span>[<span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>].<span class="cm-variable">height_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span> <span class="cm-operator">/</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>].<span class="cm-variable">height_L</span>; </span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 506px;"></div></div></div></pre></li></ul></li><li><p>锁定状态初始化</p><ul><li><p>执行时间：上电后500ms</p></li><li><p>说明：</p><p>	在上电时，如果检测到之前存储在snv的状态为锁定状态，则将当前的桌子设置为锁定状态，如果检测到之前存储的snv状态为非锁定状态，则将当前的桌子设置为非锁定状态。</p></li><li><p>相关代码：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">device_Get_Lock</span>( <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">buffer</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">osal_snv_read</span>( <span class="cm-variable">BLE_NVID_DEVICE_LOCK</span>, <span class="cm-variable">BLE_NVID_DEVICE_LOCK_LEN</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">device_LockData</span>.<span class="cm-variable">lockStatus</span> ) <span class="cm-operator">!=</span> <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_LockData</span>.<span class="cm-variable">lockStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_UNLOCK</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span><span class="cm-variable">buffer</span> <span class="cm-operator">=</span> <span class="cm-variable">device_LockData</span>.<span class="cm-variable">lockStatus</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">BLE_NVID_DEVICE_LOCK_LEN</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span>)</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span> <span class="cm-number">0x00</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 299px;"></div></div></div></pre></li></ul></li><li><p>设备信息初始化</p><ul><li><p>执行时间：上电后500ms</p></li><li><p>说明：</p><p>	在上电时，将snv中的设备信息读取出来，如果读取失败，则用默认值。在利用默认值时，需要注意的是上电500ms内会根据当前的高度来判断桌腿是英制还是公制。并将该数据通过蓝牙发送到手机端。</p></li><li><p>相关代码：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap   " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">device_Get_DeviceInfo</span>( <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">buffer</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">tempData</span>[<span class="cm-variable">BLE_NVID_HARDWARE_INFO_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">osal_snv_read</span>( <span class="cm-variable">BLE_NVID_HARDWARE_INFO</span>, <span class="cm-variable">BLE_NVID_HARDWARE_INFO_LEN</span>, <span class="cm-variable">tempData</span> ) <span class="cm-operator">!=</span> <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_PESK_DEFAULT</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">pesk_Current_Height</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">PESK_METRICHEIGHT_MIN</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">==</span> <span class="cm-variable">PESK_STATUS_NORMAL</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">|=</span> <span class="cm-variable">PESK_UNIT_BIT</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">&amp;=</span> <span class="cm-variable">~PESK_UNIT_BIT</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">deviceType</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_TYPE_DEFAULT</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">deviceVersion</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_VERSION_DEFAULT</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">deviceType</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span><span class="cm-variable">tempData</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span>(<span class="cm-variable">tempData</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">deviceVersion</span> <span class="cm-operator">=</span> (<span class="cm-operator">*</span>(<span class="cm-variable">tempData</span> <span class="cm-operator">+</span> <span class="cm-number">2</span>) <span class="cm-operator">&lt;&lt;</span> <span class="cm-number">8</span>) <span class="cm-operator">|</span> <span class="cm-operator">*</span>(<span class="cm-variable">tempData</span> <span class="cm-operator">+</span> <span class="cm-number">3</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span>(<span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">PESK_TYPE_BITS</span>) )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_PeskMove_Interval</span> <span class="cm-operator">=</span> <span class="cm-variable">PESKMOVE_INTERVAL_DOUBLESEG</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_PeskMove_Interval</span> <span class="cm-operator">=</span> <span class="cm-variable">PESKMOVE_INTERVAL_TRIPLESEG</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span><span class="cm-variable">buffer</span> <span class="cm-operator">=</span> <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">deviceType</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">2</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">version_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">3</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">version_L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 851px;"></div></div></div></pre></li></ul></li><li><p>上下限位置初始化</p><ul><li><p>执行时间：上电后500ms</p></li><li><p>说明：</p><p>	在上电时，将snv中的上下限信息读取出来，如果读取失败则用默认值，反之则使用读取出来的信息作为上下限值，并将该值通过蓝牙发送到手机端。</p></li><li><p>相关代码：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap  " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">device_Get_MoveRange</span>( <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">buffer</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">rangeTemp</span>[<span class="cm-variable">BLE_NVID_PESK_RANGE_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">osal_snv_read</span>( <span class="cm-variable">BLE_NVID_PESK_MAX</span>, <span class="cm-variable">BLE_NVID_PESK_RANGE_LEN</span>, <span class="cm-variable">rangeTemp</span> ) <span class="cm-operator">!=</span>  <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">HEIGHT_VALUE_MAX</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">rangeTemp</span>[<span class="cm-number">0</span>] <span class="cm-operator">*</span> <span class="cm-number">256</span> <span class="cm-operator">+</span> <span class="cm-variable">rangeTemp</span>[<span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">osal_snv_read</span>( <span class="cm-variable">BLE_NVID_PESK_MIN</span>, <span class="cm-variable">BLE_NVID_PESK_RANGE_LEN</span>, <span class="cm-variable">rangeTemp</span> ) <span class="cm-operator">!=</span>  <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">HEIGHT_VALUE_MIN</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">rangeTemp</span>[<span class="cm-number">0</span>] <span class="cm-operator">*</span> <span class="cm-number">256</span> <span class="cm-operator">+</span> <span class="cm-variable">rangeTemp</span>[<span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span><span class="cm-variable">buffer</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">/</span> <span class="cm-number">256</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">%</span> <span class="cm-number">256</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">2</span>) <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">/</span> <span class="cm-number">256</span>;</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">3</span>) <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">%</span> <span class="cm-number">256</span>;</span></pre></div><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1541px;"></div></div></div></pre></li></ul></li><li><p>姿态判断阈值初始化</p><ul><li><p>执行时间：上电后500ms</p></li><li><p>说明：</p><p>	在上电时，将snv中的姿态判断阈值读取出来，如果读取失败，则判断当前控制盒是英制控制盒还是公制控制盒，根据不同类型的控制盒测定用户站坐姿态的判断阈值。</p></li><li><p>相关代码：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">void</span> <span class="cm-def">device_Get_Posture</span>( <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">buffer</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">osal_snv_read</span>( <span class="cm-variable">BLE_NVID_USER_POSTURE</span>, <span class="cm-variable">BLE_NVID_USER_POSTURE_LEN</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">postureChange_Threshold</span> ) <span class="cm-operator">!=</span> <span class="cm-variable">SUCCESS</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span>(<span class="cm-variable">device_Init_Info</span>.<span class="cm-variable">peskType</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">PESK_UNIT_BIT</span>) )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">postureChange_Threshold</span> <span class="cm-operator">=</span> <span class="cm-variable">USER_POSTURE_THRESHOLD_METRIC</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">postureChange_Threshold</span> <span class="cm-operator">=</span> <span class="cm-variable">USER_POSTURE_THRESHOLD_IMPERIAL</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span><span class="cm-variable">buffer</span> <span class="cm-operator">=</span> <span class="cm-variable">postureChange_Threshold</span> <span class="cm-operator">/</span> <span class="cm-number">256</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span> <span class="cm-variable">postureChange_Threshold</span> <span class="cm-operator">%</span> <span class="cm-number">256</span>;</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 391px;"></div></div></div></pre></li></ul></li></ul><h6><a name='header-c10100' class='md-header-anchor '></a>超时停止事件</h6><ul><li><p>说明：</p><p>	加入超时停止事件的目的是为了防止由于手机端在突然连接断开或操作无效时，桌子继续动作，这种动作可能会造成严重后果，所以手机端所发送过来的所有关于控制的信息必须启动该超时停止事件。</p><p>	该事件在接收到手机端的控制指令时延时500ms立刻停止桌子的一切升降动作，以防意外发生。在500ms内如果再次收到手机端的信息，则说明手机端目前在可控状态，即可重新开始计时500ms。</p></li><li><p>相关代码</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap "><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Set_Stop</span>()</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_CTRL_FREE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">pesk_Move_CurrentStatus</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STATUS_IDLE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">cmd_Previous</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_COMMON_STOP</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">pesk_Stop_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 161px;"></div></div></div></pre></li></ul><h5><a name='header-c8603' class='md-header-anchor '></a>2.2.2 蓝牙数据接收回调</h5><h6><a name='header-c8604' class='md-header-anchor '></a>更改硬件信息回调</h6><ul><li><p>说明：</p><p>	在手机端更改硬件信息时，需要做三件事情。</p><ul><li>将硬件信息写入snv中。</li><li>将新的硬件信息数据存入ram中以便调用。</li><li>将新的硬件信息通过蓝牙发送到手机端。</li></ul></li><li><p>相关代码：</p><p>	将硬件信息进行有效性验证之后再写入到snv存储器中，随后将硬件信息重新初始化。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Set_InitInfo</span>( <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">getData</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">INIT_INFO_ASSERTION</span>( <span class="cm-variable">getData</span> ) )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">osal_snv_write</span>( <span class="cm-variable">BLE_NVID_HARDWARE_INFO</span>, <span class="cm-variable">BLE_NVID_HARDWARE_INFO_LEN</span>, <span class="cm-variable">getData</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_HardwareInfo_Setup</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre><p>	数据有效性验证相关代码：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#pragma inline = forced</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">bool</span> <span class="cm-def">INIT_INFO_ASSERTION</span>( <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">data</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">data</span>[<span class="cm-number">1</span>] <span class="cm-operator">==</span> <span class="cm-variable">PESK_TRIPLESEG_IMPERIAL</span> <span class="cm-operator">||</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">data</span>[<span class="cm-number">1</span>] <span class="cm-operator">==</span> <span class="cm-variable">PESK_TRIPLESEG_METRIC</span> <span class="cm-operator">||</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">data</span>[<span class="cm-number">1</span>] <span class="cm-operator">==</span> <span class="cm-variable">PESK_DOUBLESEG_IMPERIAL</span> <span class="cm-operator">||</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">data</span>[<span class="cm-number">1</span>] <span class="cm-operator">==</span> <span class="cm-variable">PESK_DOUBLESEG_METRIC</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> <span class="cm-atom">true</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> <span class="cm-atom">false</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 345px;"></div></div></div></pre><p>	硬件信息重新初始化：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap   " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_HardwareInfo_Setup</span>()</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">buffer</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">buffer</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">osal_mem_alloc</span>( <span class="cm-keyword">sizeof</span>( <span class="cm-variable">uint8</span> ) <span class="cm-operator">*</span> <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Get_MemoryInit</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR1</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_mem_free</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">buffer</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">osal_mem_alloc</span>( <span class="cm-keyword">sizeof</span>( <span class="cm-variable">uint8</span> ) <span class="cm-operator">*</span> <span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Get_Lock</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR6</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_mem_free</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">buffer</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">osal_mem_alloc</span>( <span class="cm-keyword">sizeof</span>( <span class="cm-variable">uint8</span> ) <span class="cm-operator">*</span> <span class="cm-variable">SIMPLEPROFILE_CHAR0_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Get_DeviceInfo</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR0</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR0_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_mem_free</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">buffer</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">osal_mem_alloc</span>( <span class="cm-keyword">sizeof</span>( <span class="cm-variable">uint8</span> ) <span class="cm-operator">*</span> <span class="cm-variable">SIMPLEPROFILE_CHAR3_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Get_MoveRange</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR3</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR3_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_mem_free</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">buffer</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">osal_mem_alloc</span>( <span class="cm-keyword">sizeof</span>( <span class="cm-variable">uint8</span> ) <span class="cm-operator">*</span> <span class="cm-variable">SIMPLEPROFILE_CHAR2_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_Get_Posture</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR2</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR2_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_mem_free</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* start the watch dog timer */</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">DEVICE_WDT_START</span>();</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 736px;"></div></div></div></pre></li></ul><h6><a name='header-c10531' class='md-header-anchor '></a>更改记忆位置回调</h6><ul><li><p>说明：</p><p>	在手机端发送指令更改记忆位置时，需要做三件事：</p><ul><li>将记忆位置写入snv中。</li><li>将新的记忆位置信息存入ram中以便调用。</li><li>将新的记忆位置数据通过蓝牙发送到手机端。</li></ul></li><li><p>相关代码：</p><p>	将记忆位置信息数据写入snv中，将最大最小限值写入到ram中，随后通过蓝牙将信息发送到手机端。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Set_Multiple_Memory</span>( <span class="cm-variable">uint16</span> <span class="cm-operator">*</span><span class="cm-variable">setHeight</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">buffer</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">dataTemp</span>[<span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">DEVICE_MEMORY_NUM</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">*</span>(<span class="cm-variable">setHeight</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>) <span class="cm-operator">!=</span> <span class="cm-variable">VALUE_INGNORED</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_Value</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span>(<span class="cm-variable">setHeight</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">dataTemp</span>[<span class="cm-number">0</span>] <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">dataTemp</span>[<span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">osal_snv_write</span>( (<span class="cm-variable">BLE_NVID_MEMORY_HEIGHT1</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>), <span class="cm-variable">BLE_NVID_MEMORY_HEIGHT_LEN</span>, <span class="cm-variable">dataTemp</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-number">2</span>) <span class="cm-operator">=</span> <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">*</span> <span class="cm-number">2</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span>  <span class="cm-variable">device_Memory_Set</span>[<span class="cm-variable">i</span>].<span class="cm-variable">height_L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR1</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR1_LEN</span>, <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 460px;"></div></div></div></pre></li></ul><h6><a name='header-c8606' class='md-header-anchor '></a>更改站坐阈值回调</h6><ul><li><p>说明：</p><p>	在手机端发送指令更改站坐阈值时，需要做三件事：</p><ul><li>将站坐阈值写入snv中。</li><li>将新的站坐阈值信息存入ram中以便调用。</li><li>将新的站坐阈值数据通过蓝牙发送到手机端。</li></ul></li><li><p>相关代码：</p><p>	将站坐阈值信息数据写入snv中，将站坐判断阈值信息写入到ram中，随后通过蓝牙将信息发送到手机端。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Set_PostureThreshold</span>( <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">getData</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">sendBuffer_Char2</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">postureChange_Threshold</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span>(<span class="cm-variable">getData</span>) <span class="cm-operator">*</span> <span class="cm-number">256</span> <span class="cm-operator">+</span> <span class="cm-operator">*</span>(<span class="cm-variable">getData</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">sendBuffer_Char2</span> <span class="cm-operator">=</span> <span class="cm-variable">getData</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_snv_write</span>( <span class="cm-variable">BLE_NVID_USER_POSTURE</span>, <span class="cm-variable">BLE_NVID_USER_POSTURE_LEN</span>, <span class="cm-variable">getData</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR2</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR2_LEN</span>, <span class="cm-variable">sendBuffer_Char2</span> );</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre></li></ul><h6><a name='header-c8607' class='md-header-anchor '></a>更改上下限回调</h6><ul><li><p>说明：</p><p>	在手机端发送指令更改上下限时，需要做三件事：</p><ul><li>将上下限值写入snv中。</li><li>将新的桌子动作上下限信息存入ram中以便调用。</li><li>将新的桌子动作上下限数据通过蓝牙发送到手机端。</li></ul></li><li><p>相关代码：</p><p>	将上下限信息数据写入snv中，将桌子动作上下限信息写入到ram中，随后通过蓝牙将信息发送到手机端。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap   " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Set_MoveRange</span>( <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">getData</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-variable">sendBuffer_Char3</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR3_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">seprate_DataU16_t</span> <span class="cm-variable">heightBuffer</span>[<span class="cm-number">2</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">heightBuffer</span>[<span class="cm-number">0</span>].<span class="cm-variable">data_H</span> <span class="cm-operator">=</span> <span class="cm-variable">getData</span>[<span class="cm-number">0</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">heightBuffer</span>[<span class="cm-number">0</span>].<span class="cm-variable">data_L</span> <span class="cm-operator">=</span> <span class="cm-variable">getData</span>[<span class="cm-number">1</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">heightBuffer</span>[<span class="cm-number">1</span>].<span class="cm-variable">data_H</span> <span class="cm-operator">=</span> <span class="cm-variable">getData</span>[<span class="cm-number">2</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">heightBuffer</span>[<span class="cm-number">1</span>].<span class="cm-variable">data_L</span> <span class="cm-operator">=</span> <span class="cm-variable">getData</span>[<span class="cm-number">3</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">heightBuffer</span>[<span class="cm-number">0</span>].<span class="cm-variable">dataValue</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span> <span class="cm-operator">=</span> <span class="cm-variable">heightBuffer</span>[<span class="cm-number">0</span>].<span class="cm-variable">dataValue</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">osal_snv_write</span>( <span class="cm-variable">BLE_NVID_PESK_MAX</span>, <span class="cm-variable">BLE_NVID_PESK_RANGE_LEN</span>, <span class="cm-variable">getData</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">heightBuffer</span>[<span class="cm-number">0</span>].<span class="cm-variable">dataValue</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Maximum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">heightBuffer</span>[<span class="cm-number">1</span>].<span class="cm-variable">dataValue</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span> <span class="cm-operator">=</span> <span class="cm-variable">heightBuffer</span>[<span class="cm-number">1</span>].<span class="cm-variable">dataValue</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">osal_snv_write</span>( <span class="cm-variable">BLE_NVID_PESK_MIN</span>, <span class="cm-variable">BLE_NVID_PESK_RANGE_LEN</span>, <span class="cm-variable">getData</span> <span class="cm-operator">+</span> <span class="cm-number">2</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">heightBuffer</span>[<span class="cm-number">1</span>].<span class="cm-variable">dataValue</span> <span class="cm-operator">=</span> <span class="cm-variable">pesk_Hardware_Info</span>.<span class="cm-variable">height_Minimum</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">sendBuffer_Char3</span>[<span class="cm-number">0</span>] <span class="cm-operator">=</span> <span class="cm-variable">heightBuffer</span>[<span class="cm-number">0</span>].<span class="cm-variable">data_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">sendBuffer_Char3</span>[<span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-variable">heightBuffer</span>[<span class="cm-number">0</span>].<span class="cm-variable">data_L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">sendBuffer_Char3</span>[<span class="cm-number">2</span>] <span class="cm-operator">=</span> <span class="cm-variable">heightBuffer</span>[<span class="cm-number">1</span>].<span class="cm-variable">data_H</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">sendBuffer_Char3</span>[<span class="cm-number">3</span>] <span class="cm-operator">=</span> <span class="cm-variable">heightBuffer</span>[<span class="cm-number">1</span>].<span class="cm-variable">data_L</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR3</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR3_LEN</span>, <span class="cm-variable">sendBuffer_Char3</span> );</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 736px;"></div></div></div></pre></li></ul><h6><a name='header-c8608' class='md-header-anchor '></a>控制指令接收回调</h6><ul><li><p>说明：</p><p>	控制指令在接收到后，首先判断当前是否为锁定状态或者为手控板控制状态，若为之中之一则不予执行，否则判断是否为控制指令，如果是控制指令则立即开始超时停止事件，否则则不开始超时停止桌子的响应事件。</p><p>	具体的手机控制指令需参照&lt;表2-3&gt;。</p></li><li><p>相关代码：</p><p>	接收到数据时的处理：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">case</span> <span class="cm-variable">SIMPLEPROFILE_CHAR4</span>:</span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">newCharValue</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">osal_mem_alloc</span>( <span class="cm-keyword">sizeof</span>( <span class="cm-variable">uint8</span> ) );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">SimpleProfile_GetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR4</span>, <span class="cm-variable">newCharValue</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">/* Start timeout event when handset is not working &amp; not in lock status */</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">stopTime</span> <span class="cm-operator">=</span> <span class="cm-variable">peskMoveCommand</span>( <span class="cm-operator">*</span><span class="cm-variable">newCharValue</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">osal_start_timerEx</span>( <span class="cm-variable">simpleBLEPeripheral_TaskID</span>, <span class="cm-variable">SBP_PESK_STOP_EVT</span>, <span class="cm-variable">stopTime</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 161px;"></div></div></div></pre><p>	根据指令的不同执行不同动作：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">uint16</span> <span class="cm-def">peskMoveCommand</span>( <span class="cm-variable">uint8</span> <span class="cm-variable">cmd</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint16</span> <span class="cm-variable">stopTime</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">switch</span>( <span class="cm-variable">cmd</span> <span class="cm-operator">&amp;</span> <span class="cm-number">0xf0</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_COMMON_CMD</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">pesk_Lock_Status</span> <span class="cm-operator">&amp;&amp;</span> (<span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">!=</span> <span class="cm-variable">DEVICE_CTRL_HANDSET</span>) )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_CTRL_APP</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">stopTime</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STOP_TIMEOUT_COMMON</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">cmd</span> <span class="cm-operator">&amp;</span> <span class="cm-number">0x0f</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_COMMON_UP</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">peskCmdHandle</span>( <span class="cm-variable">DEVICE_COMMON_CMD</span>, <span class="cm-variable">DEVICE_COMMON_UP</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_COMMON_DOWN</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">peskCmdHandle</span>( <span class="cm-variable">DEVICE_COMMON_CMD</span>, <span class="cm-variable">DEVICE_COMMON_DOWN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_COMMON_STOP</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_Set_Stop</span>();</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Discard the useless command!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_MEMORY_CMD</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-operator">!</span><span class="cm-variable">pesk_Lock_Status</span> <span class="cm-operator">&amp;&amp;</span> (<span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">!=</span> <span class="cm-variable">DEVICE_CTRL_HANDSET</span>) )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">device_Current_CtrlMode</span> <span class="cm-operator">=</span> <span class="cm-variable">DEVICE_CTRL_FREE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">stopTime</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STOP_TIMEOUT_MEMORY</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">switch</span>( <span class="cm-variable">cmd</span> <span class="cm-operator">&amp;</span> <span class="cm-number">0x0f</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_MEMORY_SET1</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">peskCmdHandle</span>( <span class="cm-variable">DEVICE_MEMORY_CMD</span>, <span class="cm-variable">DEVICE_MEMORY_SET1</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_MEMORY_SET2</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">peskCmdHandle</span>( <span class="cm-variable">DEVICE_MEMORY_CMD</span>, <span class="cm-variable">DEVICE_MEMORY_SET2</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_MEMORY_SET3</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">peskCmdHandle</span>( <span class="cm-variable">DEVICE_MEMORY_CMD</span>, <span class="cm-variable">DEVICE_MEMORY_SET3</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_MEMORY_SET4</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">peskCmdHandle</span>( <span class="cm-variable">DEVICE_MEMORY_CMD</span>, <span class="cm-variable">DEVICE_MEMORY_SET4</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">// Discard the useless command!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_ADVANCE_CMD</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_SendHealthData_Enable</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">stopTime</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STOP_TIMEOUT_ADVANCE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">default</span>:</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">// Discard the useless command!</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">break</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">cmd_Previous</span> <span class="cm-operator">=</span> <span class="cm-variable">cmd</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">return</span> <span class="cm-variable">stopTime</span>;</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1679px;"></div></div></div></pre></li></ul><h6><a name='header-c10881' class='md-header-anchor '></a>更改锁定信息回调</h6><ul><li><p>说明：</p><p>	在手机端发送指令更改上下限时，需要做三件事：</p><ul><li>将锁定信息中的锁定状态写入snv中。</li><li>将锁定信息的锁定状态及延时锁定时间信息存入ram中以便调用。</li><li>将新的锁定信息数据通过蓝牙发送到手机端。</li></ul></li><li><p>相关代码：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Set_LockData</span>( <span class="cm-variable">uint8</span><span class="cm-operator">*</span> <span class="cm-variable">getData</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">device_LockData</span>.<span class="cm-variable">lockStatus</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span><span class="cm-variable">getData</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span>; <span class="cm-variable">i</span><span class="cm-operator">++</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_LockData</span>.<span class="cm-variable">timeStamp_S</span>[<span class="cm-variable">SIMPLEPROFILE_CHAR6_LEN</span> <span class="cm-operator">-</span> <span class="cm-variable">i</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-operator">*</span>(<span class="cm-variable">getData</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>);</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">osal_snv_write</span>( <span class="cm-variable">BLE_NVID_DEVICE_LOCK</span>, <span class="cm-variable">BLE_NVID_DEVICE_LOCK_LEN</span>, <span class="cm-operator">&amp;</span><span class="cm-variable">device_LockData</span>.<span class="cm-variable">lockStatus</span> );</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 207px;"></div></div></div></pre></li></ul><h6><a name='header-c10447' class='md-header-anchor '></a>健康数据发送</h6><ul><li><p>说明：</p><p>	在手机端发送控制指令时，有一个进阶指令(详情请参照&lt;表2-3&gt;)，该指令中有一个发送健康数据指令，该指令可以命令手机打开健康数据发送的标志位，让健康数据在周期函数中进行发送，一共发送67组，每组数据有3个数据包，这样就是一共为201组关于用户站坐信息的数据。</p></li><li><p>相关代码：</p><p>	接收指令后的直接处理语句：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">case</span> <span class="cm-variable">DEVICE_ADVANCE_CMD</span>:</span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">device_SendHealthData_Enable</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">stopTime</span> <span class="cm-operator">=</span> <span class="cm-variable">PESK_STOP_TIMEOUT_ADVANCE</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">break</span>;</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 92px;"></div></div></div></pre><p>	一旦健康数据发送标志位<code>device_SendHealthData_Enable</code>置为<code>true</code> 后，则立刻开启健康数据的发送进程，在健康数据发送过程中，当全部数据发送完毕后便停止健康数据的发送进程。</p><p>	健康数据的保存过程在周期性事件判断用户站坐姿态的函数中，该函数在用户每一次切换自己的姿态时都会记录一组数据。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap  " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">device_Send_HealthData</span>()</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">sendBuffer_Char8</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uint8</span> <span class="cm-operator">*</span><span class="cm-variable">getBuffer</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">healthData_Send_Count</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span>( <span class="cm-variable">device_SendHealthData_Enable</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">sendBuffer_Char8</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">osal_mem_alloc</span>( <span class="cm-keyword">sizeof</span>(<span class="cm-variable">uint8</span>) <span class="cm-operator">*</span> <span class="cm-variable">SIMPLEPROFILE_CHAR8_LEN</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">getBuffer</span> <span class="cm-operator">=</span> (<span class="cm-variable">uint8</span> <span class="cm-operator">*</span>)<span class="cm-variable">user_HealthData</span> <span class="cm-operator">+</span> (<span class="cm-variable">SIMPLEPROFILE_CHAR8_LEN</span> <span class="cm-operator">-</span> <span class="cm-number">1</span>) <span class="cm-operator">*</span> <span class="cm-variable">healthData_Send_Count</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-operator">*</span><span class="cm-variable">sendBuffer_Char8</span> <span class="cm-operator">=</span> <span class="cm-variable">healthData_Send_Count</span><span class="cm-operator">++</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">for</span>( <span class="cm-variable-3">int</span> <span class="cm-variable">i</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>; <span class="cm-variable">i</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">SIMPLEPROFILE_CHAR8_LEN</span> <span class="cm-operator">-</span> <span class="cm-number">1</span> ; <span class="cm-variable">i</span><span class="cm-operator">++</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-operator">*</span>(<span class="cm-variable">sendBuffer_Char8</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span> <span class="cm-operator">+</span> <span class="cm-number">1</span>) <span class="cm-operator">=</span> <span class="cm-operator">*</span>(<span class="cm-variable">getBuffer</span> <span class="cm-operator">+</span> <span class="cm-variable">i</span>); </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">SimpleProfile_SetParameter</span>( <span class="cm-variable">SIMPLEPROFILE_CHAR8</span>, <span class="cm-variable">SIMPLEPROFILE_CHAR8_LEN</span>, <span class="cm-variable">sendBuffer_Char8</span> ); </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">osal_mem_free</span>( <span class="cm-variable">sendBuffer_Char8</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">healthData_Send_Count</span> <span class="cm-operator">&gt;=</span> <span class="cm-variable">USER_HEALTHDATA_MAX_COUNT</span> <span class="cm-operator">/</span> <span class="cm-number">3</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">healthData_Send_Count</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">device_SendHealthData_Enable</span> <span class="cm-operator">=</span> <span class="cm-atom">false</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 552px;"></div></div></div></pre></li></ul><h4><a name='header-c11043' class='md-header-anchor '></a>2.3 捷昌控制盒数据接收处理</h4><ul><li><p>处理方式</p><p>	捷昌异步数据的处理方式是根据TI所提供协议栈的dma方式，及直接内存读取方式。捷昌的异步数据提供了全部关于高度、错误、保存的信息，然而它的发送方式却是以每23ms为周期连续发送4个数据。这样的方式难以确定帧头以及有效数据。所以在这里，芯片端所采用的处理方式是：根据接收数据间隔时间来判断接收数据的有效数据。</p></li><li><p>相关代码</p><p>	由于捷昌数据为4个一组，所以在这里我将dma缓存区的最大接收改为4个字节，以防溢出。根据<code>uart_DataReceivedCounter</code> 来确定数据接收的间隔。当数据接收间隔大于期望值时，则代表接收到的字节为头字节。</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">uart_DataHandle</span>( <span class="cm-variable">uint8</span> <span class="cm-variable">numBytes</span> )</span></pre></div><pre class=""><span style="padding-right: 0.1px;">{</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">uint8</span> <span class="cm-variable">buffer</span>[<span class="cm-variable">L_RCV_JC_LEN</span>];</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">static</span> <span class="cm-variable">seprate_DataU32_t</span> <span class="cm-variable">previous_PeskData</span>,<span class="cm-variable">current_PeskData</span>; </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> ( (<span class="cm-variable">numBytes</span> <span class="cm-operator">==</span> <span class="cm-variable">L_RCV_JC_LEN</span>) <span class="cm-operator">&amp;&amp;</span> (<span class="cm-variable">uart_DataReceivedCounter</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">RX_TIME_DELAY</span>) )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span> ( <span class="cm-variable">uart_DataReceivedCounter</span> <span class="cm-operator">&lt;</span> <span class="cm-variable">RX_TIME_OVERFLOW</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">NPI_ReadTransport</span>( <span class="cm-variable">buffer</span>, <span class="cm-variable">numBytes</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">NPI_ClearTransport</span>( <span class="cm-variable">numBytes</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"><span>​</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">data</span>[<span class="cm-number">0</span>] <span class="cm-operator">=</span> <span class="cm-operator">*</span>( <span class="cm-variable">buffer</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">data</span>[<span class="cm-number">1</span>] <span class="cm-operator">=</span> <span class="cm-operator">*</span>( <span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">1</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">data</span>[<span class="cm-number">2</span>] <span class="cm-operator">=</span> <span class="cm-operator">*</span>( <span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">2</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">data</span>[<span class="cm-number">3</span>] <span class="cm-operator">=</span> <span class="cm-operator">*</span>( <span class="cm-variable">buffer</span> <span class="cm-operator">+</span> <span class="cm-number">3</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">previous_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">==</span> <span class="cm-variable">PESKDATA_IN_RST</span> <span class="cm-operator">&amp;&amp;</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ( <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">==</span> <span class="cm-variable">PESKDATA_RST_ERRCODE</span> <span class="cm-operator">||</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  ( (<span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">PESKDATA_IN_NORMAL_FILTER</span>) <span class="cm-operator">!=</span> <span class="cm-variable">PESKDATA_IN_ERROR</span> <span class="cm-operator">&amp;&amp;</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">PESKDATA_IN_NORMAL_FILTER</span>) <span class="cm-operator">!=</span> <span class="cm-variable">PESKDATA_IN_NORMAL</span> ) <span class="cm-operator">||</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">==</span> <span class="cm-variable">PESKDATA_RST_ERRCODE2</span> <span class="cm-operator">||</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">==</span> <span class="cm-variable">PESKDATA_RST_ERRCODE3</span>) )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">=</span> <span class="cm-variable">PESKDATA_IN_RST</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">else</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">peskData</span>.<span class="cm-variable">peskStatus</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span>( <span class="cm-variable">buffer</span><span class="cm-operator">+</span><span class="cm-number">1</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">peskData</span>.<span class="cm-variable">info_H</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span>( <span class="cm-variable">buffer</span><span class="cm-operator">+</span><span class="cm-number">2</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">peskData</span>.<span class="cm-variable">info_L</span> <span class="cm-operator">=</span> <span class="cm-operator">*</span>( <span class="cm-variable">buffer</span><span class="cm-operator">+</span><span class="cm-number">3</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span>( <span class="cm-variable">previous_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">!=</span> <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">previous_PeskData</span> <span class="cm-operator">=</span> <span class="cm-variable">current_PeskData</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">else</span> <span class="cm-keyword">if</span> ( <span class="cm-variable">numBytes</span> <span class="cm-operator">&gt;</span> <span class="cm-variable">L_RCV_JC_LEN</span> )</span></pre><pre class=""><span style="padding-right: 0.1px;">  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">NPI_ClearTransport</span>( <span class="cm-variable">numBytes</span> );</span></pre><pre class=""><span style="padding-right: 0.1px;">  }</span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">uart_DataReceivedCounter</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1035px;"></div></div></div></pre><ul><li><p>特殊情况的处理：</p><p>	捷昌的控制盒在RST时有一种闪烁的机制，这种机制下，有可能会造成数据的混乱。原因为数据发送的间隔不定。</p><p>	为了解决这种情况，需要分析处于RST状态下所有下一个状态的可能性，如果出现异常则忽略。</p><p>	RST的正常协议数值为:<code>0x01 0x04 0x01 0xaa</code></p><ul><li>在数据混乱时有可能的数值为：</li></ul><p>	<code>0xaa 0x01 0x01 0x04</code></p><p>	<code>0x04 0xaa 0x01 0x01</code></p><p>	<code>0x01 0x04 0xaa 0x01</code></p><p>	<code>0x01 0x01 0x01 0xaa</code></p><p>	<code>0xaa 0x01 0x01 0x01</code></p><p>	<code>0x01 0xaa 0x01 0x01</code></p><p>	<code>0x01 0x01 0xaa 0x01</code></p><p>	<code>0x01 0x01 0x01 0x04</code></p><p>	<code>0x04 0x01 0x01 0x01</code></p><p>	<code>0x01 0x04 0x01 0x01</code></p><p>	<code>0x01 0x01 0x04 0x01</code></p><ul><li><p>而在数据正常时，所有可能的数值为：</p><p><code>0x01 0x04 0x01 0xaa</code></p><p><code>0x01 0x02 0x-- 0x--</code></p><p>	<em>(注：--表示未知，但可以确定的是错误状态)</em></p><p><code>0x01 0x01 0x-- 0x--</code></p><p>	<em>(注：这里的后两个字节组合后代表桌腿最低值，一定不会是<code>0x01 0x04</code>，<code>0x04 0x01</code>，<code>0x01 0xaa</code>以及<code>0xaa 0x01</code>)</em></p></li><li><p>所以可以根据以下逻辑图分析出判断情况，并将无效数据进行过滤排除：</p><p><img src='RST%20all%20situations.png' alt='RST all situations' /></p></li><li><p>所以有以下这段代码：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-keyword">if</span>( <span class="cm-variable">previous_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">==</span> <span class="cm-variable">PESKDATA_IN_RST</span> <span class="cm-operator">&amp;&amp;</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ( <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">==</span> <span class="cm-variable">PESKDATA_RST_ERRCODE</span> <span class="cm-operator">||</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  ( (<span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">PESKDATA_IN_NORMAL_FILTER</span>) <span class="cm-operator">!=</span> <span class="cm-variable">PESKDATA_IN_ERROR</span> <span class="cm-operator">&amp;&amp;</span> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">&amp;</span> <span class="cm-variable">PESKDATA_IN_NORMAL_FILTER</span>) <span class="cm-operator">!=</span> <span class="cm-variable">PESKDATA_IN_NORMAL</span> ) <span class="cm-operator">||</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">==</span> <span class="cm-variable">PESKDATA_RST_ERRCODE2</span> <span class="cm-operator">||</span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">==</span> <span class="cm-variable">PESKDATA_RST_ERRCODE3</span>) )</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  {</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">current_PeskData</span>.<span class="cm-variable">dataValue</span> <span class="cm-operator">=</span> <span class="cm-variable">PESKDATA_IN_RST</span>;</span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }</span></pre></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 230px;"></div></div></div></pre><p>	以及所有错误代码值及有效数据可能值的宏定义</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">// RST status handle</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define PESKDATA_IN_RST &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0xaa010401</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define PESKDATA_IN_NORMAL &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x00000101</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define PESKDATA_RST_ERRCODE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0x01040101</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define PESKDATA_RST_ERRCODE2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0x04010101</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define PESKDATA_RST_ERRCODE3 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0x01040201</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define PESKDATA_IN_NORMAL_FILTER &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0x0000ffff</span></span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define PESKDATA_IN_ERROR &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0x00000201</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 184px;"></div></div></div></pre></li></ul></li></ul></li></ul><h2><a name='header-c11451' class='md-header-anchor '></a>四、总结</h2><p>	以上全部为嵌入式软件开发的思路、逻辑以及部分重要代码，经过这次嵌入式软件的重构，应当养成在添加新功能时理清所有逻辑及可能发生的所有情况的习惯，以免一旦添加新的功能所造成的代码混乱的现象。</p><p>	以上代码及逻辑还有很多不完善的地方，还需要多加改进。对公有变量的大量使用，导致公有变量逻辑十分混乱，以后需要规避。</p><p>	再次感谢卢闫进、李泽昊、袁兆阳以及郭蒙对我的指导。</p><h2><a name='header-c11481' class='md-header-anchor '></a>五、附录</h2><h3><a name='header-c11484' class='md-header-anchor '></a>集成开发环境</h3><h4><a name='header-c11506' class='md-header-anchor '></a>集成开发软件</h4><p>IAR 8.20</p><p><img src='IDE.png' alt='IDE' /></p><h4><a name='header-c11505' class='md-header-anchor '></a>相关编译宏定义</h4><p><img src='MACRO.png' alt='MACRO' /></p><p>	以下为宏定义<code>Defined symbos:(one per line)</code>具体数据：</p><pre class="md-fences md-end-block" lang="c"> <div class="CodeMirror cm-s-inner CodeMirror-wrap  " lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">INT_HEAP_LEN</span><span class="cm-operator">=</span><span class="cm-number">3072</span></span></pre></div><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">HALNODEBUG</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">OSAL_CBTIMER_NUM_TASKS</span><span class="cm-operator">=</span><span class="cm-number">1</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">HAL_AES_DMA</span><span class="cm-operator">=</span><span class="cm-variable">TRUE</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">HAL_DMA</span><span class="cm-operator">=</span><span class="cm-variable">TRUE</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">HAL_UART</span><span class="cm-operator">=</span><span class="cm-variable">TRUE</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">xPLUS_BROADCASTER</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">HAL_LCD</span><span class="cm-operator">=</span><span class="cm-variable">TRUE</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">HAL_LED</span><span class="cm-operator">=</span><span class="cm-variable">FALSE</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">PRODUCT_TYPE_BAR2</span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">xPRODUCT_TYPE_BAR</span></span></pre><div class="" style="position: relative;"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">xPRODUCT_TYPE_CUBE</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px; top: 0px;"></div><div class="CodeMirror-gutters" style="display: none; height: 276px;"></div></div></div></pre></div>
</body>
</html>